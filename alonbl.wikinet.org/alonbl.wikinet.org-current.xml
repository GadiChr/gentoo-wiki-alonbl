<mediawiki xmlns="http://www.mediawiki.org/xml/export-0.4/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mediawiki.org/xml/export-0.4/ http://www.mediawiki.org/xml/export-0.4.xsd" version="0.4" xml:lang="en">
  <siteinfo>
    <sitename>MySite</sitename>
    <base>http://alonbl.wikinet.org/wiki/Main_Page</base>
    <generator>MediaWiki 1.16.5</generator>
    <case>first-letter</case>
    <namespaces>
      <namespace key="-2" case="first-letter">Media</namespace>
      <namespace key="-1" case="first-letter">Special</namespace>
      <namespace key="0" case="first-letter" />
      <namespace key="1" case="first-letter">Talk</namespace>
      <namespace key="2" case="first-letter">User</namespace>
      <namespace key="3" case="first-letter">User talk</namespace>
      <namespace key="4" case="first-letter">MySite</namespace>
      <namespace key="5" case="first-letter">MySite talk</namespace>
      <namespace key="6" case="first-letter">File</namespace>
      <namespace key="7" case="first-letter">File talk</namespace>
      <namespace key="8" case="first-letter">MediaWiki</namespace>
      <namespace key="9" case="first-letter">MediaWiki talk</namespace>
      <namespace key="10" case="first-letter">Template</namespace>
      <namespace key="11" case="first-letter">Template talk</namespace>
      <namespace key="12" case="first-letter">Help</namespace>
      <namespace key="13" case="first-letter">Help talk</namespace>
      <namespace key="14" case="first-letter">Category</namespace>
      <namespace key="15" case="first-letter">Category talk</namespace>
    </namespaces>
  </siteinfo>
  <page>
    <title>Main Page</title>
    <id>1</id>
    <revision>
      <id>254</id>
      <timestamp>2013-06-05T21:12:43Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve">= Welcome to Alon Bar-Lev's Site =

* [[User:Alonbl]]
* [[Gentoo]]</text>
    </revision>
  </page>
  <page>
    <title>File:ASRock Core 100HT.jpg</title>
    <id>82</id>
    <revision>
      <id>107</id>
      <timestamp>2013-06-05T19:13:43Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve" />
    </revision>
  </page>
  <page>
    <title>File:ATT USB GSM Modem.jpg</title>
    <id>89</id>
    <revision>
      <id>116</id>
      <timestamp>2013-06-05T19:41:35Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve" />
    </revision>
  </page>
  <page>
    <title>File:Alonbl.jpg</title>
    <id>144</id>
    <revision>
      <id>252</id>
      <timestamp>2013-06-05T21:11:07Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve" />
    </revision>
  </page>
  <page>
    <title>File:Bibletime Hebrew Genesis.jpg</title>
    <id>96</id>
    <revision>
      <id>131</id>
      <timestamp>2013-06-05T20:04:40Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve" />
    </revision>
  </page>
  <page>
    <title>File:Firefox Hebrew Genesis.jpg</title>
    <id>95</id>
    <revision>
      <id>130</id>
      <timestamp>2013-06-05T20:04:19Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve" />
    </revision>
  </page>
  <page>
    <title>File:Koribo Irad.png</title>
    <id>83</id>
    <revision>
      <id>109</id>
      <timestamp>2013-06-05T19:16:38Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve" />
    </revision>
  </page>
  <page>
    <title>File:Libreoffice Hebrew.jpg</title>
    <id>97</id>
    <revision>
      <id>132</id>
      <timestamp>2013-06-05T20:04:59Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve" />
    </revision>
  </page>
  <page>
    <title>File:Nano Bluetooth USB Adapter.jpg</title>
    <id>85</id>
    <revision>
      <id>111</id>
      <timestamp>2013-06-05T19:18:24Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve" />
    </revision>
  </page>
  <page>
    <title>File:RSA SecurID SID800.png</title>
    <id>91</id>
    <revision>
      <id>118</id>
      <timestamp>2013-06-05T19:44:11Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve" />
    </revision>
  </page>
  <page>
    <title>File:Seagate BlackArmor 110.png</title>
    <id>86</id>
    <revision>
      <id>112</id>
      <timestamp>2013-06-05T19:18:45Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve" />
    </revision>
  </page>
  <page>
    <title>File:Sony DualShock3 SixAxis.png</title>
    <id>84</id>
    <revision>
      <id>110</id>
      <timestamp>2013-06-05T19:17:23Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve" />
    </revision>
  </page>
  <page>
    <title>File:USB SATA JM20337.jpg</title>
    <id>92</id>
    <revision>
      <id>119</id>
      <timestamp>2013-06-05T19:44:47Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve" />
    </revision>
  </page>
  <page>
    <title>File:USB SATA SPIF225A.jpg</title>
    <id>93</id>
    <revision>
      <id>120</id>
      <timestamp>2013-06-05T19:45:15Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve" />
    </revision>
  </page>
  <page>
    <title>File:ZTE USB GSM Modem.jpg</title>
    <id>90</id>
    <revision>
      <id>117</id>
      <timestamp>2013-06-05T19:43:14Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve" />
    </revision>
  </page>
  <page>
    <title>Gentoo</title>
    <id>40</id>
    <revision>
      <id>256</id>
      <timestamp>2013-06-05T21:16:30Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <comment>/* Administrative */</comment>
      <text xml:space="preserve">== Maintain ==

=== Administrative ===

* {{WikiBackup|User:Alonbl}}
* {{WikiBackup|Gentoo}}

=== Hardware ===

* {{WikiBackup|Gentoo/Linux_Configuration_Common}}
* {{WikiBackup|Gentoo/Thinkpad_Common}}
* {{WikiBackup|Gentoo/Linux_Configuration_Thinkpad_W500}}
* {{WikiBackup|Gentoo/Linux_Configuration_Dell_E6410}}
* {{WikiBackup|Gentoo/Linux_Configuration_ASRock_Core_100HT}}
* {{WikiBackup|Gentoo/Configuration_Workstation}}
* {{WikiBackup|Gentoo/Configuration_Server}}
* {{WikiBackup|Gentoo/Configuration_HTPC_ASRock_Core_100HT}}
* {{WikiBackup|Gentoo/Intel_Integrated_Graphics_Controller}}
* {{WikiBackup|Gentoo/USB_Power_Saving}}
* {{WikiBackup|Gentoo/Lenovo_UVC_Camera}}
* {{WikiBackup|Gentoo/ATT_USB_GSM_Modem}}
* {{WikiBackup|Gentoo/ZTE_USB_GSM_Modem}}
* {{WikiBackup|Gentoo/Bluetooth}}
* {{WikiBackup|Gentoo/Bluetooth_Modem}}
* {{WikiBackup|Gentoo/Sony_DualShock3_SixAxis}}
* {{WikiBackup|Gentoo/RSA_SecurID}}
* {{WikiBackup|Gentoo/USB_SATA_JM20337}}
* {{WikiBackup|Gentoo/USB_SATA_SPIF225A}}

=== Security ===

* {{WikiBackup|Gentoo/MIT_Kerberos_Windows_Domain}}
* {{WikiBackup|Gentoo/Secured_Portage_Sync}}
* {{WikiBackup|Gentoo/Linux_Disk_Encryption_Using_LoopAES_And_SmartCards}}
* {{WikiBackup|Gentoo/CIFS_Kerberos}}
* {{WikiBackup|Gentoo/Suspend_To_Disk_Using_uswsusp_and_genkernel}}
* {{WikiBackup|Gentoo/Non_Root_Xorg-Server}}
* {{WikiBackup|Gentoo/Convert_SPC_PVK}}

=== Networking ===

* {{WikiBackup|Gentoo/Openresolv}}
* {{WikiBackup|Gentoo/Stealth_DHCP}}
* {{WikiBackup|Gentoo/Firewall_Using_Firehol}}
* {{WikiBackup|Gentoo/OpenVPN_Server}}
* {{WikiBackup|Gentoo/OpenVPN_Non_Root}}
* {{WikiBackup|Gentoo/Vpnc_Non_Root}}
* {{WikiBackup|Gentoo/VM_Tap_Networking}}
* {{WikiBackup|Gentoo/PPP_Client}}
* {{WikiBackup|Gentoo/PPPoE_Client}}

=== Software ===

* {{WikiBackup|Gentoo/Gentoo_Bootstrap}}
* {{WikiBackup|Gentoo/Gentoo_Configuration_Common}}
* {{WikiBackup|Gentoo/Syslinux_Bootloader}}
* {{WikiBackup|Gentoo/Java_Using_IcedTea}}
* {{WikiBackup|Gentoo/Bugzilla_Email}}
* {{WikiBackup|Gentoo/Bugzilla_Kerberos}}

=== Localization ===

* {{WikiBackup|Gentoo/Hebrew}}

== Contribute/Monitor ==

* {{WikiBackup|Gentoo/Lenovo_ThinkPad_T400}}
* {{WikiBackup|Gentoo/Fbsplash}}
* {{WikiBackup|Gentoo/Iwlwifi}}
* {{WikiBackup|Gentoo/Userspace_software_suspend}}
* {{WikiBackup|Gentoo/Git}}

== Maintainer ==

[[User:Alonbl|Alon Bar-Lev]]

{{AuthorList|{{Author|Alon Bar-Lev|2011-11-17|type=original}}}}</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/ATT USB GSM Modem</title>
    <id>2</id>
    <revision>
      <id>235</id>
      <timestamp>2013-06-05T20:56:24Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve">= AT&amp;T USB GSM Modem =

== Device ==

[[File:ATT_USB_GSM_Modem.jpg|200px]]

USB
{{Codeline|&lt;pre&gt;
1199:68a3 Sierra Wireless, Inc. 
&lt;/pre&gt;}}

== Installation ==

{{Kernel||&lt;pre&gt;
  Device Drivers  ---&gt;
    SCSI device support  ---&gt;
      {M} SCSI device support
      &lt;M&gt; SCSI disk support
    [*] USB support  ---&gt;
      &lt;M&gt;   USB Mass Storage support
      &lt;M&gt;   USB Serial Converter support  ---&gt;
        &lt;M&gt;   USB Sierra Wireless Driver
&lt;/pre&gt;}}

You should also configure the system to run PPP.&amp;nbsp; See [[Gentoo/PPP_Client|how to configure ppp client]].

== Network configuration ==

Add:
{{File|/etc/conf.d/net|&lt;pre&gt;
rc_net_ppp2_need=&quot;firewall&quot;                  # optional, if you use firewall
config_ppp2=&quot;ppp&quot;
link_ppp2=&quot;/dev/ttyUSB4&quot;
pppd_ppp2=&quot;noauth defaultroute usepeerdns lock mru 296 mtu 296&quot;
phone_number_ppp2=&quot;*99***1#&quot;
isp_ppp2=&quot;isp.cingular&quot;

chat_ppp2=&quot;
ABORT BUSY
ABORT ERROR
ABORT 'NO ANSWER'
ABORT 'NO CARRIER'
ABORT 'NO DIALTONE'
ABORT 'Invalid Login'
ABORT 'Login incorrect'
TIMEOUT 5
'' 'ATZ'
OK AT+cfun=1
OK AT+cgreg=1
OK AT+CGDCONT=1,\\\&quot;IP\\\&quot;,\\\&quot;${isp_ppp2}\\\&quot;
OK AT
OK 'ATDT\T'
TIMEOUT 60
CONNECT ''
TIMEOUT 5
'~--' ''&quot;
&lt;/pre&gt;}}

{{Root|ln -s net.lo /etc/init.d/net.ppp2}}

== Manage ==

{{Root|/etc/init.d/net.ppp2 start}}
{{Root|/etc/init.d/net.ppp2 stop}}

== Reference ==

http://mycusthelp.net/SIERRAWIRELESS/_cs/AnswerDetail.aspx?aid=5

== Maintainer ==

[[User:Alonbl|Alon Bar-Lev]]

{{AuthorList|{{Author|Alon Bar-Lev|2011-11-17|type=original}}}}

[[Category:Hardware]]
[[Category:Network]]</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/Bluetooth</title>
    <id>10</id>
    <revision>
      <id>165</id>
      <timestamp>2013-06-05T20:15:35Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <minor/>
      <comment>moved [[Bluetooth]] to [[Gentoo/Bluetooth]]</comment>
      <text xml:space="preserve">= Bluethooth =

== Configuration ==

{{Kernel||&lt;pre&gt;
  [*] Networking support  ---&gt;
    &lt;M&gt;   Bluetooth subsystem support  ---&gt;
      [*]   L2CAP protocol support
      Bluetooth device drivers  ---&gt;
         &lt;M&gt; HCI USB driver
&lt;/pre&gt;}}

Add:
{{File|/etc/conf.d/modules|&lt;pre&gt;
modules=&quot;${modules} bluethooth&quot;
&lt;/pre&gt;}}

{{Root|emerge net-wireless/bluez}}

{{Root|rc-update add bluetooth default}}
{{Root|/etc/init.d/bluetooth start}}

Most probably you would like to access bluetooth daemon from regular user, most desktop environments will require that, modify:
{{File|/etc/dbus-1/system.d/bluetooth.conf|&lt;pre&gt;
  &lt;policy context=&quot;default&quot;&gt;
&lt;!-- @LOCAL-BEGIN --&gt;
    &lt;allow send_destination=&quot;org.bluez&quot;/&gt;
&lt;!-- @LOCAL-END --&gt;
  &lt;/policy&gt;
&lt;/pre&gt;}}
{{Root|/etc/init.d/dbus reload}}

== Device Attach ==

Before a device can be used, it must be attached. In order to do so, you must first have interaction agent active, if you are using desktop environment, with bluetooth integration you probably have one already, for example KDE has {{Package|net-wireless/bluedevil}}. If you are unsure or need console mode only there is a simple-agent utility within the bluez sources.

=== Using the simple-agent ===

Temporary emerge required dependencies:
{{Root|emerge dev-python/dbus-python|dev-python/pygobject}}

Extract bluez sources from upstream.
{{Root|tar -xf bluez-0.96.tar.bz}}
{{Root|cd bluez-0.96/test}}

{{Root|python2 ./simple-agent}}
  Agent registered

If you get the following output, it means that you probably have already interaction agent in your system, no need to use the simple-agent.
  &lt;snip&gt;
  dbus.exceptions.DBusException: org.bluez.Error.AlreadyExists: Already Exists

Scan for devices:
{{Root|hcitool scan}}
  Scanning ...
        00:24:7C:2F:92:7C       orange Nokia E71

Attach device:
{{Root|hcitool cc 00:24:7C:2F:92:7C &amp;&amp; hcitool auth 00:24:7C:2F:92:7C}}

Notice that the simple-agent request interaction:
  RequestPinCode (/org/bluez/13983/hci0/dev_00_24_7C_2F_92_7C)
  Enter PIN Code: 1234

Enter a PIN and press &lt;Enter&gt; then enter the same PIN at device.

You are now ready to proceed.

== Desktop integration ==

=== KDE ===

{{Root|emerge net-wireless/bluedevil}}

== Troubleshooting ==

=== Find device ===
hcitool dev should show your bluetooth devices.
{{Root|hcitool dev}}

lsusb will show your bluetooth devices if you have USB bluetooth device or laptop integrated device (in most cases).
{{Root|lsusb}}
    Bus 002 Device 005: ID 0930:0508 Toshiba Corp. Integrated Bluetooth HCI

=== Toshiba laptops ===

Some Toshiba laptops have switcher to enable/disable Wi-Fi and Bluetooth. In new version of kernel you have to enable the following option to make bluetooth working:

{{Kernel||&lt;pre&gt;
  [*] Device drivers  ---&gt;
    [*]   X86 Platform Specific Device Drivers  ---&gt;
      [*]   Toshiba Bluetooth RFKill switch support
&lt;/pre&gt;}}

== Maintainer ==

[[User:Alonbl|Alon Bar-Lev]]

{{AuthorList|{{Author|Alon Bar-Lev|2011-11-17|type=original}}}}

[[Category:Bluetooth]]</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/Bluetooth Modem</title>
    <id>8</id>
    <revision>
      <id>227</id>
      <timestamp>2013-06-05T20:46:48Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve">= Bluetooth Modem =

Bluetooth modems are very common, especially common when cellular phone is bluetooth enabled.

== Configuration ==

First setup core [[Gentoo/Bluetooth|bluetooth]].

{{Kernel||&lt;pre&gt;
  [*] Networking support  ---&gt;
    &lt;M&gt;   Bluetooth subsystem support  ---&gt;
      &lt;M&gt;   RFCOMM protocol support
      [*]     RFCOMM TTY support
&lt;/pre&gt;}}

Add:
{{File|/etc/conf.d/modules|&lt;pre&gt;
modules=&quot;${modules} bluethooth&quot;
&lt;/pre&gt;}}

== Device Attach ==

Attach you modem as any regular device see [[Gentoo/Bluetooth]].

== Setup rfcomm ==

Assuming device address is 00:24:7C:2F:92:7C, add entry:
{{File|/etc/bluetooth/rfcomm.conf|&lt;pre&gt;
rfcomm0 {
        bind yes;
        device 00:24:7C:2F:92:7C;
        channel 4;
        comment &quot;My phone&quot;;
}
&lt;/pre&gt;}}

The tricky is to find the channel number, if you don't have documentation of device, simply start of 0 and increment while testing.

Restart bluetooth:
{{Root|/etc/init.d/bluetooth restart}}

== Test ==

Test using {{Package|net-misc/taylor-uucp}}
{{Root|emerge net-misc/taylor-uucp}}

Simply enter &quot;AT&quot; and expect for &quot;OK&quot;, to exit use &quot;~.&quot; sequence.
{{Root|cu -l /dev/rfcomm0}}
{{Codeline|&lt;pre&gt;
# cu -l /dev/rfcomm0 
Connected.
AT
OK
!.
&lt;/pre&gt;}}

== Network ==

Now you can configure [[Gentoo/PPP_Client|ppp]] to be used with modem.

== Maintainer ==

[[User:Alonbl|Alon Bar-Lev]]

{{AuthorList|{{Author|Alon Bar-Lev|2011-11-17|type=original}}}}

[[Category:Bluetooth]]</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/Bugzilla Email</title>
    <id>12</id>
    <revision>
      <id>137</id>
      <timestamp>2013-06-05T20:11:16Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <minor/>
      <comment>moved [[Bugzilla Email]] to [[Gentoo/Bugzilla Email]]</comment>
      <text xml:space="preserve">= Bugzilla Email =

Bugzilla email setup looks complex, but actually simple. Following are instructions for both incoming and outgoing mails.

== Installation ==

{{Root|emerge net-mail/fetchmail mail-mta/postfix}}

== Configuration ==

=== System ===

Modify:
{{File|/etc/postfix/main.cf|&lt;pre&gt;
mydestination = localhost.localdomain
&lt;/pre&gt;}}

Replace bugz@mydomain.com and secret by your own user and password to fetch bugzilla mails.
{{File|/etc/fetchmailrc|&lt;pre&gt;
poll mail.mydomain.com proto pop3
user &quot;bugz@mydomain.com&quot; password &quot;secret&quot; is apache@localhost.localdomain
ssl
&lt;/pre&gt;}}

{{Root|chown fetchmail /etc/fetchmailrc}}
{{Root|/etc/init.d/postfix start}}
{{Root|/etc/init.d/fetchmail start}}
{{Root|rc-update add postfix default}}
{{Root|rc-update add postfix default}}

{{File|/var/www/.forward|&lt;pre&gt;
&quot;| /var/www/localhost/htdocs/bugzilla/email_in.pl -vvvvvvvvv &gt;&gt; /var/log/apache2/bugzilla-email.log 2&gt;&amp;1&quot;
&lt;/pre&gt;}}

{{File|/etc/logrotate.d/bugzilla-email.conf|&lt;pre&gt;
/var/log/apache2/bugzilla-email.log {
  missingok
  notifempty
}
&lt;/pre&gt;}}

=== Bugzilla ===

Administration → Parameters → Email
  mail_delivery_method: Sendmail
  mailfrom: bugz@mydomain.com
  use_mailer_queue: off

== Customization ==

{{Root|cd /var/www/localhost/htdocs/bugzilla}}
{{Root|mkdir local}}
{{Root|cd local}}
{{Root|ln -s ../Bugzilla}}
{{Root|ln -s ../Bugzilla.pm}}

{{Root|mkdir -p template/en/custom/email}}
{{Root|cd ../template/en}}
{{Root|ln -s ../../local/template/en/custom}}
{{Root|cp default/email/newchangedmail.txt.tmpl custom/email/newchangedmail.txt.tmpl}}

This will make bugzilla send mails on behalf of the users, but allow reply to bugzilla account, modify:
{{File|/var/www/localhost/htdocs/bugzilla/template/en/custom/email/newchangedmail.txt.tmpl|&lt;pre&gt;
From: [% changer.login %]
Reply-To: [% Param('mailfrom') %]
&lt;/pre&gt;}}

If you are using gmail, there is a [http://www.google.com/support/forum/p/gmail/thread?fid=4641785bf01dbd9a00049dc47e25e854&amp;hl=en bug] so in order to properly reply to bugs you update modify:
{{File|/var/www/localhost/htdocs/bugzilla/template/en/custom/email/newchangedmail.txt.tmpl|&lt;pre&gt;
From: [% changer.login.replace(&quot;@MYDOMAIN\.COM|@mydomain\.com&quot;, &quot;+bugz@mydomain.com&quot;) %]
&lt;/pre&gt;}}

== Test ==

=== Outgoing ===

Modify a bug, you should receive update notification from your-self.

Reply, and you should see bugz@mydomain.com as TO.

=== Incoming ===

Send the following mail to bugz@mydomain.com:
{{Codeline|&lt;pre&gt;
Subject: ignored
@bug_id = 1

Test 1 2 3
&lt;/pre&gt;}}

You should see bug#1 updated with &quot;Test 1 2 3&quot; text.

== Subversion Integration ==

The following simple script scans the commit message for bug#NNNN and sends bugzilla
mail with change set information linking to viewvc to ease review.


{{Code|commit-bugzilla.sh|&lt;pre&gt;
#!/bin/sh
# Copyright 2010-2011 Alon Bar-Lev &lt;alon.barlev@gmail.com&gt;
# Distributed under the terms of the GNU General Public License v2

common_dir() {
	local COMMON
	local CANDIDATE
	local n

	read COMMON
	while read CANDIDATE; do
		n=0
		while [ -n &quot;${COMMON:$n}&quot; -a &quot;${COMMON:0:$n}&quot; = &quot;${CANDIDATE:0:$n}&quot; ]; do
			n=$(($n+1))
		done
		COMMON=&quot;${COMMON:0:$n}&quot;
	done
	echo &quot;${COMMON}&quot; | sed 's#/[^/]*$#/#'
}

BASE=&quot;$(dirname &quot;$0&quot;)&quot;
REPOS=&quot;$1&quot;
REV=&quot;$2&quot;

DIR=&quot;$(svnlook dirs-changed &quot;${REPOS}&quot; -r &quot;${REV}&quot; | sort | common_dir)&quot;
MSG=&quot;$(svnlook log &quot;${REPOS}&quot; -r &quot;${REV}&quot;)&quot;
FROM=&quot;$(svnlook author &quot;${REPOS}&quot; -r &quot;${REV}&quot;)&quot;
TO=&quot;${TO:-bugz@mydomain.com}&quot;
VIEWVC=&quot;http://my.mydomain.com/viewvc&quot;

TOP=&quot;$(echo &quot;${MSG}&quot; | head -n1)&quot;

for BUG in $(echo &quot;${MSG}&quot; | grep -i -o 'bug#[0-9][0-9]*'); do

	BUGID=&quot;$(echo &quot;${BUG}&quot; | sed 's/bug#//i')&quot;

	/usr/sbin/sendmail -B8BITMIME &quot;${TO}&quot; &lt;&lt; __EOF__
Subject: Bugzilla update
From: ${FROM}
Content-type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

@bug_id = ${BUGID}

=== COMMIT ===
$(basename &quot;${REPOS}&quot;)@${REV}:${DIR}
${FROM}
${VIEWVC}/$(basename &quot;${REPOS}&quot;)/?view=revision&amp;revision=${REV}
Log:
${MSG}
__EOF__

done
&lt;/pre&gt;}}

To use, go to your repository and create/update hooks/post-commit hook (don't forget to mark as executable):
{{Code|hooks/post-commit|&lt;pre&gt;
#!/bin/sh

REPOS=&quot;$1&quot;
REV=&quot;$2&quot;

export LC_ALL=&quot;en_US.UTF-8&quot;

commit-bugzilla.sh &quot;${REPOS}&quot; &quot;${REV}&quot;
&lt;/pre&gt;}}

== Maintainer ==

[[User:Alonbl|Alon Bar-Lev]]

{{AuthorList|{{Author|Alon Bar-Lev|2011-11-17|type=original}}}}

[[Category:Software]]</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/Bugzilla Kerberos</title>
    <id>74</id>
    <revision>
      <id>243</id>
      <timestamp>2013-06-05T21:03:09Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve">= Bugzilla Kerberos =

Bugzilla kerberos configuration.

== Installation ==

Make sure kerberos integration is working, including apache configuration, see [[Gentoo/MIT_Kerberos_Windows_Domain]], you need only apache integration *NOT* pam/nss integration.

== Bugzilla Configuration ==

Make sure you are able to access bugzilla with kerberous configuration, although there is no integration, you should be able to use is using password authentication.

Make sure your current kerberos user exists within bugzilla and it has administrative permissions. You won't be able to use different user than the kerberos one after configuration.

Administration → Parameters → User Authentication
  auth_env_id: REMOTE_USER
  auth_env_email: REMOTE_USER
  user_info_class: ENV
  user_verify_class: DB

== Author ==

== Maintainer ==

[[User:Alonbl|Alon Bar-Lev]]

{{AuthorList|{{Author|Alon Bar-Lev|2011-11-17|type=original}}}}

[[Category:Software]]
[[Category:Security]]</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/Configuration HTPC ASRock Core 100HT</title>
    <id>46</id>
    <revision>
      <id>228</id>
      <timestamp>2013-06-05T20:51:44Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve">= Alon Bar-Lev's HTPC ASRock Core 100HT =

It took a lot of time to assemble a complete HTPC setup which is Linux compatible, small, quiet.

I use this configuration as Internet Radio, DVD, movies, game console, print server.

Following I describe my setup.

== Hardware ==

=== Computer ===

==== ASRock Core 100HT ====

[[File:ASRock_Core_100HT.jpg|300px]] [http://www.asrock.com/nettop/overview.asp?Model=Core%20100HT Vendor]

Main features: A complete Intel chipset, small, quiet, many USB ports, HDMI 1080p.

The IR remote control is usable under Linux with some patches, however it is very primitive.

=== Input devices ===

==== Koribo Irad ====

[[File:Koribo_Irad.png|300px]] [http://www.koribo.com/pd2_Koribo--Irad.aspx Vendor]

USB:
 ID 1241:0504 Belkin

I actually have bought the two separately (llro, XGene), so I have two receivers, unless the kit comes with special receiver, one does not work correctly with keyboard and remote.

Main features: Standard HID device, most of keys are operational under Linux.

The optical mouse is *AMAZING*!!!

==== Sony DualShock3 SixAxis ====

[[File:Sony_DualShock3_SixAxis.png|300px]] [http://store.sony.com/webapp/wcs/stores/servlet/ProductDisplay?catalogId=10551&amp;storeId=10151&amp;langId=-1&amp;partNumber=PS398050 Vendor]

Main features: Supported by Linux kernel, Full HID emulation, USB and Bluetooth medium support.

=== Communications ===

[[File:Nano_Bluetooth_USB_Adapter.jpg|150px]]

Main features: Supported by Linux kernel, Bluetooth 2 spec.

USB:
 ID 0a12:0001 Cambridge Silicon Radio, Ltd Bluetooth Dongle (HCI mode)

=== Storage ===

==== Seagate Black Armor 110 ====

[[File:Seagate_BlackArmor_110.png|300px]] [http://www.seagate.com/www/en-us/products/network_storage/blackarmor/ Vendor]

Main features: Network attached storage, CIFS, FTP, NFS. Decent security model.

== System ==

Configure the following base of these references:
* [[Gentoo/Gentoo_Bootstrap]]
* [[Gentoo/Linux_Configuration_Common]]
* [[Gentoo/Linux_Configuration_ASRock_Core_100HT]]
* [[Gentoo/Firewall_Using_Firehol]]
* [[Gentoo/Suspend_To_Disk_Using_uswsusp_and_genkernel|software suspend]]
* [[Gentoo/Bluetooth]]
* [[Gentoo/Sony_DualShock3_SixAxis|configuration]]
* [[Gentoo/USB_Power_Saving]]
* [[Gentoo/Secured_Portage_Sync]]
* [[Gentoo/Fbsplash]] I use splash to ease the acceptance of the machine with humans.

Profile:
 /etc/portage/make.profile -&gt; ../../var/gentoo/portage/profiles/default/linux/amd64/10.0/no-multilib

{{File|/etc/portage/make.conf|&lt;pre&gt;
CHOST=&quot;x86_64-pc-linux-gnu&quot;
CFLAGS=&quot;-O2 -march=native -fomit-frame-pointer -pipe&quot;
CXXFLAGS=&quot;${CFLAGS}&quot;
USE=&quot;${USE} mmx sse sse2 caps fam&quot;
USE=&quot;${USE} bluetooth alsa joystick&quot;
USE=&quot;${USE} kde qt4 qt3support X xinerama opengl&quot;
USE=&quot;${USE} jpeg jpeg2k tiff png svg&quot;
USE=&quot;${USE} mp3 ogg vorbis&quot;
USE=&quot;${USE} mpeg&quot;
USE=&quot;${USE} bidi&quot;
USE=&quot;${USE} lzma&quot;
USE=&quot;${USE} curl samba logrotate vim-syntax&quot;
USE=&quot;${USE} -cups -gnome -qt3 -handbook&quot;
USE=&quot;${USE} -cxx -ruby -perl -fortran -python -lua -java&quot;
USE=&quot;${USE} -berkdb -gdbm -branding -esd -gstreamer -semantic-desktop -hal&quot;
VIDEO_CARDS=&quot;intel&quot;
INPUT_DEVICES=&quot;evdev&quot;
&lt;/pre&gt;}}

Special USE flags:
{{Codeline|&lt;pre&gt;
media-video/vlc dbus id3tag ffmpeg aac a52 aalib taglib truetype cdda cddax cddb cdio dvd encode xv rtsp live ogmusepack run-as-root
media-libs/libsdl xv
&lt;/pre&gt;}}

== Video ==

I have found that connecting TV using VGA gives a better resolution than using the HDMI device, I was quite surprised.

There is one challenge though, how to make the computer boot with TV turned off and set up correct resolution at the absent of DDC, and how to ignore the HDMI port.

Ended up with the following X11 video configuration, which forces resolution and ignores DDC override.

{{File|/etc/X11/xorg.conf|&lt;pre&gt;
Section &quot;ServerLayout&quot;
        Identifier     &quot;Default&quot;
        Screen         &quot;Screen1&quot;
EndSection

Section &quot;ServerFlags&quot;
        Option      &quot;blank time&quot;    &quot;10&quot;    # 10 minutes
        Option      &quot;standby time&quot;  &quot;20&quot;
        Option      &quot;suspend time&quot;  &quot;30&quot;
        Option      &quot;off time&quot;      &quot;60&quot;
        Option      &quot;DefaultServerLayout&quot;   &quot;Default&quot;
EndSection

Section &quot;dri&quot;
        Group           0
        Mode            0666
EndSection

Section &quot;Extensions&quot;
        Option          &quot;Composite&quot;     &quot;Enable&quot;
EndSection

Section &quot;Monitor&quot;
        Identifier   &quot;none&quot;
        Option       &quot;Ignore&quot; &quot;true&quot;
EndSection

Section &quot;Monitor&quot;
        Identifier   &quot;Monitor1&quot;
        VendorName   &quot;Monitor Vendor&quot;
        ModelName    &quot;Monitor Model&quot;
        ModeLine     &quot;1360x768&quot;  85.50  1360 1424 1536 1792  768 771 777 795 +hsync +vsync
EndSection

Section &quot;Screen&quot;
        Identifier   &quot;Screen1&quot;
        Device       &quot;Card0&quot;
        Monitor      &quot;Monitor1&quot;
        Option       &quot;ConnectedMonitor&quot; &quot;Monitor1&quot;
        SubSection   &quot;Display&quot;
                Depth 24
                Modes &quot;1360x768&quot;
        EndSubSection
EndSection

Section &quot;Device&quot;
        Identifier  &quot;Card0&quot;
        Driver      &quot;intel&quot;
        VendorName  &quot;Intel Corporation&quot;
        BoardName   &quot;Arrandale Integrated Graphics Controller&quot;
        BusID       &quot;PCI:0:2:0&quot;
        Option      &quot;monitor-HDMI1&quot; &quot;none&quot;
        Option      &quot;monitor-VGA1&quot; &quot;Monitor1&quot;
EndSection
&lt;/pre&gt;}}

== Power ==

=== Common ===
{{File|/etc/hibernate/ususpend-ram.conf|&lt;pre&gt;
USuspendRamForce yes
&lt;/pre&gt;}}

=== Bluetooth ===

Disable bluetooth during sleep.

{{File|/etc/hibernate/common.conf|&lt;pre&gt;
OnSuspend 90 echo 0 &gt; /sys/class/rfkill/rfkill0/state
OnResume  90 echo 1 &gt; /sys/class/rfkill/rfkill0/state
&lt;/pre&gt;}}

=== Wakeup from LAN ===

{{Root|emerge sys-apps/ethtool}}

{{File|/etc/hibernate/common.conf|&lt;pre&gt;
OnSuspend 90 ethtool -s eth0 wol g
&lt;/pre&gt;}}

=== Wakeup from Input ===

In order to allow wakeup by remote control/keyboard, you need to determine which USB bus the receiver is connected, for example:

{{Root|lsusb}}
{{Codeline|&lt;pre&gt;
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 002 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 001 Device 002: ID 8087:0020 Intel Corp. Integrated Rate Matching Hub
Bus 002 Device 002: ID 8087:0020 Intel Corp. Integrated Rate Matching Hub
Bus 002 Device 003: ID 0a12:0001 Cambridge Silicon Radio, Ltd Bluetooth Dongle (HCI mode)
Bus 002 Device 004: ID 1241:0504 Belkin 
Bus 002 Device 005: ID 1241:0504 Belkin 
Bus 003 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 004 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub
&lt;/pre&gt;}}

&quot;Belkin&quot; is the device, and it resides at bus 002 device 004 and 005, now, let's see which PCI controller it is:

{{Root|ls -la /sys/bus/usb}}
{{Codeline|&lt;pre&gt;
total 0
drwxr-xr-x 2 root root 0 Nov 26 22:21 .
drwxr-xr-x 4 root root 0 Nov 26 22:21 ..
lrwxrwxrwx 1 root root 0 Nov 26 22:21 1-0:1.0 -&gt; ../../../devices/pci0000:00/0000:00:1a.0/usb1/1-0:1.0
lrwxrwxrwx 1 root root 0 Nov 26 22:21 1-1 -&gt; ../../../devices/pci0000:00/0000:00:1a.0/usb1/1-1
lrwxrwxrwx 1 root root 0 Nov 26 22:21 1-1:1.0 -&gt; ../../../devices/pci0000:00/0000:00:1a.0/usb1/1-1/1-1:1.0                                                                                                    
lrwxrwxrwx 1 root root 0 Nov 26 22:21 2-0:1.0 -&gt; ../../../devices/pci0000:00/0000:00:1d.0/usb2/2-0:1.0
lrwxrwxrwx 1 root root 0 Nov 26 22:21 2-1 -&gt; ../../../devices/pci0000:00/0000:00:1d.0/usb2/2-1
lrwxrwxrwx 1 root root 0 Nov 26 22:21 2-1.1 -&gt; ../../../devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.1
lrwxrwxrwx 1 root root 0 Nov 26 22:21 2-1:1.0 -&gt; ../../../devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1:1.0                                                                                                    
lrwxrwxrwx 1 root root 0 Nov 26 22:21 2-1.1:1.0 -&gt; ../../../devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.1/2-1.1:1.0                                                                                          
lrwxrwxrwx 1 root root 0 Nov 26 22:21 2-1.1:1.1 -&gt; ../../../devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.1/2-1.1:1.1                                                                                          
lrwxrwxrwx 1 root root 0 Nov 26 22:21 2-1.4 -&gt; ../../../devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.4
lrwxrwxrwx 1 root root 0 Nov 26 22:21 2-1.4:1.0 -&gt; ../../../devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.4/2-1.4:1.0                                                                                          
lrwxrwxrwx 1 root root 0 Nov 26 22:21 2-1.4:1.1 -&gt; ../../../devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.4/2-1.4:1.1                                                                                          
lrwxrwxrwx 1 root root 0 Nov 26 22:21 2-1.5 -&gt; ../../../devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.5
lrwxrwxrwx 1 root root 0 Nov 26 22:21 2-1.5:1.0 -&gt; ../../../devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.5/2-1.5:1.0                                                                                          
lrwxrwxrwx 1 root root 0 Nov 26 22:21 2-1.5:1.1 -&gt; ../../../devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.5/2-1.5:1.1                                                                                          
lrwxrwxrwx 1 root root 0 Nov 26 22:21 3-0:1.0 -&gt; ../../../devices/pci0000:00/0000:00:1c.1/0000:02:00.0/usb3/3-0:1.0                                                                                           
lrwxrwxrwx 1 root root 0 Nov 26 22:21 4-0:1.0 -&gt; ../../../devices/pci0000:00/0000:00:1c.1/0000:02:00.0/usb4/4-0:1.0                                                                                           
lrwxrwxrwx 1 root root 0 Nov 26 22:21 usb1 -&gt; ../../../devices/pci0000:00/0000:00:1a.0/usb1
lrwxrwxrwx 1 root root 0 Nov 26 22:21 usb2 -&gt; ../../../devices/pci0000:00/0000:00:1d.0/usb2
lrwxrwxrwx 1 root root 0 Nov 26 22:21 usb3 -&gt; ../../../devices/pci0000:00/0000:00:1c.1/0000:02:00.0/usb3                                                                                                      
lrwxrwxrwx 1 root root 0 Nov 26 22:21 usb4 -&gt; ../../../devices/pci0000:00/0000:00:1c.1/0000:02:00.0/usb4                                                                                                      
&lt;/pre&gt;}}

We can see that these devices are at pci0000:00/0000:00:1d.0.

Now, let's see which ACPI event it is:

{{Root|cat /proc/acpi/wakeup}}
{{Codeline|&lt;pre&gt;
Device  S-state   Status   Sysfs node
P0P1      S4    *disabled  
P0P3      S4    *disabled  
P0P4      S4    *disabled  pci:0000:00:04.0
P0P5      S4    *disabled  
P0P6      S4    *disabled  
BR1E      S4    *disabled  pci:0000:00:1e.0
CIR       S4    *disabled  pnp:00:06
EUSB      S4    *disabled  
USB0      S4    *disabled  pci:0000:00:1d.0
USB1      S4    *disabled  
USB2      S4    *disabled  
USB3      S4    *disabled  
USBE      S4    *disabled  
USB4      S4    *disabled  pci:0000:00:1a.0
USB5      S4    *disabled  
USB6      S4    *disabled  
BR20      S4    *disabled  pci:0000:00:1c.0
BR21      S4    *disabled  pci:0000:00:1c.1
BR22      S4    *disabled  
BR23      S4    *disabled  
BR24      S4    *disabled  
BR25      S4    *disabled  
BR26      S4    *disabled  
BR27      S4    *disabled  
&lt;/pre&gt;}}

It is USB0!!!

So add the following to ensure wakeup:
{{File|/etc/hibernate/ram.conf|&lt;pre&gt;
OnSuspend 90 cat /proc/acpi/wakeup | grep USB0 | grep disabled &gt; /dev/null &amp;&amp; echo USB0 &gt; /proc/acpi/wakeup || true
&lt;/pre&gt;}}

== Input ==

=== Acceleration ===

Both keyboard and remote control are acting as HID devices, however, I would like to have the keypad of remote control change radio stations.

I use {{Package|app-misc/actkbd}}

{{File|~/.actkbd/actkbd-kbd.conf|&lt;pre&gt;
79:key::&quot;/home/guest/Media/Radio/station1&quot;
80:key::&quot;/home/guest/Media/Radio/station2&quot;
81:key::&quot;/home/guest/Media/Radio/station3&quot;
85:key::&quot;/home/guest/Media/Radio/station4&quot;
76:key::&quot;/home/guest/Media/Radio/station5&quot;
82:key::&quot;/home/guest/Media/Radio/dvd&quot;
&lt;/pre&gt;}}

Determine keys is done by executing the actkbd in foreground and in maximum verbosity. Refer to package documentation.

I use KDE, the following runs the actkbd at login:

{{File|~/.kde4/Autostart/run-actkbd-kbd.sh|&lt;pre&gt;
#!/bin/sh
exec actkbd --device /dev/input//by-path/pci-0000:00:1d.0-usb-0:1.4:1.0-event-kbd --config ~/.actkbd/actkbd-kbd.conf
&lt;/pre&gt;}}

== User Interface ==

A user &quot;guest&quot; is defined, part of the following groups: audio, cdrom, users, games.

I use KDE as user interface, not much but usable.

{{Package|x11-misc/slim}} is used as login manager, with the following altered, to enable auto login of guest user:

{{File|/etc/slim.conf|&lt;pre&gt;
login_cmd           exec /bin/bash --login /etc/X11/Sessions/KDE-4
default_user        guest
auto_login          yes
&lt;/pre&gt;}}

== Extra Packages ==

* {{Package|kde-base|direct=yes}}
* {{Package|x11-misc/slim}}
* {{Package|app-misc/actkbd}}
* {{Package|media-video/vlc}}

== Games ==

I found the following games usable for my kids:
* {{Package|games-arcade/moleinvasion}} USE: {{USEFlag|music}}
* {{Package|games-arcade/pacmanarena}}
* {{Package|games-arcade/smc}} USE: {{USEFlag|music}}
* {{Package|games-arcade/supertux}}
* {{Package|games-emulation/stella}}, As for 3.4.1 for proper work with DualShock must use upstream trunk.
** [http://www.romnation.net/srv/roms/10602/atari2600/Tank-Plus-1977-Sears.html Tank Plus (1977) (Sears)]
** [http://www.romnation.net/srv/roms/10605/atari2600/Tape-Worm-1982-Spectravideo.html Tape Worm (1982) (Spectravideo)]
** [http://www.romnation.net/srv/roms/9260/atari2600/Breakout-Breakaway-IV-1978-Atari.html Breakout - Breakaway IV (1978)]
* {{Package|games-emulation/dosbox}}
** [http://www.dosgamesarchive.com/download/digger/ Digger]
** [http://www.abandonia.com/en/games/385/.html Test Driver]
** [http://www.dosgames.com/dl.php?filename=http://www.dosgames.com/files/gobman11.zip gobman]
* {{Package|games-sports/speed-dreams}}
* {{Package|games-sports/torcs}}
* {{Package|games-sports/trigger}}
{{File|~/.trigger/trigger.config|&lt;pre&gt;
        &lt;video
                width=&quot;1360&quot;
                height=&quot;768&quot;
                bpp=&quot;0&quot;
                
                fullscreen=&quot;yes&quot;
&lt;snip&gt;
        &lt;joystick enable=&quot;yes&quot;&gt;
&lt;snip&gt;
&lt;/pre&gt;}}
* {{Package|kde-base/kreversi}}

== Maintainer ==

[[User:Alonbl|Alon Bar-Lev]]

{{AuthorList|{{Author|Alon Bar-Lev|2011-11-17|type=original}}}}</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/Configuration Workstation</title>
    <id>45</id>
    <revision>
      <id>236</id>
      <timestamp>2013-06-05T20:59:07Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve">= Alon Bar-Lev's Gentoo Workstation =

I maintain a complex development workstation, there is some value in documenting it for other people to take what they like.

As a base, I use [[Gentoo/Gentoo_Bootstrap|Bootstrap]] and [[Gentoo/Gentoo_Configuration_Common|Gentoo Configuration]].

== Kernel ==

I use [[Gentoo/Linux_Configuration_Common|minimal]] module (when possible) kernel with {{Package|media-gfx/splashutils}}.
I use [[Gentoo/Fbsplash|splashutils]] because it makes the acceptance of Linux better for people that experiencing it at first.

Device specific configuration can be found at any of my [[Gentoo#Hardware|hardware article]].

To compile kernel, I use [http://alon.barlev.googlepages.com genkernel-utils] which uses genkernel and ease
[[Gentoo/Linux_Disk_Encryption_Using_LoopAES_And_SmartCards|disk encryption]] initramfs configuration, and allow stable
and none stable configuration to co-exist.

== Hardware ==

See [[Gentoo#Hardware|hardware articles]].

== Networking ==

I integrate networking as much as I can with OpenRC.

The following articles document my configuration:
* [[Gentoo/Openresolv]]
* [[Gentoo/Stealth_DHCP]]
* [[Gentoo/Firewall_Using_Firehol]]
* [[Gentoo/OpenVPN_Non_Root]]
* [[Gentoo/VM_Tap_Networking]]
* [[Gentoo/PPP_Client]]
* [[Gentoo/PPPoE_Client]]

Workstation is a complete network:


             +-----------------------------------------------+
             |                    INTERNET                   |
             +-----------------------------------------------+
               ^          ^          ^          ^          ^
               |          |          |          |          |
               |          |          |          |          |
               |          |          |          |          |
            GSM modem  Broadband   GSM modem  wired     wireless
               |          |          |          |          |
              ppp0       ppp1       ppp2       eth0       wlan0
               |          |          |          |          |
             +-----------------------------------------------+
             |               \\ | //                 \\ | // |
             |                 NAT     WORKSTATION     NAT   |
             |                    ^                      ^   |
             |  /-----NAT--&lt;-----\ \                      \  |
             +-----------------------------------------------+
               |                     |                     |
              vpn0                  br0                   usb0
               |                     |                     |
               |                +----+----+                |
               |                |         |                |
               V               vm0       vm1               V
             OFFICE             |         |             EMBEDDED
                              QEMU1     QEMU2

In words, workstation connects to the Internet via multiple coice of interfaces. It also provides
access to the Internet for embedded devices and virtual machines via NAT. DHCP is made using special
[[Gentoo/Stealth_DHCP|mode]] which hides computer indentity from DHCP server.

The virtual machines resides in their [[Gentoo/VM_Tap_Networking|own segment]] interacting with workstaion via br0 interface.

There is also VPN using [[Gentoo/OpenVPN_Non_Root|OpenVPN non root mode]] to office network, virtual machines can access this network via NAT.

All interfaces are protected by [[Gentoo/Firewall_Using_Firehol|firewall]].

To enable user wpa_supplicant access, I use the following:
{{File|/etc/wpa_supplicant/wpa_supplicant.conf|&lt;pre&gt;
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=myusers
&lt;/pre&gt;}}

As usually only wireless networking is working, we would like to switch off the wired and boardband interfaces, set the following:
{{File|/etc/rc.conf|&lt;pre&gt;
rc_hotplug=&quot;!net.eth0 !net.ppp0&quot;
&lt;/pre&gt;}}

== Security ==

On most of my mobile devices I [[Gentoo/Linux_Disk_Encryption_Using_LoopAES_And_SmartCards|encrypt]] the disk
using {{Package|sys-fs/loop-aes}} which is the most strong and fast cryptographic method I found. I use
{{Package|dev-libs/opensc}} compliant smartcard with CCID compliant reader using {{Package|dev-libs/openct}}.

I do not use {{Package|sys-apps/pcsc-lite}} as it is too complex, consume power as it busy loops, and does
not run in least privileged mode.

I use [[Gentoo/Firewall_Using_Firehol|firewall]] for all of my interfaces, with outgoing and incoming traffic rules.

To avoid man-in-the-middle attacks on portage synchronization, I always use [[Gentoo/Secured_Portage_Sync|signed snapshots]].

My X is running as [[Gentoo/Non_Root_Xorg-Server|non root]], not xdm.

== Power Management ==

I use [[Gentoo/Userspace_software_suspend|Usermode suspend]], with {{Package|sys-power/hibernate-script}} as wrapper, and
{{Package|sys-power/acpid}} as event managemet.

[[Getnoo/USB_Power_Saving|USB power]] down extends battery life, as long as it works, I use it.

== Gentoo Configuration ==

Based on [[Gentoo/Gentoo_Configuration_Common|Gentoo common configuration]].

{{File|/etc/portage/make.conf|&lt;pre&gt;
USE=&quot;${USE} bluetooth alsa joystick&quot;
USE=&quot;${USE} kde qt4 plasma X xv xinerama opengl&quot;
USE=&quot;${USE} jpeg jpeg2k tiff png svg&quot;
USE=&quot;${USE} mp3 ogg vorbis mpeg&quot;
USE=&quot;${USE} bidi&quot;
USE=&quot;${USE} lzma&quot;
USE=&quot;${USE} samba kerberos logrotate vim-syntax&quot;

INPUT_DEVICES=&quot;evdev&quot;
VIDEO_CARDS=&quot;intel&quot;
LINGUAS=&quot;en he&quot;

PORTDIR_OVERLAY=&quot;/usr/local/portage/local /usr/local/portage/alon-barlev-portage ${PORTDIR_OVERLAY}&quot;
&lt;/pre&gt;}}

{{File|/etc/portage/make.profile|&lt;pre&gt;
-&gt;../../var/gentoo/portage/profiles/default/linux/amd64/10.0/no-multilib
&lt;/pre&gt;}}

=== Important USE flags ===

{{File|/etc/portage/package.use/my-system.conf|&lt;pre&gt;
app-laptop/tp_smapi hdaps
app-crypt/aespipe static
sys-apps/loop-aes-losetup static
dev-libs/opensc -pcsc-lite openct doc
dev-libs/pkcs11-helper doc
media-gfx/splashutils mng fbcondecor
sys-apps/hal -crypt
sys-fs/loop-aes keyscrub
sys-fs/ntfsprogs -crypt
sys-power/suspend fbsplash -crypt threads
sys-auth/pambase consolekit # kde
sys-auth/pambase -kerberos
sys-apps/portage python3
&lt;/pre&gt;}}

{{File|/etc/portage/package.use/my-applications|&lt;pre&gt;
app-cdr/k3b ffmpeg dvd encode mad lame
app-text/poppler cairo # gimp
media-gfx/gimp gimpprint svg wmf pdf
app-office/libreoffice java
media-video/transcode a52 aac dvd
virtual/ffmpeg encode
media-video/ffmpeg aac a52 dts v4l xvid
media-video/vlc dbus ffmpeg aac a52 aalib taglib v4l truetype cdda cddax cddb cdio dvd encode rtsp live ogmusepack wma-fixed flac x264
media-gfx/ufraw exif lensfun hotpixels contrast gtk gimp
www-client/firefox libnotify system-sqlite
dev-db/sqlite secure-delete unlock-notify # firefox
x11-drivers/xf86-video-intel sna
&lt;/pre&gt;}}

{{File|/etc/portage/package.use/my-network.conf|&lt;pre&gt;
net-misc/openssh -ldap X509
net-misc/openvpn iproute2 pkcs11
net-print/cups ppds
net-analyzer/wireshark gtk
net-dialup/rp-pppoe -X
net-fs/samba ads ldap
&lt;/pre&gt;}}

=== Always none stable ===

 sys-kernel/gentoo-sources ~amd64
 sys-kernel/genkernel ~amd64          # I use recent kernel
 app-emulation/qemu-kvm ~amd64        # I use recent kernel
 media-gfx/splashutils ~amd64         # I use recent kernel
 sys-fs/loop-aes ~amd64               # I use recent kernel
 x11-drivers/xf86-video-intel ~amd64  # so far acceleration is not right

== Localization ==

[[Gentoo/Hebrew]].

== udev ==

Until https://bugs.launchpad.net/qemu/+bug/891625 resolved:

{{File|/etc/udev/rules.d/60-kvm.rules|&lt;pre&gt;
KERNEL==&quot;vhost-net&quot;,GROUP=&quot;kvm&quot;
&lt;/pre&gt;}}

== Desktop ==

=== X11 ===

I use only evdev input driver, without HAL or any other automation.

{{File|/etc/X11/xorg.conf|&lt;pre&gt;
Section &quot;dri&quot;
        Group           0
        Mode            0666
EndSection

Section &quot;ServerLayout&quot;
        Identifier     &quot;Default&quot;
        Screen      0  &quot;Screen0&quot; 0 0
        InputDevice    &quot;Mouse0&quot; &quot;CorePointer&quot;
        InputDevice    &quot;Keyboard0&quot; &quot;CoreKeyboard&quot;
EndSection

Section &quot;ServerFlags&quot;
        Option  &quot;blank time&quot;    &quot;10&quot;    # 10 minutes
        Option  &quot;standby time&quot;  &quot;20&quot;
        Option  &quot;suspend time&quot;  &quot;30&quot;
        Option  &quot;off time&quot;      &quot;60&quot;

#       Option  &quot;Xinerama&quot;      &quot;on&quot;

        Option  &quot;DefaultServerLayout&quot;   &quot;Default&quot;

        # xorg.bug#17925
        Option  &quot;AutoAddDevices&quot;        &quot;false&quot;
EndSection

Section &quot;Extensions&quot;
        Option          &quot;Composite&quot;     &quot;Enable&quot;
EndSection

Section &quot;InputDevice&quot;
        Identifier      &quot;Keyboard0&quot;
        Driver          &quot;evdev&quot;
        Option          &quot;Device&quot;        &quot;/dev/input/by-path/platform-i8042-serio-0-event-kbd&quot;
EndSection

Section &quot;InputDevice&quot;
        Identifier      &quot;Mouse0&quot;
        Driver          &quot;evdev&quot;
        Option          &quot;Device&quot;        &quot;/dev/input/by-path/platform-i8042-serio-2-event-mouse&quot;

        # Require for scroll
        Option          &quot;Buttons&quot;               &quot;3&quot;
        Option          &quot;EmulateWheel&quot;
        Option          &quot;EmulateWheelButton&quot;    &quot;2&quot;
EndSection

Section &quot;Monitor&quot;
        Identifier   &quot;Monitor0&quot;
EndSection

Section &quot;Device&quot;
        Identifier  &quot;Card0&quot;
        Driver      &quot;intel&quot;
        VendorName  &quot;Intel Corporation&quot;
        BoardName   &quot;Mobile 4 Series Chipset Integrated Graphics Controller&quot;
        BusID       &quot;PCI:0:2:0&quot;
EndSection

Section &quot;Screen&quot;
        Identifier &quot;Screen0&quot;
        Device     &quot;Card0&quot;
        Monitor    &quot;Monitor0&quot;

        # the following enables setting 2nd screen
        # on left/right top/bottom using xrandr.
        SubSection &quot;Display&quot;
                Viewport   0 0
                Depth     24
                Virtual         4000 4000
        EndSubSection
EndSection
&lt;/pre&gt;}}

=== KDE ===

I use KDE as my desktop, why? I do not understand gnome, and Qt looks right, including proper [[Gentoo/Hebrew]] support.

I use the following packages:
 kde-base/kdebase-startkde
 kde-base/ark
 kde-base/dolphin
 kde-base/kfind
 kde-base/kate
 kde-base/kcalc
 kde-base/kcharselect
 kde-base/kde-l10n
 kde-base/kdesdk-kioslaves
 kde-base/kdm
 kde-base/kget
 kde-base/kmenuedit
 kde-base/kmix
 kde-base/kolourpaint
 kde-base/konqueror
 kde-base/konsole
 kde-base/kscreensaver
 kde-base/ksnapshot
 kde-base/okular
 kde-base/kopete
 media-libs/phonon-vlc
 net-misc/knemo

{{File|/etc/portage/package.use/kde.conf|&lt;pre&gt;
kde-base/kwin xcomposite
kde-base/kdelibs spell udisks
kde-base/krdc vnc
media-libs/phonon vlc
x11-libs/qt-opengl qt3support
x11-libs/qt-declarative qt3support
x11-libs/qt-gui qt3support dbus mng # bluetooth
x11-libs/qt-sql qt3support
x11-libs/qt-core qt3support
sys-block/parted device-mapper # kde
sys-auth/consolekit policykit # kde
&lt;/pre&gt;}}

To enable gtk+ (firefox, gimp, wireshark...) integration to Qt:

{{Root|emerge x11-themes/oxygen-gtk}}

{{File|~/.gtkrc-2.0|&lt;pre&gt;
include &quot;/usr/share/themes/oxygen-gtk/gtk-2.0/gtkrc&quot;
style &quot;user-font&quot;
{
        font_name=&quot;Sans Serif&quot;
}
widget_class &quot;*&quot; style &quot;user-font&quot;

gtk-theme-name=&quot;oxygen-gtk&quot;
gtk-font-name=&quot;Sans Serif 8&quot;
&lt;/pre&gt;}}

{{Command|ln -s .gtkrc-2.0 ~/.gtkrc-2.0-kde}}

== Qemu ==

I use kvm

{{File|/etc/conf.d/modules|&lt;pre&gt;
modules=&quot;${modules} kvm-intel vhost-net&quot;
&lt;/pre&gt;}}

{{File|q|&lt;pre&gt;
#!/bin/sh

export SPICE_DEBUG_ALLOW_MC=1
qemu-system-x86_64 \
        -no-quit \
        -drive file=disk1.img \
        -net nic -net tap,ifname=vm0,script=/bin/true,vhost=on \
        -m 512 \
        -monitor tcp:127.0.0.1:4445,server,nowait \
        -localtime \
        -usbdevice tablet \
        -spice port=4446,disable-ticketing \
        -vnc 127.0.0.1:0
&lt;/pre&gt;}}

== Maintainer ==

[[User:Alonbl|Alon Bar-Lev]]

{{AuthorList|{{Author|Alon Bar-Lev|2011-12-02|type=original}}}}</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/Convert SPC PVK</title>
    <id>60</id>
    <revision>
      <id>169</id>
      <timestamp>2013-06-05T20:16:05Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <minor/>
      <comment>moved [[Convert SPC PVK]] to [[Gentoo/Convert SPC PVK]]</comment>
      <text xml:space="preserve">When enrolling a certificate using web interface, Verisign and others requires Microsoft platform. The Microsoft platform generate two files: SPC file which is UCS-2 bas64 blob of PKCS#7 certificate chain, and PVK which is Microsoft proprietary format of private key.

The following utility convert these files into standard PKCS#12 file.

{{File|spc+pvk-to-p12.sh|&lt;pre&gt;
#!/bin/sh
#
# Convert SPC+PVK to standard PKCS#12
# Written by Alon Bar-Lev &lt;alon.barlev@gmail.com&gt;
#

spc=&quot;$1&quot;
pvk=&quot;$2&quot;
import_pass=&quot;$3&quot;
export_pass=&quot;$4&quot;

if [ -z &quot;${export_pass}&quot; ]; then
	echo &quot;usage: $0 spc pvk in-pass out-pass&quot;
	exit 1
fi

openssl rsa -in &quot;${pvk}&quot; -inform PVK -passin &quot;pass:${import_pass}&quot; -out my.rsa -passout &quot;pass:${export_pass}&quot;

iconv -f UCS2 -t UTF8 &quot;${spc}&quot; | sed 's/\(...........\)/\1\n/g' | openssl enc -d -a | openssl pkcs7 -inform DER -print_certs | openssl pkcs12 -export -inkey my.rsa -passin &quot;pass:${export_pass}&quot; -out my.p12 -passout &quot;pass:${export_pass}&quot;
&lt;/pre&gt;}}</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/Fbsplash</title>
    <id>77</id>
    <revision>
      <id>229</id>
      <timestamp>2013-06-05T20:52:38Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve">Fbsplash is set of userspace utilities that control the framebuffer console and integrate with the system startup procedure to draw boot splash screens. Fbsplash scripts and utilities for gentoo are distributed as part of the {{Package|media-gfx/splashutils}} package.

== Prerequisites ==
In order for the fbsplash to do anything useful you will first need to configure and setup the [[Gentoo/Framebuffer]]. Also read the [[Gentoo/Initramfs#Kernel_Configuration|initramfs kernel configuration]] chapter for instruction on enabling initramfs support, which is needed for a splash initramfs image.

=== Kernel Configuration ===

If you intend to use a [[Gentoo/Framebuffer]] splash you'll need to make sure the driver is built-in, and not built as a module. You will also need to enable ''Framebuffer Console support'' and ''Support for the Framebuffer Console Decorations''. If the ''Enable Tileblitting'' option is turned on in ''Support for frame buffer devices'' in the kernel configuration, the framebuffer console decorations option will be invisible. Please make sure to turn it off.
{{Kernel|Kernel optional framebuffer configuration|&lt;pre&gt;
Device Drivers -&gt;
    Graphics support -&gt;
        &lt;*&gt; Support for frame buffer devices  ---&gt;
            Console display driver support  ---&gt;
                &lt;*&gt; Framebuffer Console support
                [ ] Enable Tile Blitting Support
                [*] Support for the Framebuffer Console Decorations
&lt;/pre&gt;}}

If you want to get the {{Key|F2}} key working to switch to verbose and silent when using a splash screen, enable the ''Event Interface'',
{{Kernel|enabling the Event Interface|&lt;pre&gt;
Device Drivers ---&gt;
    Input Device Support ---&gt;
        &lt;*&gt; Event Interface
&lt;/pre&gt;}}

== Installation ==
Make sure you enable the {{EnableFlag|fbcondecor}} USE-flag. Also note that there are themes that require the {{USEFlag|mng}} USE-flags, so enabling it is generally a good idea. {{Package|media-gfx/splashutils}} needs its dependencies compiled with {{EnableFlag|static-libs}} enabled, portage will inform you on which packages needs this flag enabled.
{{Root|emerge -avN splashutils}}

== Themes ==
Themes can be obtained by emerging {{Package|media-gfx/splash-themes-livecd}}, {{Package|media-gfx/splash-themes-gentoo}}, and/or {{Package|media-gfx/bootsplash-themes}}:
{{Root|emerge -av splash-themes-gentoo splash-themes-livecd bootsplash-themes}}
The {{Package|media-gfx/bootsplash-themes}} package will install to {{Path|/etc/bootsplash}}, but it will convert the themes automatically to splashutils compatible themes and moves them to {{Path|/etc/splash/}} as well, so there is no need for any manual conversion.

If you wish to set/preview a theme without booting you can use {{Codeline|splash_manager}}.  Note these commands must be run as root user (or sudo).
{{Root|&lt;nowiki&gt;splash_manager -c set --theme=livecd-2007.0 --tty=1&lt;/nowiki&gt;}}

This will change the theme on '''tty1''' to ''livecd-2007.0''. You can choose any theme in {{Path|/etc/splash}} that matches your current resolution. Now to see the theme go to tty1 by pressing {{Key|Ctrl+Alt+F1}}.

If you want to preview a theme in silent mode without reboot, then try
{{Root|&lt;nowiki&gt;splash_manager -c demo -t livecd-2007.0 -m s --steps=100&lt;/nowiki&gt;}}
Please note, don't run this command under X window.

For more reference please refer to
{{Root|&lt;nowiki&gt;splash_manager --help&lt;/nowiki&gt;}}

== Generating initramfs ==

=== The genkernel way ===

Assuming splash is livecd-2007.0 and required resolution is 1024x768:
{{Root|&lt;nowiki&gt;genkernel initramfs --splash=livecd-2007.0 --splash-res=1024x768 ...&lt;/nowiki&gt;}}

=== The manual way ===

To generate the [[Gentoo/Initramfs]] splash image, we use {{Codeline|splash_geninitramfs}} (you need to enable the fbcondecor_ctl use flag for media-gfx/splashutils). The syntax is,
{{Root|&lt;nowiki&gt;splash_geninitramfs --verbose --res NxN --generate /boot/initramfs-bootsplash theme&lt;/nowiki&gt;}}
The themes are located in {{Path|/etc/splash}}. So to generate a initramfs splash image with the ''gentoo'' theme with a resolution of ''1024x768'',
{{Root|&lt;nowiki&gt;splash_geninitramfs --verbose --res 1024x768 --generate /boot/initramfs-bootsplash gentoo&lt;/nowiki&gt;}}
The {{Path|/boot/initramfs-bootsplash}} initramfs image is now created.

If you already have a initramfs source directory, and want to just add the boot splash to it, use the copy switch instead,
{{Root|&lt;nowiki&gt;splash_geninitramfs --verbose --res NxN --copy /path/to/initramfsdir theme&lt;/nowiki&gt;}}
Replace {{Path|/path/to/initramfsdir}} with the path to your initramfs source directory. This will copy all required files to your initramfs source directory.

If you already have a initramfs image, and want to append the boot splash to it, use the append switch,
{{Root|&lt;nowiki&gt;splash_geninitramfs --verbose --res NxN --append /path/to/initramfsimage theme&lt;/nowiki&gt;}}
Replace {{Path|/path/to/initramfsimage}} with the path to your initramfs image.

Finally, if you want to check the content of the initramfs image,
{{Root|&lt;nowiki&gt;zcat /path/to/initramfsimage  | cpio --list&lt;/nowiki&gt;}}

== Configuring Bootloader ==
Fbsplash requires its own kernel command line option, which allows you to specify which theme should be used. In this case, the theme is ''natural_gentoo''. The other required option need to be ''verbose'' or ''silent''. If ''silent'' is set, it will hide all the bootup information. Otherwise, you will be shown all the bootup information on system startup. In the example below we use the ''verbose'' option and the theme ''natural_gentoo''. Note that we assume you have configured your [[Gentoo/Framebuffer]] correctly and already set your video= options. Also note the ''console=tty1'' (or ''CONSOLE=/dev/tty1'') option, this is also a requirment for the splash to display. Finally the actual initramfs image, adding a new ''initrd'' line below the ''kernel'' line tells GRUB to load the initramfs image aswell. Make sure to replace (hdX,Y) with your root device.
{{File|/boot/grub/grub.conf|&lt;pre&gt;
...
kernel /vmlinuz... video=... splash=verbose,theme:natural_gentoo console=tty1
initrd (hdX,Y)/boot/initramfs-bootsplash
..
&lt;/pre&gt;}}
To see full documentation of the kernel parameters specific to splash you need to look in {{Path|/usr/share/doc/splashutils*/kernel_parameters}} which should be included in splashutils. You should be able to see it by typing (this assumes that you have emerged splashutils).
{{Command|less /usr/share/doc/splashutils*/kernel_parameters}}

Example of full kernel command:
{{Codeline|&lt;pre&gt;
video=inteldrmfb:1920x1200-32@60 splash=silent,fadein,theme:livecd-2007.0 quiet console=tty1
&lt;/pre&gt;}}

== fbcondecor ==
To automatically set a background on framebuffer consoles at boot, you can use the fbcondecor init script :
{{Root|rc-update add fbcondecor default}}
You can select which tty(s) to set a background image to through the {{Codeline|FBCONDECOR_TTYS}} variable and to set the theme of each tty through the {{Codeline|FBCONDECOR_TTY_MAP}} variable.
{{File|/etc/conf.d/fbcondecor|&lt;pre&gt;
# On which TTYs should fbcondecor be enabled? Defaults to RC_TTY_NUMBER.
# FBCONDECOR_TTYS=&quot;1 2 3 4 5 6&quot;

# Allows to set different themes on different consoles
# format: &quot;&lt;console&gt;:&lt;theme&gt; &lt;console&gt;:&lt;theme&gt; (...)&quot;
# FBCONDECOR_TTY_MAP=&quot;1:emergence&quot;

&lt;/pre&gt;}}
=== Unpatched Kernel ===

If you happen to be using a vanilla kernel you will not have the ''Support for the Framebuffer Console Decorations'' option available, there are a few small steps you need make to enable this. First, you need to download the patch for your kernel from the developer of fbcondecor, Spock, [http://dev.gentoo.org/~spock/projects/fbcondecor/ site].

Apply the patch. Don't worry if the kernel version doesn't match exactly, as this patch is not that intrusive:
{{Root|cd /usr/src/linux}}
{{Root|wget http://dev.gentoo.org/~spock/projects/fbcondecor/archive/fbcondecor-XXXXX.patch}}
{{Root|patch -p1 &lt; fbcondecor-XXXXX.patch}}
Replace '''XXXXX''' with the version you require.

== Troubleshooting ==
=== Genkernel ===
Genkernel suports putting a splash into the initrd for early boot display of a splash screen, however, it will print lines over the splash, seemingly ignoring the &quot;CONSOLE=/dev/tty1&quot; from the kernel boot line.

To correct this, change in genkernel's initrd.defaults:
{{file|/usr/share/genkernel/defaults/initrd.defaults|
&lt;pre&gt;CONSOLE=/dev/console&lt;/pre&gt;}}
to:
{{file|/usr/share/genkernel/defaults/initrd.defaults|
&lt;pre&gt;CONSOLE=/dev/tty1&lt;/pre&gt;}}

Rebuild your initrd with:
{{Root|&lt;nowiki&gt;genkernel ramdisk --splash=name-of-splash --splash-res=your-resolution&lt;/nowiki&gt;}}

== External Links ==
[http://fbsplash.alanhaggai.org/ fbsplash Website]

[[Category:Tutorials]]</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/Firewall Using Firehol</title>
    <id>63</id>
    <revision>
      <id>237</id>
      <timestamp>2013-06-05T20:59:42Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve">= Firehol =

{{Package|net-firewall/firehol}} is a dream firewall to anyone with network experience, as it is very similar
to command prompt of Cisco etc.

It is iptables wrapper and front-end, no extra daemons or loads.

I use it desktop, servers, gateways.

== Manage ==

=== Kernel ===

{{Kernel|Netfilters|&lt;pre&gt;
  [*] Networking support  ---&gt; 
    Networking options  ---&gt;
      [*]   IP: TCP syncookie support
      [*] Network packet filtering framework (Netfilter)  ---&gt;
        [*]   Advanced netfilter configuration
          Core Netfilter Configuration  ---&gt;
            &lt;M&gt; For all none experimental
          IP: Netfilter Configuration  ---&gt;
            &lt;M&gt; For all none experimental none obsolete
&lt;/pre&gt;}}

Optional, set the following:
{{File|/etc/sysctl.conf|&lt;pre&gt;
net.ipv4.tcp_syncookies = 1
net.ipv4.conf.all.accept_source_route = 0
net.ipv4.conf.default.accept_source_route = 0
net.ipv4.icmp_echo_ignore_broadcasts = 1
&lt;/pre&gt;}}

Even more secured, for gateways, Set the following:
{{File|/etc/sysctl.conf|&lt;pre&gt;
net.ipv4.conf.all.accept_redirects = 0
net.ipv4.conf.default.accept_redirects = 0
net.ipv4.conf.all.secure_redirects = 0
net.ipv4.conf.default.secure_redirects = 0
&lt;/pre&gt;}}

=== Setup ===

{{Root|emerge net-firewall/firehol}}
{{Root|rc-update add firehol default}}
{{Root|/etc/init.d/firehol start}}

For each interface add:
{{File|/etc/conf.d/net|&lt;pre&gt;
rc_net_eth0_need=&quot;firewall&quot;
&lt;/pre&gt;}}

=== Reload ===

{{Root|/etc/init.d/firehol save}}

=== Files ===

Configuration
 /etc/firehol/firehol.conf

Services
 /etc/firehol/services/*.conf

== Simple Desktop ==

The following rules allow only outgoing communications:
{{File|/etc/firehol/firehol.conf|&lt;pre&gt;
version 5

interface any world
        policy  reject
        protection              strong  10/sec  10
        server  ident           reject  with tcp-reset

        client  all             accept
&lt;/pre&gt;}}

== Complex Desktop ==

The following example enables the following:
* Access public Internet via eth* wlan* ppp* interfaces outgoing communications only.
* Access of interfaces br0 (VMs, see [[Gentoo/VM_Tap_Networking]]), usb0, pan0 which are a mobile device with access to incoming communcations.
* Access of interface vpn0 (OpenVPN, see [[Gentoo/OpenVPN_Non_Root]]) communications only to VPN host.
* NAT between br0 (VMs, see [[Gentoo/VM_Tap_Networking]]) and usb0 to the Internet, to allow Internet access to these nodes.
* Standard rules includes Microsoft Domain integration and dropping Microsoft broadcasts.

{{File|/etc/firehol/firehol.conf|&lt;pre&gt;
version 5

my_standard_inet() {
        server  all             drop    dst     &quot;10.10.50.255&quot;
        server  all             drop    dst     &quot;255.255.255.255&quot;
        client  all             drop    dst     &quot;228.67.43.91&quot;  #rtsp something
        server  all             drop    dst     &quot;228.67.43.91&quot;  #rtsp something
        client  all             drop    dst     &quot;224.0.0.1&quot;     #igmp something
        server  all             drop    dst     &quot;224.0.0.1&quot;     #igmp something
#       client  netbios_dgm     drop
#       client  netbios_ns      drop
        server  netbios_dgm     drop
        server  netbios_ns      drop
        server  time            drop

        client  dhcp            accept
        client  cups            accept
        client  http            accept
        client  https           accept
        client  ftp             accept
        client  dns             accept
        client  icmp            accept
        client  imap            accept
        client  smtp            accept
        client  pop3            accept
        client  ssh             accept
        client  nntp            accept
        client  rdp             accept
        client  samba           accept
        client  telnet          accept
        client  ping            accept
        client  svn             accept
        client  git             accept
        client  cvspserver      accept
        client  ldap            accept
        client  ntp             accept
        client  krb             accept
        client  microsoft_ds    accept

        #gmail
        client  gmailsmtp       accept
        client  gmailimap       accept
        client  gmailpop3       accept
}

interface &quot;eth+ wlan+ ppp+&quot; inet1
        policy  reject
        protection              strong  10/sec  10
        server  ident           reject  with tcp-reset

        my_standard_inet

interface &quot;br0 usb0 pan0&quot; local1
        policy  reject
        protection              strong  10/sec  10
        server  ident           reject  with tcp-reset

        #standard
        my_standard_inet

        server  samba           accept
        server  ssh             accept
        server  dns             accept
        server  http            accept

interface &quot;vpn0&quot; vpn1
        policy  reject
        protection              strong  10/sec  10
        server  ident           reject  with tcp-reset

        #standard
        my_standard_inet

router tun_nat  inface &quot;eth+ wlan+ ppp+ vpn0&quot; outface &quot;br0 usb0&quot;
        route   ident           reject with tcp-reset
        server  ident           reject with tcp-reset
        masquerade              reverse

        #standard
        my_standard_inet
&lt;/pre&gt;}}

{{File|/etc/firehol/services/git.conf|&lt;pre&gt;
#FHVER: 1:213
server_git_ports=&quot;tcp/9418&quot;
client_git_ports=&quot;default&quot;
&lt;/pre&gt;}}

{{File|/etc/firehol/services/gmail.conf|&lt;pre&gt;
#FHVER: 1:213
server_gmailsmtp_ports=&quot;tcp/587 tcp/465&quot;
client_gmailsmtp_ports=&quot;default&quot;
server_gmailpop3_ports=&quot;tcp/995&quot;
client_gmailpop3_ports=&quot;default&quot;
server_gmailimap_ports=&quot;tcp/993&quot;
client_gmailimap_ports=&quot;default&quot;
&lt;/pre&gt;}}

{{File|/etc/firehol/services/svn.conf|&lt;pre&gt;
#FHVER: 1:213
server_svn_ports=&quot;tcp/3690&quot;
client_svn_ports=&quot;default&quot;
&lt;/pre&gt;}}

{{File|/etc/firehol/services/krb.conf|&lt;pre&gt;
#FHVER: 1:213
server_krb_ports=&quot;tcp/88 udp/88 udp/464 tcp/749 tcp/750&quot;
client_krb_ports=&quot;default&quot;
&lt;/pre&gt;}}

== NAT Gateway ==

Simple NAT Gateway configuration, allows any outgoing connection.
{{Codeline|&lt;pre&gt;
  Internet &lt;---&gt;(eth0)--NAT--Gatway(eth1) &lt;---&gt; Internal
&lt;/pre&gt;}}

{{File|/etc/firehol/firehol.conf|&lt;pre&gt;
version 5

interface &quot;eth0&quot; world
        policy  reject
        protection              strong  10/sec  10
        server  ident           reject  with tcp-reset

        client  all             accept

interface &quot;eth1&quot; internal
        policy  reject
        protection              strong  10/sec  10
        server  ident           reject  with tcp-reset

        client  all             accept

router tun_nat  inface &quot;eth0&quot; outface &quot;eth1&quot;
        route   ident           reject with tcp-reset
        server  ident           reject with tcp-reset
        masquerade              reverse

        client  all             accept
&lt;/pre&gt;}}

== OpenVPN Server ==

See [[Gentoo/OpenVPN_Server]].

== Maintainer ==

[[User:Alonbl|Alon Bar-Lev]]

{{AuthorList|{{Author|Alon Bar-Lev|2011-11-17|type=original}}}}

[[Category:Security]]
[[Category:Network]]</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/Gentoo Bootstrap</title>
    <id>70</id>
    <revision>
      <id>244</id>
      <timestamp>2013-06-05T21:03:52Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve">= Gentoo Bootstrap =

This is my quick guide for bootstrapping Gentoo installation.

== Startup ==

Boot from latest Gentoo install CD.

=== Networking ===

Make sure you have working network before start.

Create /etc/init.d/net.eth0 if not exist (recent install CDs dropped this for some reason):
{{Root|ln -s net.lo /etc/init.d/net.eth0}}

{{Root|/etc/init.d/net.eth0 start}}

=== Time ===

Very important to setup correct date/time so future makes will not break.

{{Root|ntpdate -u pool.ntp.org}}

=== Partitions ===

{{Root|fdisk /dev/sda}}

* Partition 1 ~50M bootable.
* Partition 2 2*RAM_SIZE.
* Partition 3 all the rest.

=== Create state3 ===

{{Root|mkfs -t ext2 /dev/sda1}}
{{Root|mkfs -t ext4 /dev/sda3}}
{{Root|mkswap /dev/sda2}}
{{Root|mount /dev/sda3 /mnt/gentoo}}
{{Root|mkdir /mnt/gentoo/boot}}
{{Root|mount /dev/sda1 /mnt/gentoo/boot}}
{{Root|cd /mnt/gentoo}}
{{Root|wget @STATE3@}}
{{Root|wget @PORTAGE_LATEST@}}
{{Root|tar -xpf @STAGE3@}}
{{Root|mkdir var/gentoo}}
{{Root|tar -C var/gentoo -xpf @PORTAGE-LATEST@}}
{{Root|rm @STATE3@ @PORTAGE_LATEST@}}
{{Root|cd /}}
{{Root|mount -t proc none /mnt/gentoo/proc}}
{{Root|cp /etc/resolv.conf /mnt/gentoo/etc}}
{{Root|chroot /mnt/gentoo /bin/bash}}
{{Root|env-update}}

== Initial settings ==

{{Root|passwd}}
{{Root|rm /etc/portage/make.profile}}
{{Root|ln -s ../../var/gentoo/portage/profiles/default/linux/amd64/10.0/no-multilib \
        /etc/portage/make.profile}}

{{File|/etc/portage/make.conf|&lt;pre&gt;
CHOST=&quot;x86_64-pc-linux-gnu&quot;
CFLAGS=&quot;-O2 -march=native -fomit-frame-pointer -pipe&quot;
CXXFLAGS=&quot;${CFLAGS}&quot;
MAKEOPTS=&quot;-j3&quot;
PORTDIR=&quot;/var/gentoo/portage&quot;
DISTDIR=&quot;/var/gentoo/distfiles&quot;
PKGDIR=&quot;/var/gentoo/packages&quot;
USE=&quot;${USE} -gnome -qt3 -handbook&quot;
USE=&quot;${USE} -cxx nocxx -ruby -perl -fortran -python -lua -java&quot;
USE=&quot;${USE} -berkdb -gdbm -hal -branding&quot;
&lt;/pre&gt;}}

{{File|/etc/portage/package.use|&lt;pre&gt;
sys-devel/gcc cxx -nocxx
&lt;/pre&gt;}}

Update:
* /etc/fstab
* /etc/locale.gen
* /etc/conf.d/hostname
* /etc/localtime - copy correct file from /usr/share/zoneinfo

== Update ==

{{Root|emerge --update --deep --newuse @world}}
{{Root|etc-update}}
{{Root|emerge --depclean}}
{{Root|emerge gentoolkit}}
{{Root|revdep-rebuild}}
{{Root|python-updater}}
{{Root|perl-cleaner --all}}
{{Root|emerge --depclean}}
{{Root|revdep-rebuild}}

== Cleanup ==

{{Root|rm -fr /lib32/* /usr/lib32/locale}}

== Base system ==

{{Root|&lt;nowiki&gt;emerge app-admin/syslog-ng net-dns/openresolv app-portage/gentoolkit app-editors/vim \
        net-misc/dhcpcd sys-apps/ifplugd sys-apps/iproute2 sys-apps/less sys-boot/syslinux net-misc/ntp\
        sys-kernel/genkernel sys-kernel/gentoo-sources sys-process/vixie-cron \
        app-admin/logrotate app-admin/sudo net-firewall/firehol sys-power/acpid&lt;/nowiki&gt;}}

== Kernel &amp; Bootloader ==

{{Root|&lt;nowiki&gt;genkernel --menuconfig --kernel-config=/etc/kernels/BASE_KERNEL_CONFIG all&lt;/nowiki&gt;}}

See: [[Gentoo/Linux_Configuration_Common]]

{{Root|extlinux --install /boot}}
{{Root|cat /usr/share/syslinux/mbr.bin &gt; /dev/sda}}
{{Root|cp /usr/share/syslinux/menu.c32 /boot}}

Update extlinux.conf see [[Gentoo/Syslinux_Bootloader]].

== Finalize ==

{{Root|rc-update add sshd default}}
{{Root|rc-update add ntpd default}}
{{Root|rc-update add syslog-ng default}}
{{Root|rc-update add vixie-cron default}}
{{Root|rc-update add acpid default}}

== Close up ==

{{Root|exit}}
{{Root|umount /mnt/gentoo/proc /mnt/gentoo/boot /mnt/gentoo}}
{{Root|reboot}}

== Configure system ==

* [[Gentoo/Gentoo_Configuration_Common]]
* [[Gentoo/Secured_Portage_Sync]]
* [[Gentoo/Firewall_Using_Firehol]]

== Success! ==

You have working Gentoo base.

== Maintainer ==

[[User:Alonbl|Alon Bar-Lev]]

{{AuthorList|{{Author|Alon Bar-Lev|2011-11-28|type=original}}}}</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/Gentoo Configuration Common</title>
    <id>71</id>
    <revision>
      <id>230</id>
      <timestamp>2013-06-05T20:53:26Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve">== Global Configuration ==

I keep portage at /var/gentoo, don't like to modify /usr.

{{File|/etc/portage/make.conf|&lt;pre&gt;
CHOST=&quot;x86_64-pc-linux-gnu&quot;
CFLAGS=&quot;-O2 -march=native -fomit-frame-pointer -pipe&quot;
CXXFLAGS=&quot;${CFLAGS}&quot;
MAKEOPTS=&quot;-j3&quot;                      # number of CPUs+1
PORTDIR=&quot;/var/gentoo/portage&quot;
DISTDIR=&quot;/var/gentoo/distfiles&quot;
PKGDIR=&quot;/var/gentoo/packages&quot;
PORTAGE_GPG_DIR=&quot;/etc/portage/gnupg&quot;
FEATURES=&quot;webrsync-gpg parallel-fetch userfetch userpriv usersandbox&quot;
EMERGE_DEFAULT_OPTS=&quot;--quiet-build=n&quot;
SYNC=&quot;&quot;

USE=&quot;${USE} mmx sse sse2 sse3 caps fam&quot;
USE=&quot;${USE} -gnome -handbook&quot;
USE=&quot;${USE} -cxx -ruby -perl -fortran -python -lua -java&quot;
USE=&quot;${USE} -berkdb -gdbm -hal -branding -gstreamer -semantic-desktop&quot;
USE=&quot;${USE} nocxx&quot; # temp
&lt;/pre&gt;}}

{{File|/etc/portage/make.profile|&lt;pre&gt;
-&gt;../../var/gentoo/portage/profiles/default/linux/amd64/10.0/no-multilib
&lt;/pre&gt;}}

== Licensing ==

Free open source licenses that are accepted for free usage.

Following is basic configuration of portage to allow only free licenses for a basic system.

Accept only free licenses:

{{File|/etc/portage/make.conf|&lt;pre&gt;
ACCEPT_LICENSE=&quot;-* @FSF-APPROVED @FSF-APPROVED-OTHER freedist Artistic&quot;
&lt;/pre&gt;}}

{{File|/etc/portage/package.license/system.conf|&lt;pre&gt;
app-arch/bzip2 BZIP2
app-arch/unzip Info-ZIP
app-arch/zip Info-ZIP
sys-apps/man-pages-posix man-pages-posix
sys-apps/tcp-wrappers tcp_wrappers_license
sys-devel/flex FLEX
sys-libs/cracklib CRACKLIB
dev-perl/Crypt-PasswdMD5 BEER-WARE
&lt;/pre&gt;}}

{{File|/etc/portage/package.license/tools.conf|&lt;pre&gt;
sys-apps/debianutils SMAIL
sys-process/lsof lsof
&lt;/pre&gt;}}

{{File|/etc/portage/package.license/x11.conf|&lt;pre&gt;
media-libs/mesa kilgard
x11-misc/imake imake
x11-misc/xkeyboard-config xkeyboard-config
x11-misc/xorg-cf-files xorg-cf-files
x11-proto/trapproto trapproto
x11-proto/xf86bigfontproto xf86bigfontproto
x11-proto/xf86rushproto xf86rushproto
media-libs/fontconfig fontconfig
&lt;/pre&gt;}}

== USE flags ==

{{File|/etc/portage/package.use/my-system.conf|&lt;pre&gt;
sys-devel/gcc cxx -nocxx
&lt;/pre&gt;}}

== Always none stable ==

 &lt;sys-apps/portage-9999 ~amd64 **     # sets
 net-firewall/firehol ~amd64          # no choice

== Kernel ==


The base of kernel configuration is [[Gentoo/Linux_Configuration_Common|here]].

Device specific configuration can be found at any of my [[Gentoo#Hardware|hardware article]].

== System ==

To make ntpd synchronize faster after power on, add:
{{File|/etc/conf.d/hwclock|&lt;pre&gt;
clock_systohc=&quot;YES&quot;
&lt;/pre&gt;}}

{{File|/etc/profile.d/editor.sh|&lt;pre&gt;
export PAGER=&quot;less&quot;
export EDITOR=&quot;vim&quot;
&lt;/pre&gt;}}

Set:
{{File|/etc/rc.conf|&lt;pre&gt;
rc_parallel=&quot;YES&quot;
rc_hotplug=&quot;*&quot;
&lt;/pre&gt;}}</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/Git</title>
    <id>80</id>
    <revision>
      <id>201</id>
      <timestamp>2013-06-05T20:20:19Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <minor/>
      <comment>moved [[Git]] to [[Gentoo/Git]]</comment>
      <text xml:space="preserve">== Introduction ==

[http://git-scm.com/ Git] is a version control system. It is used for keeping track of changes made to source code, etc.
The changes are often made by different people, though this is not necessary.
Similar tools include CVS, [[Subversion]], Mercurial, or Bazaar.
Git is distributed source control management system, which means it does not require a central repository.
Git can and often is used with a central repository workflow, though.

Git was originally developed by Linus Torvalds and friends for managing development of the Linux kernel.
It is relatively new, though many large projects have adopted it.

== Installation ==

{{Root|emerge --ask --verbose dev-vcs/git}}

This will install both a client and a server (disabled by default).

If you want to use gitk (visualisation tool), you should enable USE-Flag tk for dev-vcs/git.


== Client Usage ==

* Watch the presentation by Randal Schwartz: [http://video.google.com/videoplay?docid=-3999952944619245780].
* Git is documented through extensive man pages, which are replicated online. Go through the man pages: [http://www.kernel.org/pub/software/scm/git/ docs/].
* Go through the everyday Git docs: [http://www.kernel.org/pub/software/scm/git/docs/everyday.html].


== Setting up a network Server ==

This is how to set up a server which serves read-only content.

In order to set up a server, the default location for repositories is '''/var/git'''.
Here is the simplest way to do it.

=== Server configuration file ===

Make your git-daemon configuration file (in /etc/conf.d) look like this:

{{File|/etc/conf.d/git-daemon|&lt;pre&gt;
&lt;nowiki&gt;# conf.d file for git-daemon
#
# Please check man 1 git-daemon for more information about the options
# git-daemon accepts. You MUST edit this to include your repositories you wish
# to serve.
#
# Some of the meaningful options are:
#   --syslog      --- Enables syslog logging
#   --verbose     --- Enables verbose logging
#   --export-all  --- Exports all repositories
#   --port=XXXX   --- Starts in port XXXX instead of 9418
#
GITDAEMON_OPTS=&quot;--syslog --enable=receive-pack --export-all --base-path=/var/git /var/git&quot;

# To run an anonymous git safely, the following user should be able to only
# read your Git repositories. It should not able able to write to anywhere on
# your system, esp. not the repositories.
GIT_USER=&quot;nobody&quot;
GIT_GROUP=&quot;nobody&quot;
&lt;/nowiki&gt;&lt;/pre&gt;
}}

What that does:
* Makes the &quot;jail root&quot; /var/git by specifying that at the end.
* Allows anything that looks like a repository to be exportable with the --export-all option. If you want more limitation, please remove this option and touch a file named git-daemon-export-ok
* Creates &quot;virtual resources&quot; of any repositories exported, by making the jail root prepended to all requests (git://server/blah looks for /var/git/blah).
* It should be noticed that all the repositories have write access to all the world. Use the --enable=receive-pack carefully only in trusted LAN

Check if the /var/git directory exists (otherwise git will not start). If not

{{Root|mkdir /var/git
chown nobody.nobody /var/git}}

Then start the daemon:

{{Root|/etc/init.d/git-daemon start}}

For some reason, it may take once or twice (it will error with '''!!''' instead of '''OK''').

=== Setting up repositories ===

First, the daemon will be run as nobody, so become nobody:

{{Root|sudo -u nobody -s}}

And execute all further commands in that shell.

First, create a project directory inside of the daemon's root directory (thought of as a jail root):

{{Command|&lt;nowiki&gt;cd /var/git
mkdir myproject&lt;/nowiki&gt;}}

Next, put all the files in there. This is the directory which will be cloned (&quot;checked out&quot; in more centralized terminology).

Finally, make it into a GIT repository: {{Command|git init}}

If you have multiple projects, create one directory for each according to the above steps.

If clients wish to check out the project, tell them to run:

{{Command|git clone git://your-server.com/path/to/myproject localdir}}

== Multi User Git Server ==

When pushing into Git server using ssh, the ownership of the new files are associated with the user who performs the push.
This does not allow other users to use the same repository. One solution is to change the default umask of a user, however,
this will effect more than the Git operations.

A proper solution can be established using POSIX access control lists.

Enable ACLs in kernel, for example for ext4 filesystem, use:
{{Kernel||&lt;pre&gt;
    File systems  ---&gt;
      &lt;*&gt; The Extended 4 (ext4) filesystem
      [*]   Ext4 extended attributes
      [*]     Ext4 POSIX Access Control Lists
&lt;/pre&gt;}}

Add &quot;acl&quot; to mount options:
{{File|/etc/fstab|&lt;pre&gt;
/dev/sda3               /               ext4            noatime,acl 0 1
&lt;/pre&gt;}}

Create gitusers group:
{{Root|groupadd gitusers}}

For each Git repository REPOS:
{{Root|setfacl -R -d -m g:gitusers:rwX &quot;${REPOS}&quot;}}

The above will set default read and write access to gitusers groups for every file created within repository.

Now members of gitusers group can push/pull repository.

== See Also ==
* [[gitosis]]
* [http://scie.nti.st/2007/11/14/hosting-git-repositories-the-easy-and-secure-way Hosting Git repositories using gitosis]

[[Category:Revision Control Systems]]

[[pl:Git]]
[[tr:Git]]</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/Hebrew</title>
    <id>75</id>
    <revision>
      <id>145</id>
      <timestamp>2013-06-05T20:12:30Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <minor/>
      <comment>moved [[Hebrew]] to [[Gentoo/Hebrew]]</comment>
      <text xml:space="preserve">= Kernel =

{{Kernel||&lt;pre&gt;
Filesystems ---&gt;
  -*- Native language support ---&gt;
    &lt;M&gt; Codepage 437 (United States, Canada)
    &lt;M&gt; Codepage 862 (Hebrew)
    &lt;M&gt; Hebrew charsets (ISO-8859-8, CP1255)
    &lt;M&gt; NLS ISO 8859-1 (Latin 1; Western European Languages)
    &lt;M&gt; NLS UTF-8
&lt;/pre&gt;}}

{{File|/etc/conf.d/modules|&lt;pre&gt;
modules=&quot;${modules}
nls-utf8
nls-iso8859-1
nls-cp1255
&quot;
&lt;/pre&gt;}}

= System =

{{File|/etc/portage/make.conf|&lt;pre&gt;
USE=&quot;${USE} bidi&quot;
LINGUAS=&quot;en he&quot;
&lt;/pre&gt;}}

{{File|/etc/locale.gen|&lt;pre&gt;
en_US ISO-8859-1
en_US.UTF-8 UTF-8
he_IL ISO-8859-8
he_IL.UTF-8 UTF-8
&lt;/pre&gt;}}

{{File|/etc/env.d/02locale|&lt;pre&gt;
LANG=&quot;he_IL.UTF-8&quot;
LC_CTYPE=&quot;en_US.UTF-8&quot;
LC_NUMERIC=&quot;he_IL.UTF-8&quot;
LC_TIME=&quot;en_US.UTF-8&quot;
LC_COLLATE=&quot;he_IL.UTF-8&quot;
LC_MONETARY=&quot;he_IL.UTF-8&quot;
LC_MESSAGES=&quot;en_US.UTF-8&quot;
LC_PAPER=&quot;he_IL.UTF-8&quot;
LC_NAME=&quot;he_IL.UTF-8&quot;
LC_ADDRESS=&quot;he_IL.UTF-8&quot;
LC_TELEPHONE=&quot;he_IL.UTF-8&quot;
LC_MEASUREMENT=&quot;he_IL.UTF-8&quot;
LC_IDENTIFICATION=&quot;he_IL.UTF-8&quot;
&lt;/pre&gt;}}

{{Root|env-update}}
{{Root|locale-gen}}

= Mount media =

== VFAT  ==

{{Root|&lt;nowiki&gt;mount -o iocharset=cp1255,utf8 /dev/sda1 /mnt/tmp&lt;/nowiki&gt;}}

== NTFS ==

{{Root|mount -o utf8 /dev/sda1 /mnt/tmp}}

== SMB ==

{{Root|&lt;nowiki&gt;mount -t cifs -o iocharset=utf8,username=user1 //server/share&lt;/nowiki&gt;}}

= Desktop =

== Fonts ==

Basic font to enable system:

{{Root|emerge media-fonts/dejavu}}

Usually no other font is needed, the following fonts adds some spice:

* {{Package|media-fonts/culmus}}
* {{Package|media-fonts/free-bangla-font}}
* {{Package|media-fonts/freefonts}}
* {{Package|media-fonts/intlfonts}}
* {{Package|media-fonts/urw-fonts}}

== KDE ==


{{Root|emerge kde-base/kde-l10n}}

SystemSettings-&gt;Input Devices
{{Codeline|&lt;pre&gt;
  Layouts

    Layout Indicator
      [X] Show layout indicator
      [O] Show flag

    Switching Policy
      [O] Window

    [V] Configure layouts
      us English (US)
      il Hebrew default
      il Hebrew Hebrew (lyx) &lt;-- if you want NIKUD

  Advanced

    [V] Configure keyboard options
      [V] Keys(s) to change layout
        [V] Alt+Shift
&lt;/pre&gt;}}

For &lt;Shift&gt;&lt;Alt&gt;&lt;Tab&gt; to work (Reverse window switching&gt; a patch is needed for xorg-server. See https://bugs.freedesktop.org/show_bug.cgi?id=865.

= Applications =

== vlc ==

Make sure you translate subtitles to utf-8
{{Command|iconv -f CP1255 -t UTF-8 &lt; in &gt; out}}

= Servers =

== Samba Server ==

Set the following:
{{File|/etc/samba/smb.conf|&lt;pre&gt;
        dos charset = CP1255
        unix charset = UTF-8
        display charset = UTF-8
        short preserve case = yes
        preserve case = yes
&lt;/pre&gt;}}

= Samples =

== {{Package|www-client/firefox}} ==

[http://www.mechon-mamre.org/c/ct/c0101.htm Machon Mamre]

[[File:Firefox_Hebrew_Genesis.jpg]]

== {{Package|app-text/bibletime}} ==

Use: Frank Ruehl CLM font.

[[File:Bibletime_Hebrew_Genesis.jpg]]

== {{Package|app-office/libreoffice}} ==

Use dejavu fonts as much as possible.

[[File:libreoffice_Hebrew.jpg]]

= Maintainer =

[[User:Alonbl|Alon Bar-Lev]]

{{AuthorList|{{Author|Alon Bar-Lev|2011-11-17|type=original}}}}

[[Category:Localization]]
[[Category:Servers]]
[[Category:Software]]</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/Intel Integrated Graphics Controller</title>
    <id>47</id>
    <revision>
      <id>171</id>
      <timestamp>2013-06-05T20:16:35Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <minor/>
      <comment>moved [[Intel Integrated Graphics Controller]] to [[Gentoo/Intel Integrated Graphics Controller]]</comment>
      <text xml:space="preserve">= Intel Integrated Graphics Controller =

Most Pentium-M computers have Intel Integrated Graphics controller in addition to more powerful one. As Intel cooperate with Open Source development, using this video device is usually more stable even if it lacks some features.

PCI
 00:02.0 VGA compatible controller [0300]: Intel Corporation Mobile 4 Series Chipset Integrated Graphics Controller [8086:2a42] (rev 07)

== Kernel ==

{{Kernel||&lt;pre&gt;
  Device Drivers  ---&gt;
    Graphics support  ---&gt;
      &lt;*&gt; /dev/agpgart (AGP Support)  ---&gt; 
        &lt;*&gt;   Intel 440LX/BX/GX, I8xx and E7x05 chipset support
      &lt;*&gt; Direct Rendering Manager (XFree86 4.1.0 and higher DRI support)  ---&gt;
        &lt;*&gt;   Intel 8xx/9xx/G3x/G4x/HD Graphics
        [*]     Enable modesetting on intel by default 
&lt;/pre&gt;}}

== Framebuffer ==

Driver is inteldrmfb, for example, use the following kernel parameters:
  video=inteldrmfb:1920x1200-32@60

== X11 ==

{{File|/etc/portage/make.conf|&lt;pre&gt;
USE=&quot;${USE} xv&quot;
VIDEO_CARDS=&quot;intel&quot;
&lt;/pre&gt;}}

Enable some more acceleration:
{{File|/etc/portage/package.use/x11.conf|&lt;pre&gt;
x11-drivers/xf86-video-intel sna
&lt;/pre&gt;}}

{{Root|emerge --update --deep --newuse @world}}

No need for any special switches, xorg-server will properly detect the card and work. xrandr utility can be used to manipulate the resolution, ports, placement.

{{Root|X -configure}}</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/Iwlwifi</title>
    <id>78</id>
    <revision>
      <id>203</id>
      <timestamp>2013-06-05T20:20:48Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <minor/>
      <comment>moved [[Iwlwifi]] to [[Gentoo/Iwlwifi]]</comment>
      <text xml:space="preserve">iwlwifi is Intel's open source driver for their newer wireless network adapters (Intel PRO/Wireless 3945ABG/BG and newer). The driver is included in the linux kernel since version 2.6.24.

== Basic Setup ==

=== Kernel Setup ===

Enable the &quot;mac80211&quot; WLAN stack and crypto options for WEP, WPA and WPA2:

{{Kernel| |&lt;pre&gt;
[*] Networking support  ---&gt;
  -*-   Wireless  ---&gt;
    &lt;M&gt;   cfg80211 - wireless configuration API
    [*]     enable powersave by default
    [*]     cfg80211 wireless extensions compatibility
    [*]   Wireless extensions sysfs files
    &lt;M&gt;   Common routines for IEEE802.11 drivers
    &lt;M&gt;   Generic IEEE 802.11 Networking Stack (mac80211)
  &lt;M&gt;   RF switch subsystem support  ---&gt;

[*] Cryptographic API  ---&gt;
    --- Cryptographic API
    &lt;M&gt;   Cryptographic algorithm manager
    &lt;M&gt;   SHA1 digest algorithm
    &lt;M&gt;   SHA224 and SHA256 digest algorithm
    &lt;M&gt;   ECB support
    &lt;M&gt;   CBC support
    &lt;M&gt;   PCBC support
    &lt;M&gt;   AES cipher algorithms
    &lt;M&gt;   ARC4 cipher algorithm
    &lt;M&gt;   Michael MIC keyed digest algorithm
&lt;/pre&gt;}}

Then, be sure you have activated the option &quot;Prompt for development and/or incomplete code/drivers&quot; in the &quot;General Setup&quot; section of the kernel configuration:

{{Kernel| |&lt;pre&gt;
General Setup ---&gt;
    [*] Prompt for development and/or incomplete code/drivers
&lt;/pre&gt;}}

Otherwise you won't be able to access the iwlwifi driver options in the kernel configuration!

Later on, you will also have to install the corresponding microcode file for your iwlwifi network adapter (it is, of course, available in portage). The iwlwifi driver loads this file at startup. To get this working, we need to enable the kernel's firmware_loader infrastructure:

{{Kernel| |&lt;pre&gt;
Device Drivers ---&gt;
    Generic Driver Options ---&gt;
        [*] Userspace firmware loading support
&lt;/pre&gt;}}

IMPORTANT: For the next steps, it is highly recommended to compile the drivers as kernel modules (&lt;M&gt; instead of &lt;*&gt;). This is because the driver needs access to the file system (i.e. /lib/firmware) to load the firmware. If you compile the driver as built-in, it will not be able to load the (essential) firmware since the file systems are mounted *after* the kernel has been loaded.

=== Kernels &gt;=3.1.0 ===

Here is an example of a configuration for an Intel 5100 card.

{{Kernel| |&lt;pre&gt;
Device Drivers ---&gt;
    [*] Network device support  ---&gt;
      [*]   Wireless LAN  ---&gt;
        &lt;M&gt;   Intel Wireless WiFi Next Gen AGN - Wireless-N/Advanced-N/Ultimate-N (iwlagn)
&lt;/pre&gt;}}

=== Kernels &gt;=2.6.30 ===

Starting with 2.6.30, some of the options have been moved or renamed. For instance, the LED support.
Here is an example of a configuration for an Intel 5100 card.

{{Kernel| |&lt;pre&gt;
Device Drivers ---&gt;
    [*] Network device support ---&gt;
        [*] Wireless LAN ---&gt;
            [*] Wireless LAN (IEEE 802.11)
            &lt;M&gt; Intel Wireless Wifi
            [*]   Enable LED support in iwlagn and iwl3945 drivers
            [*]   Enable Spectrum Measurement in iwlagn driver
            [*]   Enable full debugging output in iwlagn and iwl3945 drivers
            &lt;M&gt;   Intel Wireless WiFi Next Gen AGN (iwlagn)
            [*]     Intel Wireless WiFi 4965AGN
            [*]     Intel Wireless WiFi 5000AGN; Intel WiFi Link 1000, 6000, and 6050 Series

&lt;/pre&gt;}}

=== Kernels &gt;=2.6.26 ===

If you have an Intel PRO/Wireless 3945AGB/BG Network Connection adapter, activate the iwl3945 driver:

{{Kernel| |&lt;pre&gt;
Device Drivers ---&gt;
    [*] Network device support ---&gt;
        [*] Wireless LAN ---&gt;
            [*] Wireless LAN (IEEE 802.11)
            &lt;*&gt; Intel Wireless Wifi Core
            [*] IWLWIFI RF kill support
            &lt; &gt; Intel Wireless WiFi 4965AGN
            &lt;M&gt; Intel PRO/Wireless 3945ABG/BG Network Connection
            [*]   Enable Spectrum Measurement in iwl3945 drivers
&lt;/pre&gt;}}

Or if you have an Intel Wireless WiFi 4965AGN adapter, activate the iwl4965 driver:

{{Kernel| |&lt;pre&gt;
Device Drivers ---&gt;
    [*] Network device support ---&gt;
        [*] Wireless LAN ---&gt;
            [*] Wireless LAN (IEEE 802.11)
            &lt;*&gt; Intel Wireless Wifi Core
            [*] IWLWIFI RF kill support
            &lt;M&gt; Intel Wireless WiFi 4965AGN
            [*]   Enable 802.11n HT features in iwl4965 driver
            [*]   Enable Spectrum Measurement in iwl4965 driver
            [*]   Enable Sensitivity Calibration in iwl4965 driver
            &lt; &gt; Intel PRO/Wireless 3945ABG/BG Network Connection
&lt;/pre&gt;}}

There is also now support for the WLAN LEDs, but be aware, that the LED blinks a lot when there is traffic:

{{Kernel| |&lt;pre&gt;
Device Drivers ---&gt;
    [*] Network device support ---&gt;
        [*] Wireless LAN ---&gt;
            [*] Wireless LAN (IEEE 802.11)
            &lt;M&gt; Intel PRO/Wireless 3945ABG/BG Network Connection
            [*]   Enable LEDS features in iwl3945 driver
&lt;/pre&gt;}}


=== Kernel 2.6.25 ===

If you have an Intel PRO/Wireless 3945AGB/BG Network Connection adapter, activate the iwl3945 driver:

{{Kernel| |&lt;pre&gt;
Device Drivers ---&gt;
    [*] Network device support ---&gt;
        [*] Wireless LAN ---&gt;
            [*] Wireless LAN (IEEE 802.11)
            &lt;M&gt;   Intel PRO/Wireless 3945ABG/BG Network Connection
            [*]     Enable Wireless QoS in iwl3945 driver
            [*]     Enable Spectrum Measurement in iwl3945 drivers
&lt;/pre&gt;}}

Or if you have an Intel Wireless WiFi 4965AGN adapter, activate the iwl4965 driver:

{{Kernel| |&lt;pre&gt;
Device Drivers ---&gt;
    [*] Network device support ---&gt;
        [*] Wireless LAN ---&gt;
            [*] Wireless LAN (IEEE 802.11)
            &lt;M&gt;   Intel Wireless WiFi 4965AGN
            [*]     Enable Wireless QoS in iwl4965 driver
            [*]       Enable 802.11n HT features in iwl4965 driver
            [*]     Enable Spectrum Measurement in iwl4965 driver
            [*]     Enable Sensitivity Calibration in iwl4965 driver
&lt;/pre&gt;}}





{{Note|In the past (when?), if you had LED support enabled in your old .config, `make oldconfig' will not preserve this option}}



=== Software Setup - Installing the microcode files ===

You have to install the corresponding firmware/microcode for your iwlwifi network device in order to become really useful as a wireless adapter.

Here is a short (and not complete) overview about what the microcode does, taken from the file README.iwlwifi-3945-ucode that is shipped with the microcode package [http://gentoo-portage.com/Search?search=sys-firmware/iwl3945-ucode iwl3945-ucode] from portage:

{{Note| Quote: README.iwlwifi-3945-ucode

The file iwlwifi-3945.ucode provided in this package is required to be present on your system in order for the Intel PRO/Wireless 3945ABG/BG Network Connection Adapter driver for Linux (iwlwifi-3945) to be able to operate on your system.

On adapter initialization, and at varying times during the uptime of the adapter, the microcode is loaded into the RAM on the network adapter. The microcode provides the low level MAC features including radio control and high precision timing events (backoff, transmit, etc.) while also providing varying levels of packet filtering which can be used to keep the host from having to handle packets that are not of interest given the current operating mode of the device.}}

To install the microcode, simply emerge {{Package|sys-firmware/iwl3945-ucode|direct=yes}}:

{{Root|emerge -av sys-firmware/iwl3945-ucode}}

or, respectively {{Package|sys-firmware/iwl4965-ucode|direct=yes}}:

{{Root|emerge -av sys-firmware/iwl4965-ucode}}

or, if you have a Intel Wifi Link 5100/5300 {{Package|sys-firmware/iwl5000-ucode|direct=yes}}:

{{Root|emerge -av sys-firmware/iwl5000-ucode}}

If you have a Intel Wifi Link 6000, then you need {{Package|sys-firmware/iwl6000-ucode|direct=yes}} (see [http://bugs.gentoo.org/show_bug.cgi?id=304875]).

{{Root|emerge -av sys-firmware/iwl6000-ucode}}

If the required microcode/firmware is not in portage yet, then the latest microcode/firmware can be obtained at [http://intellinuxwireless.org/?n=downloads].

It is also recommended to check the README files of the microcode packages, as they contain other useful information for setting up the device. You can usually find them in /usr/share/doc/iwl3945-ucode-*/ or /usr/share/doc/iwl4965-ucode-*/ respectively, where * is to be replaced with the package version.

For further configuration follow the [http://www.gentoo.org/doc/en/handbook/handbook-x86.xml?part=4&amp;chap=4 Gentoo Handbook].

=== Networking ===

For easy desktop configuration of your wireless adapter, use either [[NetworkManager]] or [[wicd]]. NetworkManager is ''heavier'', with more dependencies, but with better integration across many applications. wicd is more lightweight. Both wrap wpa_supplicant, and make changing networks often easier. If you use either, you may ignore the next section. 


==== wpa_supplicant ====

If you want to use wpa_supplicant directly, here is how to configure it.

{{Root|emerge net-wireless/wpa_supplicant}}

{{File|/etc/conf.d/net|&lt;pre&gt;
modules=&quot;wpa_supplicant&quot;
config_wlan0=&quot;dhcp&quot;
wpa_cli_wlan0=&quot;-G3600&quot;
wpa_supplicant_wlan0=&quot;-D nl80211&quot;
&lt;/pre&gt;}}

{{Root|ln -s net.lo /etc/init.d/net.wlan0}}
{{Root|/etc/init.d/net.wlan0 start}}

== Advanced Topics ==

There are a few things you can play with through the sysfs interface /sys/bus/pci/drivers/iwl3945/00*/*

=== Monitor mode ===

To learn how set your card into [http://www.wikipedia.org/wiki/Monitor_mode monitor mode], see the guide at [http://aircrack-ng.org/doku.php?id=iwl3945 aircrack-ng.org].

=== Hibernate (kernels &lt; 3.0.0 only) ===

{{Note|Starting from Linux-3.0.0 no need tweaking networking during suspend, you can safely skip this}}

The hibernate package needs to be told to restart the networking interface when hibernate resumes. The networking interface (includes and is not limited to: apipa arping ccwgroup macchanger macnet rename iwconfig essidnet iptunnel ifconfig pppd system dhcpcd ip6to4 ifconfig pppd dhcpcd) needs to be restarted when hibernation is invoked.

The hibernate package contains a convenient mechanism to restart the networking interface. The hibernate configuration file {{Path|common.conf}} contains a section for networking:
{{File|/etc/hibernate/common.conf|&lt;pre&gt;
### network
# DownInterfaces eth0
# UpInterfaces auto &lt;/pre&gt;}}
 
Try to do this: uncomment the resume interface operation declarations and set it to the interface of your wireless interface. 
{{File|/etc/hibernate/common.conf|&lt;pre&gt;
### network
DownInterfaces wlan0
UpInterfaces auto &lt;/pre&gt;}}

== Troubleshooting ==

=== Switching from ipw3945 ===

If you switched from [http://www.gentoo-wiki.info/Ipw3945 ipw3945], you should unmerge everything that belonged to ipw3945. Also you may want to clean up your device names. Problems occur here because some drivers refer to your wireless interface as wlan0, some as ethX. You need to reconfigure /etc/udev/rules.d/70-persistent-net or recreate the rules there. You can use udevadm to recreate the rules #udevadm trigger --subsystem-match=net

Occasionally switching from ipw3945 to iwlwifi will not work because of some missing symlinks. See [http://forums.gentoo.org/viewtopic-t-710359-highlight-iwlwifi.html iwl3945 + wpa_supplicant + hardware switch] for a detailed description. 
In summary:
{{Root|&lt;pre&gt;cd /etc/init.d
ln -sfn net.lo net.wlan0&lt;/pre&gt;}}

=== My WLAN LED does not work ? ===

Support is added since kernel 2.6.26.

=== iwl4965: iwlwifi-4965-1.ucode firmware file req failed: Reason -2 ===

This error indicate a firmware version/filename mismatch. Just rename the file to whatever iwlwifi displays in this case: iwlwifi-4965-1.ucode
If this fails, try an alternate version, perhaps net-wireless/iwl4965-ucode-228.57.1.21.

=== Problem with wpa_supplicant and association ===

If the AP SSID is hidden or there multiple SSIDs with the same name, be sure that ap_scan does not exist or is commented out in /etc/wpa_supplicant/wpa_supplicant.conf.

=== Netmount starting too early ===

Netmount crapped out because the network was not ready. The solution, from [http://www.mail-archive.com/gentoo-user@lists.gentoo.org/msg51325.html this gentoo-user post] is to edit /etc/conf.d/rc so that the Wifi is not started by udev, e.g., RC_PLUG_SERVICES=&quot;!net.wlan&quot;.

=== Unable to associate with access point (AP) and 'iwlist wlan0 scanning' says 'Interface doesn't support scanning' ===

Try to do this:
{{Root|&lt;pre&gt;modprobe -r iwl3945
modprobe iwl3945 disable_hw_scan=1&lt;/pre&gt;}}
If 'iwlist wlan0 scanning' now works, create /etc/modprobe.d/iwl3945 and run update-modules like this:
{{Root|&lt;pre&gt;echo &quot;options iwl3945 disable_hw_scan=1&quot; &gt; /etc/modprobe.d/iwl3945
update-modules&lt;/pre&gt;}}
When I got this message I did it the other way around:
{{Root|&lt;pre&gt;modprobe -r iwl3945
modprobe iwl3945 disable_hw_scan=0&lt;/pre&gt;}}
And then I was able to scan. If you are also able to scan after changing to 0 you can do the following to make the change permanent:
{{Root|&lt;pre&gt;echo &quot;options iwl3945 disable_hw_scan=0&quot; &gt; /etc/modprobe.d/iwl3945
update-modules&lt;/pre&gt;}}

=== Unable to associate with access point (AP) that uses WEP and 'MAC is in deep sleep&quot; in /var/log/messages ===

Check if your /etc/conf.d/net ESSID contains any special characters and if yes, the key_ESSID=&quot;&lt;something&gt;&quot; should no longer contain '_' in stead of the special characters - in stead write the real ESSID. E.g. if ESSID is 'Rødgrød', use key_Rødgrød=&quot;&lt;something&gt;&quot;, NOT key_R_dgr_d=&quot;&lt;something&gt;&quot;.

If you want to debug why /etc/init.d/net.wlan0 start fails, use /etc/init.d/net.wlan0 --debug --verbose start to see the steps. The above was found like that, the output showed that WEP was disabled.

=== Switching to Ad-Hoc mode doesn't work ===

If you are using iwconfig and trying to switch to Ad-hoc mode, but keep getting the following error:

{{Root|&lt;pre&gt;Error for wireless request &quot;Set Mode&quot; (8B06) :
    SET failed on device wlan0 ; Operation not supported.&lt;/pre&gt;}}

The issue probably relates to the new CRDA regulatory stuffs in &gt;=2.6.28 kernels.  See [http://intellinuxwireless.org/bugzilla/show_bug.cgi?id=1894 this bug on intellinuxwireless.org] for more info and how to fix.

=== RTNETLINK answers: Unknown error 132 ===

If you get this error after trying to bring up your WLAN interface (see the following two examples), then your kernel driver might try to access the wrong microcode/firmware.

{{Root|&lt;pre&gt;
 * Starting wlan0
RTNETLINK answers: Unknown error 132
RTNETLINK answers: Unknown error 132
 *   Starting wpa_supplicant on wlan0 ...
RTNETLINK answers: No such file or directory
SIOCSIFFLAGS: No such file or directory
Could not set interface 'wlan0' UP       [ ok ]
 *   Starting wpa_cli on wlan0 ...       [ ok ]
 *     Backgrounding ...
&lt;/pre&gt;}}

{{Root|&lt;pre&gt; # ifconfig wlan0 up
SIOCSIFFLAGS: No such file or directory
&lt;/pre&gt;}}

In this case, run ''dmesg''. If you get the following messages, then you have either installed no microcode/firmware or the wrong one.

{{Code|$ dmesg|&lt;pre&gt;
...
firmware.sh[7080]: Cannot find  firmware file 'iwlwifi-6000-4.ucode'
klogd: [  692.155992] iwlagn 0000:03:00.0: iwlwifi-6000-3.ucode firmware file req failed: -2
klogd: [  692.155996] iwlagn 0000:03:00.0: firmware: requesting iwlwifi-6000-2.ucode
firmware.sh[7086]: Cannot find  firmware file 'iwlwifi-6000-3.ucode'
klogd: [  692.162868] iwlagn 0000:03:00.0: iwlwifi-6000-2.ucode firmware file req failed: -2
klogd: [  692.162873] iwlagn 0000:03:00.0: firmware: requesting iwlwifi-6000-1.ucode
firmware.sh[7092]: Cannot find  firmware file 'iwlwifi-6000-2.ucode'
iwlagn 0000:03:00.0: iwlwifi-6000-1.ucode firmware file req failed: -2
iwlagn 0000:03:00.0: Could not read microcode: -2
firmware.sh[7108]: Cannot find  firmware file 'iwlwifi-6000-1.ucode'
...
&lt;/pre&gt;}}

The microcode/firmware is installed in /lib/firmware/. If there is no microcode/firmware file or a wrong one, which does not match any microcode/firmware listed in ''dmesg'' output, then you have to install one of them (in this case iwlwifi-6000-4.ucode, iwlwifi-6000-3.ucode, iwlwifi-6000-2.ucode, or iwlwifi-6000-1.ucode). Afterwards reboot your system (just removing and loading the interface kernel driver didn't work).

In this example a Intel WiFi Link 6000 interface is used that requires microcode/firmware iwlwifi-6000-4.ucode. However, microcode/firmware iwlwifi-5000-2.ucode is installed.

{{Code|$ ls -l /lib/firmware/|&lt;pre&gt;
...
-rw-r--r-- 1 root root 353240 Mar 19 20:55 iwlwifi-5000-2.ucode
...
&lt;/pre&gt;}}

If you are sure that you have the correct microcode installed, it could be that your interface is software blocked. Please try the following:

{{Root|&lt;pre&gt;$ rfkill unblock all&lt;/pre&gt;}}

=== Authentication with 00:ef:dd:cc:bb:aa timed out ===

If everything is going well (there are no errors in the syslog see below) but there is always a timeout during authentication, then your access point might has MAC-based access control enabled. Check your access point whether MAC-based access control is enabled and add your WLAN interface's MAC address to this list. Afterwards, a successful authentication should be possible.

If your notebook is sometimes able to connect and other times not and you use WEP 40/128-bit for security. Take a look what you choosed for authentication. There are two modes &quot;open system&quot; and &quot;shared key&quot;. After I changed to &quot;open system&quot; the problem was solved.

{{File|/var/log/syslog|&lt;pre&gt;
...
wlan0: deauthenticating from 00:ef:dd:cc:bb:aa by local choice (reason=3)
wlan0: direct probe to AP 00:ef:dd:cc:bb:aa (try 1)
wlan0: direct probe to AP 00:ef:dd:cc:bb:aa (try 2)
wlan0: direct probe to AP 00:ef:dd:cc:bb:aa (try 3)
wlan0: direct probe to AP 00:ef:dd:cc:bb:aa timed out
...
&lt;/pre&gt;}}

== Links ==

* [http://intellinuxwireless.org/?p=iwlwifi iwlwifi website]
* [http://www.gentoo.org/doc/en/handbook/handbook-x86.xml?part=4&amp;chap=4 Gentoo wireless LAN howto]

[[Category:Intel]]
[[Category:Wireless]]

[[de:Iwlwifi]]</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/Java Using IcedTea</title>
    <id>73</id>
    <revision>
      <id>147</id>
      <timestamp>2013-06-05T20:12:44Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <minor/>
      <comment>moved [[Java Using IcedTea]] to [[Gentoo/Java Using IcedTea]]</comment>
      <text xml:space="preserve">= Java Using IcedTea =

{{Package|dev-java/icedtea}} or OpenJDK can be used in order to build java from source, however there is egg and chicken scenario as icedtea needs java to be built, unfortunate the java herd does not help in the process, similar to {{Package|sys-devel/crossdev}}.

This documents how to compile java the Gentoo way, build from sources.

== Bootstrap ==

First we need a java in our system... we will use gcc's gcj.

{{File|/etc/portage/package.use/java-bootstrap.conf|&lt;pre&gt;
sys-devel/gcc gcj
&lt;/pre&gt;}}
{{File|/etc/portage/package.accept_keywords/java-bootstrap.conf|&lt;pre&gt;
dev-java/ecj-gcj ~amd64
&lt;/pre&gt;}}

{{Root|emerge --oneshot sys-devel/gcc}}
{{Root|emerge --update --deep --newuse @world}}
{{Root|emerge dev-java/gcj-jdk}}

== IcedTea ==

{{File|/etc/portage/package.use/my-java.conf|&lt;pre&gt;
dev-java/antlr java
dev-java/icedtea -nsplugin -webstart -source
&lt;/pre&gt;}}
{{File|/etc/portage/package.accept_keywords/my-java.conf|&lt;pre&gt;
dev-java/icedtea:6 ~amd64
&lt;/pre&gt;}}
{{Root|emerge dev-java/icedtea}}
{{Root|&lt;nowiki&gt;java-config --set-system-vm=icedtea-6&lt;/nowiki&gt;}}

== Cleanup ==

{{Root|rm /etc/portage/package.use/java-bootstrap.conf /etc/portage/package.accept_keywords/java-bootstrap.conf}}
{{Root|emerge --unmerge dev-java/gcj-jdk}}
{{Root|emerge --update --deep --newuse @world}}
{{Root|emerge --depclean}}

== Maintainer ==

[[User:Alonbl|Alon Bar-Lev]]

{{AuthorList|{{Author|Alon Bar-Lev|2011-11-17|type=original}}}}


[[Category:Software]]</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/Lenovo ThinkPad T400</title>
    <id>76</id>
    <revision>
      <id>173</id>
      <timestamp>2013-06-05T20:16:51Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <minor/>
      <comment>moved [[Lenovo ThinkPad T400]] to [[Gentoo/Lenovo ThinkPad T400]]</comment>
      <text xml:space="preserve">This article is dedicated to getting hardware specific to the Lenovo ThinkPad T400, T500 and W500 with switchable graphics, and the W700 working smoothly on Gentoo Linux.

==Hardware overview==

The ThinkPad W500/T500/T400 laptops are built around Intel's Centrino 2 platform, including Intel WiFi Link 5100/5300 and the Intel G45 chipset which includes the Intel GMA X4500HD.
Some of these have only the Intel GMA X4500HD (henceforth called &quot;integrated&quot;) and some have both the integrated graphics card and an ATI card (henceforth called &quot;discrete&quot;) based on the M86 GPU (T500/W500) and on the M82 GPU (T400).

Apparently, the only difference between the T500 and the W500 on the motherboard is the amount of graphics memory installed (512MB for the W500 and a very meager 256MB for the T500).
The card on the T500 is marketed as a Radeon HD 3650 and the card on the W500 as a Mobility FireGL V5700.
The extent to which the graphics drivers differ for each case is yet to be known.

Most of the configuration for these laptops will be similar to that of any other Centrino 2 based laptop, another part similar to other computers with ATI cards and another similar to that of other ThinkPads.
So, it is important to keep an eye on what goes on on similar laptops and on these laptops on other distros.
That is why a section of Links exists at the bottom of this topic.

==Installation Prep==

The Thinkpad T400 laptop features a sata CD/DVD drive which is not recognized by the Gentoo minimal install CD.  The Ubuntu LiveCD works well with the T400 for installing Gentoo.

Boot into a LiveCD and switch to root in a terminal.  Through this terminal we are ready to continue on with setting up Gentoo following the handbook at Chapter4, &quot;Preparing the Disks&quot;.

There is a slight difference when you get to chapter 6 of the Handbook, when it comes time to mount the proc and dev filesystems the commands will be as follows since we're within a LiveCD environment:
{{Root|&lt;pre&gt;
#mount -o bind /proc /mnt/gentoo/proc/
#mount -o bind /dev /mnt/gentoo/dev/&lt;/pre&gt;}}

{{Note|Not a lot of people had problems booting the minimal install CD, maybe try it first. The work around stays here in case someone else has this problem.}}

There are also some constraints affecting the choice of kernel version. Because of the wireless card, it's really convenient to choose a kernel version after 2.6.27 as it becomes available in the unmodified kernel tree. However, it must be taken into consideration that the ATI closed source driver must compile a kernel module.
The first version of the ATI driver which has a kernel module that compiles without changes on (and takes into consideration) kernel 2.6.27 is the 8.55.2 version, available as the ati-driver-8.552 series of ebuilds. I suggest a kernel &gt;=2.6.27 as a starting point. The choice of kernel does not affecting the building of most packages.

Whereas all ATI driver versions apparently support Xorg 6.9 to Xorg 7.4, there has been some trouble getting them to work with Xorg 7.1. For example, a libglx.so file for this Xorg version seemed to be missing and 3D acceleration never worked. Apparently, it was unanimous on the Gentoo user mailing list that unmasking Xorg 7.4 using package.keywords was a better option. It is more or less important to make this choice at the beginning, so as to avoid building the whole world twice with two different versions of Xorg.

Initial install is also a good time to decide which version of GCC you would like to run.  You could choose GCC4.3, because that version of GCC supports &quot;-march=core2&quot;, which provides optimizations specific to Core2Duo processors. Refer to the Gentoo GCC Upgrade Guide for comprehensive instructions on upgrading GCC, as well as the example below for configuring {{Path|/etc/make.conf}} using the proper CFLAGS.

This is an example of my current /etc/make.conf. Note that the &quot;-march=core2&quot; CFLAGS setting can only be set after the upgrade to GCC4.3 is complete, and prior to that the recommended safe setting for GCC4.1 is &quot;-march=nocona&quot; - that is what you will initially use for your CFLAGS setting. Once you have upgraded to GCC4.3, you will want to update the CFLAGS setting and recompile all packages on the system using &quot;emerge -eav world&quot;. It's best to do this before installing other software packages - this will recompile your entire Gentoo system from source. Refer to the Gentoo GCC Upgrade Guide for comprehensive instructions on upgrading GCC
{{File|/etc/make.conf|&lt;pre&gt;#Example CFLAGS in /etc/make.conf for T400 on GCC4.3
CFLAGS=&quot;-O2 -march=native -pipe -fomit-frame-pointer&quot;
CXXFLAGS=&quot;${CFLAGS}&quot;
CHOST=&quot;i686-pc-linux-gnu&quot;
MAKEOPTS=&quot;-j4&quot; 
GENTOO_MIRRORS=&quot;http://gentoo.chem.wisc.edu/gentoo/&quot; 
SYNC=&quot;rsync://rsync.namerica.gentoo.org/gentoo-portage&quot; 
USE=&quot;avahi dbus gnome gtk hal ieee1394 laptop lm_sensors sse sse2 sse3 threads wifi&quot; 
VIDEO_CARDS=&quot;intel vesa radeon&quot;
INPUT_DEVICES=&quot;evdev keyboard mouse synaptics&quot; 
LINGUAS=&quot;en&quot;&lt;/pre&gt;}}

To build the graphic support you may want to use, you would place the following into {{Path|/etc/make.conf}}:
{{File|/etc/make.conf|&lt;pre&gt;VIDEO_CARDS=&quot;intel vesa radeon fglrx&quot;&lt;/pre&gt;}}

Further optimizations can be found in the [[Safe Cflags]] page. I use -msse4.1 as well.

==How do switchable graphics look like low level?==

The BIOS has three settings regarding the graphics card: integrated, switchable and discrete.
When it is set to integrated, the BIOS turns off the power to the ATI card, text mode output is done via the Intel card (characters appear anti-aliased) and only the Intel card appears on lspci, and the output is the following:
&lt;pre&gt;
00:02.0 VGA compatible controller: Intel Corporation Device 2a42 (rev 07) (prog-if 00 [VGA controller])
	Subsystem: Lenovo Device 2114
	Flags: bus master, fast devsel, latency 0, IRQ 11
	Memory at f4400000 (64-bit, non-prefetchable) [size=4M]
	Memory at d0000000 (64-bit, prefetchable) [size=256M]
	I/O ports at 1800 [size=8]
	Capabilities: [90] Message Signalled Interrupts: Mask- 64bit- Queue=0/0 Enable-
	Capabilities: [d0] Power Management version 3
&lt;/pre&gt;

When the BIOS is set to discrete, the BIOS turns off the power to the Intel card, sets the Subsystem ID of the ATI card to 2127 (on the W500), text mode output is done via the ATI card (characters are not anti-aliased) and only the ATI card appears on lspci:
&lt;pre&gt;
01:00.0 VGA compatible controller: ATI Technologies Inc Device 9591 (prog-if 00 [VGA controller])
	Subsystem: Lenovo Device 2127
	Flags: bus master, fast devsel, latency 0, IRQ 16
	Memory at d0000000 (32-bit, prefetchable) [size=256M]
	I/O ports at 2000 [size=256]
	Memory at cfff0000 (32-bit, non-prefetchable) [size=64K]
	[virtual] Expansion ROM at cff00000 [disabled] [size=128K]
	Capabilities: [50] Power Management version 3
	Capabilities: [58] Express Legacy Endpoint, MSI 00
	Capabilities: [a0] Message Signalled Interrupts: Mask- 64bit+ Queue=0/0 Enable-
	Capabilities: [100] Vendor Specific Information &lt;?&gt;
	Kernel driver in use: fglrx_pci
	Kernel modules: fglrx
&lt;/pre&gt;

When the BIOS is set to switchable, the BIOS turns on both cards, and sets the Subsystem ID of the ATI card to 2126 (on the W500), text mode output is done via the Intel card (anti-aliased) and both cards appear on lspci:
&lt;pre&gt;
00:02.0 VGA compatible controller: Intel Corporation Device 2a42 (rev 07) (prog-if 00 [VGA controller])
	Subsystem: Lenovo Device 2115
	Flags: bus master, fast devsel, latency 0, IRQ 11
	Memory at fc000000 (64-bit, non-prefetchable) [size=4M]
	Memory at d0000000 (64-bit, prefetchable) [size=256M]
	I/O ports at 1800 [size=8]
	Capabilities: [90] Message Signalled Interrupts: Mask- 64bit- Queue=0/0 Enable-
	Capabilities: [d0] Power Management version 3

01:00.0 VGA compatible controller: ATI Technologies Inc Device 9591 (prog-if 00 [VGA controller])
	Subsystem: Lenovo Device 2126
	Flags: bus master, fast devsel, latency 0, IRQ 11
	Memory at c0000000 (32-bit, prefetchable) [size=256M]
	I/O ports at 2000 [disabled] [size=256]
	Memory at bfff0000 (32-bit, non-prefetchable) [size=64K]
	[virtual] Expansion ROM at bff00000 [disabled] [size=128K]
	Capabilities: [50] Power Management version 3
	Capabilities: [58] Express Legacy Endpoint, MSI 00
	Capabilities: [a0] Message Signalled Interrupts: Mask- 64bit+ Queue=0/0 Enable-
	Capabilities: [100] Vendor Specific Information &lt;?&gt;
	Kernel modules: fglrx
&lt;/pre&gt;

{{Warning|When the BIOS is set to switchable, both graphics cards are powered; not only that, the ATI card clock will be at its highest speed unless the X graphics driver has stepped it down. For this reason, your laptop will get very, very hot. You might want to remove your laptop's battery until you managed to get a configuration which keeps your laptop cool.}}

==Getting graphics to work==
First, you must choose between the graphics drivers available for your [[Graphics_drivers#AMD.2FATI|AMD/ATI card]] and follow the linked guide.
===Discrete and fglrx===

The following kernel config options are required in order for the fglrx kernel module to compile and work correctly.
Note that DRM must be built as a module and that the radeon DRM module cannot be loaded; actually, it does not work with this card (this information may be obsolete. Please test and update).
Note still, that using fglrx requires setting display to discrete in the BIOS; apparently the chipID is not know to the driver if you choose switchable.

{{Kernel|fglrx kernel config|&lt;pre&gt;
Processor type and features  ---&gt;
     [ ] Paravirtualized guest support  ---&gt;
     [*] MTRR (Memory Type Range Register) support
     [ ]   MTRR cleanup support
     [*]   x86 PAT support

Bus options (PCI etc.)  ---&gt;
     [*] PCI Express support
     [*] Enable deprecated pci_find_* API

Device Drivers  ---&gt;
         Graphics support  ---&gt;
     &lt;M&gt; Direct Rendering Manager (XFree86 4.1.0 and higher DRI support)  ---&gt;
     &lt;M&gt;   Intel 830M, 845G, 852GM, 855GM, 865G
     &lt;M&gt;     i915 driver

Kernel hacking  ---&gt;
     [*] Magic SysRq key
     [*] Enable unused/obsolete exported symbols
&lt;/pre&gt;}}

For more specific help, see the specific [[Fglrx|topic on fglrx]]. 
{{Note|Because it must compile a kernel module, using the fglrx driver constrains your choice of kernel version. Make sure you choose compatible versions of kernel and fglrx.}}

==== MTRR ====

MTRR may be incorrect in its default form, to verify execute:
{{Root|cat /proc/mtrr}}

This should look like the following, notice the write-back and write-combining.
{{Codeline|&lt;pre&gt;
reg00: base=0x13c000000 ( 5056MB), size=   64MB, count=1: uncachable
reg01: base=0x0be000000 ( 3040MB), size=   32MB, count=1: uncachable
reg02: base=0x000000000 (    0MB), size= 2048MB, count=1: write-back
reg03: base=0x080000000 ( 2048MB), size= 1024MB, count=1: write-back
reg04: base=0x100000000 ( 4096MB), size= 1024MB, count=1: write-back
reg05: base=0x0bde00000 ( 3038MB), size=    2MB, count=1: uncachable
reg06: base=0x0d0000000 ( 3328MB), size=  256MB, count=1: write-combining
&lt;/pre&gt;}}

Example of alternate working configuration:
{{Kernel||&lt;pre&gt;
  Processor type and features  ---&gt;
    -*- MTRR (Memory Type Range Register) support
    [*]   MTRR cleanup support
    (1)     MTRR cleanup enable value (0-1)
    (2)     MTRR cleanup spare reg num (0-7)
&lt;/pre&gt;}}

===Discrete Graphics, radeon===

Following [http://www.gentoo.org/doc/en/xorg-config.xml instructions for installing X] using the radeon driver and setting the bios to discrete, you can get discrete graphics working without any issue.  The [http://www.gentoo.org/doc/en/ati-faq.xml Gentoo Linux ATI FAQ] and the [[Radeon|Radeon article]] may also be helpful for this.  Once complete, X should  autoconfigure xorg.conf to work with this configuration.

This is an example of the relevant section in xorg.conf which was automatically created using the radeon driver by following the [http://www.gentoo.org/doc/en/xorg-config.xml instructions for installing X]:

{{File|/etc/X11/xorg.conf|&lt;pre&gt;
 Section &quot;Device&quot;
   #Intel Identifier &quot;Card0&quot; 
   Driver &quot;vesa&quot; 
   VendorName &quot;Intel Corporation&quot; 
   BoardName &quot;Unknown Board&quot; 
   BusID &quot;PCI:0:2:0&quot;
 
   #AMD ATI Radeon
   Driver &quot;radeon&quot;  
   BusID &quot;PCI:1:0:0&quot;
   VendorName &quot;ATI Technologies Inc&quot;
   BoardName &quot;Unknown Board&quot;
 EndSection 
&lt;/pre&gt;}}

===Integrated and intel===
See the [[Intel_GMA|Intel Graphics]] article for more details. While following that guide, remember to build the kernel DRM as module to allow loading of the fglrx/radeon DRM for the discrete GPU, should you want to use discrete graphics later on.

{{File|/etc/X11/xorg.conf|&lt;pre&gt;
Section &quot;Device&quot;
  Identifier  &quot;Intel GMA x4500MHD&quot;
  Driver      &quot;intel&quot;

# For better OpenGL performance
  Option      &quot;FramebufferCompression&quot; &quot;False&quot;
EndSection&lt;/pre&gt;}}

{{Warning|While the intel driver works with the BIOS display setting set either to integrated or to switchable, if you leave it on the switchable setting, the radeon card will be powered and because no driver is lowering its clock frequency, it will use a lot of power and generate a lot of heat. It is advisable to avoid this, even if just to avoid too much battery wear.}}

===Getting both to work===

Ideally, we would wish to set display to switchable in the BIOS and then start X using either the Intel or the ATI card, maybe with some scripting.
The biggest obstacle to this, however, is keeping the second card powered down.
Xorg drivers for a specific card ignore the existence of a second card and therefore the second card is left at its highest clock frequency, consuming a lot of power and generating heat.
Command line tools for controlling both the Intel and the ATI cards exist, vbetool and radeontool, however, neither of these has the desired functionality.
Because of this obstacle, for now, we are left wishing, and the best we may hope for is being able to use the integrated and discrete settings.

The second best ideal is having the whole system working with both the integrated and discrete settings and having X automatically use the right driver according to the BIOS setting.
This is very easy.
For the console, if you use the VESA framebuffer driver (maybe uvesafb), then it already works for both.
For X, it is also easy, because you can have several Screen sections in your xorg.conf, and the first one which is working is used.
So, the solution is to have as many Device sections as you want, one Screen section for the discrete setting and one Screen section for the integrated setting, and add both of them to the ServerLayout section, as in the following excerpt of xorg.conf:

{{File|/etc/X11/xorg.conf|&lt;pre&gt;
Section &quot;Device&quot;
  Identifier &quot;intel&quot;
  Driver &quot;intel&quot;
  BusID &quot;PCI:0:2:0&quot;
EndSection

Section &quot;Device&quot;
  Identifier &quot;fglrx&quot;
  Driver &quot;fglrx&quot;
  BusID &quot;PCI:1:0:0&quot;
EndSection

Section &quot;Device&quot;
  Identifier &quot;radeon&quot;
  Driver &quot;radeon&quot;
  BusID &quot;PCI:1:0:0&quot;
  Option &quot;DynamicClocks&quot; &quot;on&quot;
EndSection

Section &quot;Screen&quot;
  Identifier &quot;Integrated&quot;
  Device &quot;intel&quot;
  Monitor &quot;LVDS&quot;
  DefaultDepth 24
  SubSection &quot;Display&quot;
    Depth 24
    Modes &quot;1920x1200&quot;
  EndSubSection
EndSection

Section &quot;Screen&quot;
  Identifier &quot;Discrete&quot;
  Device &quot;fglrx&quot;
  Monitor &quot;LVDS&quot;
  DefaultDepth 24
  SubSection &quot;Display&quot;
    Depth 24
    Modes &quot;1920x1200&quot;
  EndSubSection
EndSection

Section &quot;ServerLayout&quot;
  Identifier &quot;Default&quot;
  Screen &quot;Integrated&quot;
  Screen &quot;Discrete&quot;
EndSection
&lt;/pre&gt;}}

Putting the &quot;Integrated&quot; screen before &quot;Discrete&quot; in ServerLayout, will force the use of &quot;Integrated&quot; when using the switchable BIOS setting.
You can use either fglrx or radeon for the &quot;Discrete&quot; screen, whichever you prefer regarding the limitations of each.

If you want to alternate fglrx with intel, you'll need to eselect opengl each time you change BIOS to integrated or discrete.
You can achieve this automatically with a boot time init.d script such as the following.
Just add it to the boot runlevel.
This script deduces that if the fglrx kernel module loaded, then ati opengl libraries are to be used.

{{File|/etc/init.d/eselect-opengl|&lt;pre&gt;#!/sbin/runscript

depend() {
        need checkroot modules
}

start() {
        local retval=0
        ebegin &quot;Checking for discrete graphics&quot;
        if lsmod | grep ^fglrx 2&gt;&amp;1 &gt; /dev/null; then
                if [ `eselect opengl show` != &quot;ati&quot; ]; then
                        eselect opengl set ati
                        retval=$?
                fi
        else
                if [ `eselect opengl show` != &quot;xorg-x11&quot; ]; then
                        eselect opengl set xorg-x11
                        retval=$?
                fi
        fi
        if [[ $retval -eq 0 ]]; then
                eend 0
        else
                eend 2 &quot;No OpenGL libraries suitable for discrete graphics&quot;
                return 0
        fi
}&lt;/pre&gt;}}



Is all right? &quot;Integrated&quot; And &quot;Switch&quot; ==&gt; Intel , &quot;Discrete&quot; ==&gt; ati :

{{File|/etc/init.d/eselect-opengl|&lt;pre&gt;#!/sbin/runscript

depend() {
 need checkroot modules
}

start() {
 local retval=0
 ebegin &quot;Checking for discrete graphics&quot;
 if lspci |grep &quot;\&lt;VGA\&gt;.*\&lt;Intel\&gt;&quot; 2&gt;&amp;1 &gt; /dev/null; then
  if [ `eselect opengl show` != &quot;xorg-x11&quot; ]; then
   eselect opengl set xorg-x11
   retval=$?
  fi
 else
  if [ `eselect opengl show` != &quot;ati&quot; ]; then
   eselect opengl set ati
   retval=$?
  fi
 fi
 if [[ $retval -eq 0 ]]; then
  eend 0
 else
  eend 2 &quot;No OpenGL libraries suitable for discrete graphics&quot;
  return 0
 fi
}&lt;/pre&gt;}}

==Miscellaneous hardware==

===Processor===

The following kernel config options are suitable to the Intel Core 2 processor on these laptops.

{{Kernel|Intel Centrino 2 kernel config|&lt;pre&gt;
Processor type and features  ---&gt;
     [*] Symmetric multi-processing support
         Processor family (Core 2/newer Xeon)  ---&gt;
     (2) Maximum number of CPUs (2-512)
     [ ] SMT (Hyperthreading) scheduler support
     [*] Multi-core scheduler support
&lt;/pre&gt;}}

===Power management===

The following power management kernel config options are suitable for this laptop.

{{Kernel|Power management kernel config|&lt;pre&gt;
Power management options  ---&gt;
     [*] Power Management support
     [*] Suspend to RAM and standby
     [*] Hibernation (aka 'suspend to disk')
     (/dev/sda2) Default resume partition
     [*] ACPI (Advanced Configuration and Power Interface) Support  ---&gt;
     &lt;*&gt;   AC Adapter
     &lt;*&gt;   Battery
     &lt;*&gt;   Button
     &lt;*&gt;   Video
     &lt;*&gt;   Fan
     &lt;*&gt;   Processor
     &lt;*&gt;     Thermal Zone
         CPU Frequency scaling  ---&gt;
     [*] CPU Frequency scaling
     &lt;*&gt;   ACPI Processor P-States driver
     &lt; &gt;   AMD Opteron/Athlon64 PowerNow!
     &lt; &gt;   Intel Enhanced SpeedStep (deprecated)
     &lt; &gt;   Intel Pentium 4 clock modulation
     [*] CPU idle PM support
&lt;/pre&gt;}}

{{Warning| I had to enable the security chip in the T400 BIOS and disable the security reporting options to make suspend and resume work (Security &gt; Security Chip [Active] and Intel(R) TXT Feature [Disabled]). Otherwise the moon led stays on and the display remains dark after resuming. This was tested and confirmed on BIOS Version 1.1.3,1.1.5 and 1.2.0 with gentoo sources 2.6.27-r8 and 2.6.28-r1, vanilla sources 2.6.29-rc3 and xf86-video-intel 2.6.1 with a Thinkpad T400, Model 6474-A48. DRI is currently disabled. --[[User:Phillme|Phillme]] 15:26, 8 February 2009 (GMT)}}

Since the 0.5.11 version of the hal ebuild, if you compile hal with the laptop use flag, it will pull in pm-utils.
The good news is that both suspend to ram and suspend to disk are working very well with [http://www.gentoo-wiki.info/Pm-utils pm-utils] and using hal it works out of the box (contrary to using hibernate-script as described in the [http://www.gentoo.org/doc/en/power-management-guide.xml power management guide]).
One minor tweak though is necessary as of hal 0.5.11: resume works fine with the discrete card, but not with the intel card, for it to work add the following file to /etc/hal/fdi/information (which will replace the corresponding one on /usr/share/hal).

{{File|20-video-quirk-pm-lenovo.fdi|&lt;pre&gt;
&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt; &lt;!-- -*- SGML -*- --&gt; 
&lt;deviceinfo version=&quot;0.2&quot;&gt;
  &lt;device&gt;
    &lt;match key=&quot;system.hardware.vendor&quot; string=&quot;LENOVO&quot;&gt;
    &lt;!-- ThinkPads --&gt;
      &lt;match key=&quot;system.hardware.version&quot; prefix=&quot;ThinkPad &quot;&gt;
        &lt;!-- T400 --&gt;
        &lt;match key=&quot;system.hardware.version&quot; suffix=&quot;T400&quot;&gt;
          &lt;merge key=&quot;power_management.quirk.vbe_post&quot; type=&quot;bool&quot;&gt;true&lt;/merge&gt;
          &lt;merge key=&quot;power_management.quirk.vbestate_restore&quot; type=&quot;bool&quot;&gt;true&lt;/merge&gt;
        &lt;/match&gt;
      &lt;/match&gt;
    &lt;/match&gt;
  &lt;/device&gt;
&lt;/deviceinfo&gt;&lt;/pre&gt;}}


In some kernels starting from gentoo-sources-2.6.35-r15 the deactivation of the TPM device does not succeed and therefore the suspend process aborts. In the kernel logs there are messages like:
&lt;blockquote&gt;tpm_tis 00:0a: tpm_transmit: tpm_send: error -5&lt;/blockquote&gt;

As a workaround try to add the following file to /etc/modprobe.conf and execute &lt;code&gt;update-modules&lt;/code&gt; afterwards. Suspend might work after reloading the module tpm_tis.

{{File|tpm-workaround.conf |&lt;pre&gt;
#without this, my t400 would not suspend
options tpm_tis itpm=1
&lt;/pre&gt;}}

It is also possible to tell pm-suspend to remove the ''tpm_tis'' module completely prior suspending. Just add the module to the SUSPEND_MODULES variable in a file in the ''/etc/pm/config.d/'' directory. For example like this:

{{File|/etc/pm/config.d/tpm-workaround |&lt;pre&gt;
#without this, my t400 would not suspend
SUSPEND_MODULES=&quot;tpm_tis&quot;
&lt;/pre&gt;}}

{{Note|Suspend to ram mostly works, but there are flaws. Some combinations may result in not being able to resume, maybe suspending and then opening lid, maybe issues with a second battery. [For my T500 usecase (kernel 2.6.30, pm-utils 1.2.5, discrete graph.) only first suspend to RAM works. Resume brings display to wrong contrast; second suspended freezes the system.--ps]}}

===SATA controller===

One nice thing about the SATA controller is that it is AHCI and there's no need to go through a long list of controllers in the kernel config.

{{Kernel|SATA controller kernel config|&lt;pre&gt;
Device Drivers  ---&gt;
     &lt;*&gt; Serial ATA (prod) and Parallel ATA (experimental) drivers  ---&gt;
     [*]   ATA ACPI Support
     &lt;*&gt;   AHCI SATA support
     [ ]   ATA SFF support
&lt;/pre&gt;}}

===Ethernet===

Ethernet card configuration is straightforward as usual.
The only downside is that this card is not enabled by default and not enabled in the install CD kernels.
PCI Express must be enabled, of course (it is not by default on &lt;gentoo-sources-2.6.28).

{{Kernel|Ethernet kernel config|&lt;pre&gt;
Bus options (PCI etc.)  ---&gt;
     [*] PCI Express support
     [*] Message Signaled Interrupts (MSI and MSI-X)

Device Drivers  ---&gt;
     [*] Network device support  ---&gt;
     [*]   Ethernet (1000 Mbit)  ---&gt;
     &lt;*&gt;   Intel(R) PRO/1000 PCI-Express Gigabit Ethernet support
&lt;/pre&gt;}}

===Wireless===

The wireless card seems to work very well, although some have experienced strange delays depending on the AP when using the A band.
The driver is provided by intel and has been included in the kernel tree from version 2.6.27 onward, and can also be added to previous kernels.

{{Package|sys-kernel/gentoo-sources-2.6.27-r7}} is marked stable in the portage tree. All that is needed is to unmask the wireless card firmware and configuring the correct options in the kernel.
This can easily be achieved by inserting the proper atoms into package.keywords, maybe with the following commands:

{{Root|&lt;pre&gt;mkdir /etc/portage/package.keywords
echo net-wireless/iwl5000-code ~amd64 &gt; /etc/portage/package.keywords/iwl5000&lt;/pre&gt;}}

Kernel configuration with this kernel is easy:

{{Kernel|Wireless kernel config|&lt;pre&gt;
General setup  ---&gt;
     [*] Prompt for development and/or incomplete code/drivers

Networking support  ---&gt;
         Wireless  ---&gt;
             &lt;*&gt; Generic IEEE 802.11 Networking Stack (mac80211)

Device Drivers  ---&gt;
     [*] Network device support  ---&gt;
         Wireless LAN  ---&gt;
     [*] Wireless LAN (IEEE 802.11)
     -*- Intel Wireless Wifi Core
     [*] Iwlwifi RF kill support
     &lt;*&gt; Intel Wireless WiFi Next Gen AGN
     [*]   Enable Spectrum Measurement in iwlagn driver
     [*]   Enable LEDS features in iwlagn driver
     [ ]   Intel Wireless WiFi 4965AGN
     [*]   Intel Wireless WiFi 5000AGN
&lt;/pre&gt;}}

{{Note|You'll need to emerge the {{Package|net-wireless/iwl5000-ucode|direct=yes}} package to install the firmware for your card (your card won't work without it) and probably {{Package|net-wireless/wpa_supplicant|direct=yes}}.}}

Then follow the Gentoo wireless guide. You may find additional info on the specific [[Iwlwifi|iwlwifi topic]].

===USB===

USB is simple. Still, one thing to point out is that OHCI support on Intel chipsets is not necessary, as Intel kept to its initial UHCI proposal.

{{Kernel|USB kernel config|&lt;pre&gt;
Device Drivers  ---&gt;
     [*] USB support  ---&gt;
     &lt;*&gt;   Support for Host-side USB
     &lt;*&gt;     EHCI HCD (USB 2.0) support
     &lt; &gt;     OHCI HCD support
     &lt;*&gt;     UHCI HCD (most Intel and VIA) support
&lt;/pre&gt;}}

===Bluetooth===

The Gentoo manual covers everything needed for Bluetooth.
The only item to point out is the correct driver.
Note that it is connected via USB internally, so USB must be enabled.

{{Kernel|Bluetooth kernel config|&lt;pre&gt;
Networking support  ---&gt;
     &lt;M&gt;   Bluetooth subsystem support  ---&gt;
     &lt;M&gt;   L2CAP protocol support
     &lt;M&gt;   SCO links support
     &lt;M&gt;   RFCOMM protocol support
     &lt;M&gt;   BNEP protocol support
     &lt;M&gt;   HIDP protocol support
           Bluetooth device drivers  ---&gt;
             &lt;M&gt; HCI BCM203x USB driver
&lt;/pre&gt;}}

===Firewire===

Recent Linux kernels have two Firewire stacks to choose from.
There's no specific comment to make for the T400/T500/W500.

===Integrated camera===

The integrated camera can be handled by the uvcvideo driver.
Enable the following options in your kernel:
{{Kernel|Integrated camera config|&lt;pre&gt;
Device Drivers  ---&gt;
    &lt;*&gt; Multimedia support  ---&gt;
        &lt;*&gt; Video For Linux
        [*]  Load and attach frontend and tuner driver modules as needed
        [*]  Video capture adapters  ---&gt;
             [*]  V4L USB devices  ---&gt;
                  &lt;*&gt; USB Video Class (UVC)
                  [*]        UVC input events device support
&lt;/pre&gt;}}

===Laptopicities===

There's a driver in the kernel for ThinkPad specific stuff.
Mainly this driver handles the ThinkPad specific button events.
In some cases, the pressing of one of these buttons is completely handled by the BIOS and this driver is not necessary for it (i.e. the ThinkLight).
In other cases, the pressing of the buttons is handled by this driver and it asks the BIOS to perform the action.
In yet other cases, the driver asks an entirely different subsystem to perform the action (i.e. backlight control).
Note that the removable bay and NVRAM polling does not apply to these laptops and that the video output control is better handled by the XRandR extension.
You'll probably want to read /usr/src/linux/Documentation/laptops/thinkpad-acpi.txt for complete information about this driver.

{{Kernel|Power management kernel config|&lt;pre&gt;
Power management options  ---&gt;
     [*] ACPI (Advanced Configuration and Power Interface) Support  ---&gt;
     &lt;*&gt;   Video
Device Drivers  ---&gt;
     [*] Misc devices (/X86 Platform Specific Device Drivers)  ---&gt;
     &lt;*&gt;   ThinkPad ACPI Laptop Extras
     [ ]     Legacy Removable Bay Support
     [ ]     Video output control support
     [ ]     Support NVRAM polling for hot keys
&lt;/pre&gt;}}

Backlight control in console mode works only if you have only ACPI video for backlight control, avoid setting any other backlight control feature in the kernel.
Backlight control is not 100% working, it looks like it is delayed, when you press the increase or decrease button it seems to set the last setting.

This drivers adds a directory in /proc/acpi/ibm.
Each of the files in there can be used to poll or control a few subsystems.
For instance, cat /proc/acpi/ibm/thermal will give you some temperature info (the fourth value is for the ATI GPU), and echo disable &gt; /proc/acpi/ibm/bluetooth will disable bluetooth.

Using hal, all these laptop buttons will be working fine in gnome too, with on screen display for backlight control and sound.

There is known problem of not working sound-mute button (not only T500 issue). See this [http://bugzilla.kernel.org/show_bug.cgi?id=13934 bug] to get more information. Also ThinkVantage button can not be simply used in X. One need to use evdev for getting event information. One possibility is to use [http://bugs.gentoo.org/show_bug.cgi?id=65255 evrouter] or read detailed [[Multimedia_Keys|wiki]]. Example of evrouter config working here:
{{File|~./.evrouterrc|&lt;pre&gt;Window &quot;&quot;
&quot;ThinkPad Extra Buttons&quot; &quot;/dev/input/event6&quot; none key/360 &quot;Shell/Command_you_want&quot;&lt;/pre&gt;}}

===Active Protection System and Battery Control===

The ThinkPad tp_smapi package works well with these laptops. This provides two kernel modules, a replacement hdaps (the one included in stock kernels doesn't work) and tp_smapi which provides battery status and many interesting options for charging control (not all of which available in the Power Manager on Windows). You'll have to unmask some packages, add hdaps to USE flags, and follow the instruction on [http://www.thinkwiki.org/wiki/Tp_smapi ThinkWiki].

{{Root|&lt;pre&gt;mkdir /etc/portage/package.keywords
echo app-laptop/tp_smapi &gt; /etc/portage/package.keywords/thinkpad
echo app-laptop/hdapsd &gt;&gt; /etc/portage/package.keywords/thinkpad
echo app-laptop/hdaps-gl &gt;&gt; /etc/portage/package.keywords/thinkpad&lt;/pre&gt;}}

===Sound===

Enabling sound is easy.
Note that today, where all modern hardware used Intel HD Audio, there's no point in building it as a module for dynamically probing.
No problems with the power-saving feature so far.

{{Kernel|Sound kernel config|&lt;pre&gt;
Device Drivers  ---&gt;
     &lt;*&gt; Sound card support  ---&gt;
     &lt;*&gt;   Advanced Linux Sound Architecture  ---&gt;
     [*]   PCI sound devices  ---&gt;
     &lt;*&gt;   Intel HD Audio
     [*]     Build Conexant HD-audio codec support
     [*]     Aggressive power-saving on HD-audio
     (60)      Default time-out for HD-audio power-save mode
&lt;/pre&gt;}}

===CardBus/ExpressCard===

The ThinkPad W500 has a yenta compatible CardBus bridge in it.

{{Kernel|CardBus kernel config|&lt;pre&gt;
Bus options (PCI etc.)  ---&gt;
     &lt;*&gt; PCCard (PCMCIA/CardBus) support  ---&gt;
     &lt;*&gt;   CardBus yenta-compatible bridge support
&lt;/pre&gt;}}

===MMC/SD/MS/xD card reader===

Apparently there is good support for MMC and SD, however there seems not to be a driver for the MemoryStick chip, apparently the two drivers available on 2.6.28 don't detect it. There's no support at all for xD.

{{Kernel|MMC/SD kernel config|&lt;pre&gt;
Device Drivers  ---&gt;
     &lt;M&gt; MMC/SD card support  ---&gt;
     &lt;M&gt;   MMC block device driver
     &lt;M&gt;   Secure Digital Host Controller Interface support
     &lt;M&gt;     SDHCI support on PCI bus
     &lt;M&gt; Sony MemoryStick card support (EXPERIMENTAL)  ---&gt;
     &lt;M&gt;   MemoryStick Pro block device driver
     &lt; &gt;   TI Flash Media MemoryStick Interface support  (EXPERIMENTAL)
     &lt; &gt;   JMicron JMB38X MemoryStick interface support (EXPERIMENTAL)
&lt;/pre&gt;}}

===SMBus===

SMBus is a system for passing system management signals through the I2C bus.
It is mostly used for gathering information about motherboard peripherals such as temperatures and fan speeds.

{{Kernel|SMBus kernel config|&lt;pre&gt;
Device Drivers  ---&gt;
     {*} I2C support  ---&gt;
           I2C Hardware Bus support  ---&gt;
     &lt;*&gt; Intel 82801 (ICH)
&lt;/pre&gt;}}

===Turning devices on and off===

Information is wanted on how do things hot plug on these ThinkPads.
There's turning off the DVD drive, unplugging, hot plugging hard disks, maybe the docking station, etc.
We wish to know how to use these things get hot plugged, ACPI hot plug? PCIe hot plug?

{{Kernel|Hotplug kernel config|&lt;pre&gt;
Bus options (PCI etc.)  ---&gt;
     &lt;*&gt; Support for PCI Hotplug  ---&gt;
     &lt;*&gt;   ACPI PCI Hotplug driver
&lt;/pre&gt;}}


=== iTPM ===

The intel integrated TPM is compatible with the TCG TIS 1.2 TPM specifications so you need provide kernel support.

{{Kernel|Trusted Platform Module kernel config|&lt;pre&gt;
Device Drivers  ---&gt;
     Character device  ---&gt;
          &lt;M&gt;   TPM Hardware support  ---&gt;
          &lt;M&gt;   TPM Interface Specification 1.2 Interface
&lt;/pre&gt;}}

The current ''tpm_tis'' does not work directly with iTPM (using PNP to find the chip) because the _HID is non standard and the returned TIS status is incorrect (see [http://sourceforge.net/mailarchive/message.php?msg_name=200811280943427180885%40gmail.com tpmdd mailing list] and [https://www.grounation.org/index.php?post/2008/07/04/8-how-to-use-a-tpm-with-linux grounation blog] for a discussion). Below is an '''experimental''' patch to ''tpm_tis'', getting it to work (thanks Colin Didier for putting in a diff file and much thanks to Seiji Munetoh and the tpmdd mailing list):

{{File|itpm.diff|&lt;pre&gt;
--- drivers/char/tpm/tpm_tis.c.orig	2009-02-02 14:42:32.000000000 +0900
+++ drivers/char/tpm/tpm_tis.c	2009-02-02 18:12:12.000000000 +0900
@@ -293,7 +293,7 @@
 		wait_for_stat(chip, TPM_STS_VALID, chip-&gt;vendor.timeout_c,
 			      &amp;chip-&gt;vendor.int_queue);
 		status = tpm_tis_status(chip);
-		if ((status &amp; TPM_STS_DATA_EXPECT) == 0) {
+		if ((status &amp; TPM_STS_VALID) == 0) {
 			rc = -EIO;
 			goto out_err;
 		}
@@ -430,7 +430,7 @@
 	return IRQ_HANDLED;
 }
 
-static int interrupts = 1;
+static int interrupts = 0;
 module_param(interrupts, bool, 0444);
 MODULE_PARM_DESC(interrupts, &quot;Enable interrupts&quot;);
 
@@ -450,19 +450,19 @@
 		goto out_err;
 	}
 
-	if (request_locality(chip, 0) != 0) {
-		rc = -ENODEV;
-		goto out_err;
-	}
-
-	vendor = ioread32(chip-&gt;vendor.iobase + TPM_DID_VID(0));
-
 	/* Default timeouts */
 	chip-&gt;vendor.timeout_a = msecs_to_jiffies(TIS_SHORT_TIMEOUT);
 	chip-&gt;vendor.timeout_b = msecs_to_jiffies(TIS_LONG_TIMEOUT);
 	chip-&gt;vendor.timeout_c = msecs_to_jiffies(TIS_SHORT_TIMEOUT);
 	chip-&gt;vendor.timeout_d = msecs_to_jiffies(TIS_SHORT_TIMEOUT);
 
+	if (request_locality(chip, 0) != 0) { 
+		rc = -ENODEV;
+		goto out_err;
+	}
+
+	vendor = ioread32(chip-&gt;vendor.iobase + TPM_DID_VID(0));
+
 	dev_info(dev,
 		 &quot;1.2 TPM (device-id 0x%X, rev-id %d)\n&quot;,
 		 vendor &gt;&gt; 16, ioread8(chip-&gt;vendor.iobase + TPM_RID(0)));
@@ -652,7 +652,7 @@
 
 static struct platform_device *pdev;
 
-static int force;
+static int force = 1;
 module_param(force, bool, 0444);
 MODULE_PARM_DESC(force, &quot;Force device probe rather than using ACPI entry&quot;);
 static int __init init_tis(void)

&lt;/pre&gt;}}
To use the TPM load ''tpm_bios'', ''tpm'' and ''tpm_tis''. Finally emerge [http://trousers.sourceforge.net/ trousers] for a TSS.

=== Touchpad ===
Touchpad works out of the box but often, when typing, one needs to swith it off.
For this you need normal synaptics tools (see syndaemon, synclient). This is however not enough, since Thinkpads have Trackpoint and its 3 buttons which wouldn't be switched off this way - you need to use xinput. Example code would be:

&lt;pre&gt;
#switch off only tapping  and  scrolling; daemonize
syndaemon -d -t
#switch touchpad completely
synclient TouchPadOff=1
#switch the even trackpoint device
xinput set-int-prop &quot;TPPS/2 IBM TrackPoint&quot; &quot;Device Enabled&quot; 8 0
&lt;/pre&gt;

===Devices left out===

Some devices still appear on lspci as not being connected to any driver.
WiMAX? Where's the TPM chip?
The ones from Ricoh are from the card reader.
Here's the list:

&lt;pre&gt;
00:03.0 Communication controller: Intel Corporation Device 2a44 (rev 07)
        Subsystem: Lenovo Device 20e6
        Flags: bus master, fast devsel, latency 0, IRQ 11
        Memory at fc226800 (64-bit, non-prefetchable) [size=16]
        Capabilities: [50] Power Management version 3
        Capabilities: [8c] Message Signalled Interrupts: Mask- 64bit+ Queue=0/0 Enable-

00:1e.0 PCI bridge: Intel Corporation 82801 Mobile PCI Bridge (rev 93) (prog-if 01 [Subtractive decode])
        Flags: bus master, fast devsel, latency 0
        Bus: primary=00, secondary=15, subordinate=18, sec-latency=32
        I/O behind bridge: 00005000-00008fff
        Memory behind bridge: f4300000-f7ffffff
        Prefetchable memory behind bridge: 00000000f0000000-00000000f3ffffff
        Capabilities: [50] Subsystem: Lenovo Device 20f4

00:1f.0 ISA bridge: Intel Corporation Device 2917 (rev 03)
        Subsystem: Lenovo Device 20f5
        Flags: bus master, medium devsel, latency 0
        Capabilities: [e0] Vendor Specific Information &lt;?&gt;

15:00.3 System peripheral: Ricoh Co Ltd Device 0843 (rev 11)
        Subsystem: Lenovo Device 20c9
        Flags: bus master, medium devsel, latency 32, IRQ 11
        Memory at f4301c00 (32-bit, non-prefetchable) [size=256]
        Capabilities: [80] Power Management version 2

15:00.4 System peripheral: Ricoh Co Ltd R5C592 Memory Stick Bus Host Adapter (rev 11)
        Subsystem: Lenovo Device 20ca
        Flags: bus master, medium devsel, latency 32, IRQ 11
        Memory at f4302000 (32-bit, non-prefetchable) [size=256]
        Capabilities: [80] Power Management version 2

15:00.5 System peripheral: Ricoh Co Ltd xD-Picture Card Controller (rev 11)
        Subsystem: Lenovo Device 20cb
        Flags: bus master, medium devsel, latency 32, IRQ 11
        Memory at f4302400 (32-bit, non-prefetchable) [size=256]
        Capabilities: [80] Power Management version 2
&lt;/pre&gt;

The fingerprint reader can be found on the USB bus using lsusb:

&lt;pre&gt;
Bus 004 Device 002: ID 08ff:2810 AuthenTec, Inc. 
Device Descriptor:
  bLength                18
  bDescriptorType         1
  bcdUSB               2.00
  bDeviceClass          255 Vendor Specific Class
  bDeviceSubClass       255 Vendor Specific Subclass
  bDeviceProtocol       255 Vendor Specific Protocol
  bMaxPacketSize0         8
  idVendor           0x08ff AuthenTec, Inc.
  idProduct          0x2810 
  bcdDevice           17.03
  iManufacturer           0 
  iProduct                1 Fingerprint Sensor
  iSerial                 0 
  bNumConfigurations      1
&lt;/pre&gt;

==Links==
* [[Fglrx|ATI Catalyst drivers]]
* [[Radeon|Radeon Xorg driver]]
* [[Intel_GMA|Intel GMA drivers]]
* [[Iwlwifi|Intel WiFi Link drivers]]
* [[Synaptics_Touchpad|Synaptics touchpad]]
* [http://www.gentoo.org/doc/en/power-management-guide.xml Gentoo Power Management Guide]
* [[Lenovo Thinkpad T61]]
* [[Lenovo Thinkpad T61p]]
* [http://wiki.archlinux.org/index.php/Lenovo_ThinkPad_T400 ThinkPad T400 on ArchWiki]
* [http://www.thinkwiki.org/wiki/Category:T400 ThinkWiki page on ThinkPad T400 laptop]
* [http://www.thinkwiki.org/wiki/Category:T500 ThinkWiki page on ThinkPad T500laptop]
* [http://www.thinkwiki.org/wiki/Category:W500 ThinkWiki page on ThinkPad W500 laptop]
* [http://www.thinkwiki.org/wiki/Category:W700 ThinkWiki page on ThinkPad W700 laptop]
* [http://www.linlap.com/wiki/lenovo+thinkpad+t400 linlap page on Thinkpad T400laptop]
* [http://www.linlap.com/wiki/lenovo+thinkpad+t500 linlap page on Thinkpad T500laptop]
* [http://www.linlap.com/wiki/lenovo+thinkpad+w500 linlap page on Thinkpad W500laptop]

[[Category:Lenovo Laptops]]</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/Lenovo UVC Camera</title>
    <id>49</id>
    <revision>
      <id>205</id>
      <timestamp>2013-06-05T20:22:06Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <minor/>
      <comment>moved [[Lenovo UVC Camera]] to [[Gentoo/Lenovo UVC Camera]]</comment>
      <text xml:space="preserve">= Lenovo UVC Camera =

A small webcam embedded within Lenovo laptops.

USB
{{Codeline|&lt;pre&gt;
17ef:4807 Lenovo UVC Camera
&lt;/pre&gt;}}

Fortunately it is standard camera!

== Kernel ==

{{Kernel||&lt;pre&gt;
  Device Drivers  ---&gt;
    &lt;M&gt; Multimedia support  ---&gt;
      &lt;M&gt;   Video For Linux
      [*]   Video capture adapters  ---&gt;
        [*]   Autoselect pertinent encoders/decoders and other helper chips
        [*]   V4L USB devices  ---&gt;
          &lt;M&gt;   USB Video Class (UVC)
          [*]     UVC input events device support
&lt;/pre&gt;}}

== Test ==

{{File|/etc/portage/package.use/vlc.conf|&lt;pre&gt;
media-video/vlc v4l
&lt;/pre&gt;}}

{{Command|vlc v4l2:///dev/v4l/by-id/usb-Chicony_Electronics_Co.__Ltd._4807-video-index0}}

== Maintainer ==

[[User:Alonbl|Alon Bar-Lev]]

{{AuthorList|{{Author|Alon Bar-Lev|2011-11-25|type=original}}}}

[[Category:Hardware]]</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/Linux Configuration ASRock Core 100HT</title>
    <id>44</id>
    <revision>
      <id>245</id>
      <timestamp>2013-06-05T21:04:47Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve">= Alonbl's ASRock Core 100HT =

Following is extension to [[Gentoo/Linux_Configuration_Common]] with ASRock Core 100HT configuration.

Same guidelines of minimal module only configuration.

[[Image:ASRock_Core_100HT.jpg|200px]]

== Hardware ==

=== PCI ===

{{Codeline|&lt;pre&gt;
00:00.0 Host bridge [0600]: Intel Corporation Core Processor DRAM Controller [8086:0044] (rev 12)
00:02.0 VGA compatible controller [0300]: Intel Corporation Core Processor Integrated Graphics Controller [8086:0046] (rev 12)
00:04.0 Signal processing controller [1180]: Intel Corporation Core Processor Thermal Management Controller [8086:0050] (rev 12)
00:16.0 Communication controller [0780]: Intel Corporation 5 Series/3400 Series Chipset HECI Controller [8086:3b64] (rev 06)
00:1a.0 USB Controller [0c03]: Intel Corporation 5 Series/3400 Series Chipset USB2 Enhanced Host Controller [8086:3b3c] (rev 06)
00:1b.0 Audio device [0403]: Intel Corporation 5 Series/3400 Series Chipset High Definition Audio [8086:3b56] (rev 06)
00:1c.0 PCI bridge [0604]: Intel Corporation 5 Series/3400 Series Chipset PCI Express Root Port 1 [8086:3b42] (rev 06)
00:1c.1 PCI bridge [0604]: Intel Corporation 5 Series/3400 Series Chipset PCI Express Root Port 2 [8086:3b44] (rev 06)
00:1d.0 USB Controller [0c03]: Intel Corporation 5 Series/3400 Series Chipset USB2 Enhanced Host Controller [8086:3b34] (rev 06)
00:1e.0 PCI bridge [0604]: Intel Corporation 82801 Mobile PCI Bridge [8086:2448] (rev a6)
00:1f.0 ISA bridge [0601]: Intel Corporation Mobile 5 Series Chipset LPC Interface Controller [8086:3b09] (rev 06)
00:1f.2 SATA controller [0106]: Intel Corporation 5 Series/3400 Series Chipset 4 port SATA AHCI Controller [8086:3b29] (rev 06)
00:1f.3 SMBus [0c05]: Intel Corporation 5 Series/3400 Series Chipset SMBus Controller [8086:3b30] (rev 06)
00:1f.6 Signal processing controller [1180]: Intel Corporation 5 Series/3400 Series Chipset Thermal Subsystem [8086:3b32] (rev 06)
01:00.0 Ethernet controller [0200]: Realtek Semiconductor Co., Ltd. RTL8111/8168B PCI Express Gigabit Ethernet controller [10ec:8168] (rev 06)
02:00.0 USB Controller [0c03]: NEC Corporation Device [1033:0194] (rev 03)
ff:00.0 Host bridge [0600]: Intel Corporation Core Processor QuickPath Architecture Generic Non-core Registers [8086:2c62] (rev 02)
ff:00.1 Host bridge [0600]: Intel Corporation Core Processor QuickPath Architecture System Address Decoder [8086:2d01] (rev 02)
ff:02.0 Host bridge [0600]: Intel Corporation Core Processor QPI Link 0 [8086:2d10] (rev 02)
ff:02.1 Host bridge [0600]: Intel Corporation Core Processor QPI Physical 0 [8086:2d11] (rev 02)
ff:02.2 Host bridge [0600]: Intel Corporation Core Processor Reserved [8086:2d12] (rev 02)
ff:02.3 Host bridge [0600]: Intel Corporation Core Processor Reserved [8086:2d13] (rev 02)
&lt;/pre&gt;}}

=== USB ===

{{Codeline|&lt;pre&gt;
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 002 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 001 Device 002: ID 8087:0020 Intel Corp. Integrated Rate Matching Hub
Bus 002 Device 002: ID 8087:0020 Intel Corp. Integrated Rate Matching Hub
Bus 003 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 004 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub
&lt;/pre&gt;}}

== BIOS ==

* Use only Intel integrated video controller, it saves power, and Intel have better support for Linux.
* Use AHCI SATA not compatible mode.

== Kernel ==

{{Kernel||&lt;pre&gt;
  Processor type and features  ---&gt;
    (4) Maximum number of CPUs
    [*] Enable KSM for page merging
    (64) Amount of low memory, in kilobytes, to reserve for the BIOS
    -*- MTRR (Memory Type Range Register) support
    [*]   MTRR cleanup support
    (1)     MTRR cleanup enable value (0-1)
    (0)     MTRR cleanup spare reg num (0-7)
  Power management and ACPI options  ---&gt;
    [*] Suspend to RAM and standby
    [*] Hibernation (aka 'suspend to disk')
    [*] Run-time PM core functionality
    [*] ACPI (Advanced Configuration and Power Interface) Support  ---&gt;
      &lt;M&gt;   AC Adapter
      -*-   Button
      -*-   Video
      &lt;M&gt;   Fan
      &lt;M&gt;   Processor
      &lt;M&gt;   Thermal Zone
    CPU Frequency scaling  ---&gt;
      [*] CPU Frequency scaling
      &lt;M&gt;   CPU frequency translation statistics
      [*]     CPU frequency translation statistics details
      Default CPUFreq governor (performance)  ---&gt;
      -*-   'performance' governor
      &lt;M&gt;   'powersave' governor
      &lt;M&gt;   'userspace' governor for userspace frequency scaling
      &lt;M&gt;   'ondemand' cpufreq policy governor
      &lt;M&gt;   'conservative' cpufreq governor
      x86 CPU frequency scaling drivers  ---&gt;
        &lt;M&gt; ACPI Processor P-States drivers
    -*- CPU idle PM support
    [*]   Cpuidle Driver for Intel Processors
  [*] Networking support  ---&gt;
    -*-   Wireless  ---&gt;
      &lt;M&gt;   cfg80211 - wireless configuration API
      [*]     enable powersave by default
      [*]     cfg80211 wireless extensions compatibility
      [*]   Wireless extensions sysfs files
      &lt;M&gt;   Common routines for IEEE802.11 drivers
      &lt;M&gt;   Generic IEEE 802.11 Networking Stack (mac80211)
    &lt;M&gt;   RF switch subsystem support  ---&gt;
  Device Drivers  ---&gt;
    [*] Block devices  ---&gt; 
      &lt;M&gt;   Packet writing on CD/DVD media
      (8)     Free buffers for data gathering
      [*]     Enable write caching (EXPERIMENTAL)
      &lt;M&gt; Serial ATA and Parallel ATA drivers  ---&gt;
        [*]   ATA ACPI Support
        &lt;M&gt;   AHCI SATA support                                             ### you may  want to set as &lt;*&gt; to avoid complex initramfs
    [*] Network device support  ---&gt;
      [*]   Ethernet (1000 Mbit)  ---&gt;
        &lt;M&gt;   Realtek 8169 gigabit ethernet support
      [*]   Wireless LAN  ---&gt;
        &lt;M&gt;   Atheros Wireless Cards  ---&gt;
          &lt;M&gt;   Atheros 802.11n wireless cards support
          [*]     Atheros ath9k PCI/PCIe bus support
          [*]     Atheros ath9k rate control (NEW)
    {M} Hardware Monitoring support  ---&gt;
      &lt;M&gt;   Intel Core/Core2/Atom temperature sensor
    &lt;M&gt; Sound card support  ---&gt;
      &lt;M&gt;   Advanced Linux Sound Architecture  ---&gt;
        &lt;M&gt;   Sequencer support
        [*]   PCI sound devices  ---&gt;
          &lt;M&gt;   Intel HD Audio  ---&gt;
            (64)  Pre-allocated buffer size for HD-audio drivers
            [*]   Support digital beep via input layer
            (1)     Digital beep registration mode (0=off, 1=on, 2=mute sw on/off)
            [*]   Support jack plugging notification via input layer
            [*]   Build VIA HD-audio codec support
            [*]   Aggressive power-saving on HD-audio
            (30)    Default time-out for HD-audio power-save modesetting
    [*] HID Devices  ---&gt;
      &lt;*&gt;   USB Human Interface Device (full HID) support
    [*] USB support  ---&gt;
      &lt;M&gt;   xHCI HCD (USB 3.0) support (EXPERIMENTAL)       ### addition to basic
&lt;/pre&gt;}}

{{File|/etc/conf.d/modules|&lt;pre&gt;
modules=&quot;${modules}
ac
fan
processor
thermal
coretemp
&quot;modules=&quot;${modules}
acpi-cpufreq
cpufreq-conservative
cpufreq-ondemand
cpufreq-powersave
&quot;
&lt;/pre&gt;}}

== Packages ==

{{Root|emerge net-wireless/wpa_supplicant}}

== Configuration ==

{{File|/etc/conf.d/net|&lt;pre&gt;
modules=&quot;wpa_supplicant&quot;
rc_net_wlan0_need=&quot;firewall&quot;    # if you are using firewall
config_wlan0=&quot;dhcp&quot;
wpa_cli_wlan0=&quot;-G3600&quot;      # this saves power
wpa_supplicant_wlan0=&quot;-D nl80211&quot;

rc_net_eth0_need=&quot;firewall&quot;    # if you are using firewall
config_eth0=&quot;dhcp&quot;
&lt;/pre&gt;}}

{{Root|ln -s net.lo /etc/init.d/net.wlan0}}
{{Root|ln -s net.lo /etc/init.d/net.eth0}}

== More hardware ==

* [[Gentoo/Intel_Integrated_Graphics_Controller|Video]]

== References ==

* http://www.asrock.com/nettop/overview.asp?Model=Core%20100HT

== Maintainer ==

[[User:Alonbl|Alon Bar-Lev]]

{{AuthorList|{{Author|Alon Bar-Lev|2011-11-25|type=original}}}}</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/Linux Configuration Common</title>
    <id>41</id>
    <revision>
      <id>231</id>
      <timestamp>2013-06-05T20:54:18Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve">= Alonbl's base kernel configuration =

Following is basic kernel configuration I use for all my computer.

I try to make the kernel configuration as smaller as I can, trying to make sure I understand why I add an feature.

I also try to use modules as much as I can to see dependency and be able to see references.

== Kernel ==

{{Kernel||&lt;pre&gt;
  General setup  ---&gt;
    [*] Prompt for development and/or incomplete code/drivers
    [*] Support for paging of anonymous memory (swap)
    [*] Initial RAM filesystem and RAM disk (initramfs/initrd) support
    [*] System V IPC                                                  ### apache
    -*- Export task/process statistics through netlink (EXPERIMENTAL) ### iotop
    -*-   Enable per-task delay accounting (EXPERIMENTAL)             ### iotop
    [*]   Enable extended accounting over taskstats (EXPERIMENTAL)    ### iotop
    [*]     Enable per-task storage I/O accounting (EXPERIMENTAL)     ### iotop
  [*] Enable loadable module support  ---&gt;
    [*]   Module unloading
    [*]   Module versioning support
  -*- Enable the block layer  ---&gt;
    [*]   Block layer SG support v4
  [*] Enable loadable module support  ---&gt;
    [*]   Module unloading
    [*]   Module versioning support
  IO Schedulers  ---&gt;
    &lt;M&gt; CFQ I/O scheduler
    [*]   CFQ Group Scheduling support
    Default I/O scheduler (No-op)  ---&gt;
  Processor type and features  ---&gt;
    [*] Tickless System (Dynamic Ticks)
    [*] High Resolution Timer Support                                  ### Workstation
    [*] Symmetric multi-processing support
    [*] Single-depth WCHAN output
    (2) Maximum number of CPUs                                         ### Update to match machine
    [*] Multi-core scheduler support
    [*] Machine Check / overheating reporting
    [*]   Intel MCE features
    [*] Sparse Memory virtual memmap
  Power management and ACPI options  ---&gt;
    [*] ACPI (Advanced Configuration and Power Interface) Support  ---&gt;
      -*-   Button
    CPU Frequency scaling  ---&gt;
      [*] CPU Frequency scaling
      &lt;M&gt;   CPU frequency translation statistics
      [*]     CPU frequency translation statistics details
      Default CPUFreq governor (performance)  ---&gt;
      x86 CPU frequency scaling drivers  ---&gt;
        &lt;M&gt; ACPI Processor P-States drivers
    -*- CPU idle PM support
    [*]   Cpuidle Driver for Intel Processors
  Bus options (PCI etc.)  ---&gt;
    [*] PCI support
    [*]   Support mmconfig PCI config space access
    [*]   PCI Express support
    [*] Message Signaled Interrupts (MSI and MSI-X)
    [*] Interrupts on hypertransport devices
  Executable file formats / Emulations  ---&gt;
    [*] Kernel support for ELF binaries
  [*] Networking support  ---&gt;
    Networking options  ---&gt;
      &lt;M&gt; Packet socket
      &lt;M&gt; Unix domain sockets
      [*] TCP/IP networking
      [*]   IP: TCP syncookie support
      &lt;M&gt;   Large Receive Offload (ipv4/tcp)
      &lt;M&gt;   INET: socket monitoring interface
      [*]   TCP: advanced congestion control  ---&gt;
        &lt;*&gt;   CUBIC TCP
        Default TCP congestion control (Cubic)  ---&gt;
      [*] Security Marking 
  Device Drivers  ---&gt;
    Generic Driver Options  ---&gt;
      [*] Select only drivers that don't need compile-time external firmware
      [*] Prevent firmware from being built
      -*- Userspace firmware loading support
    &lt;*&gt; Connector - unified userspace &lt;-&gt; kernelspace linker  ---&gt;
      [*]   Report process events to userspace
    Input device support  ---&gt;
      &lt;M&gt;   Event interface
      [*]   Miscellaneous devices  ---&gt;
      -*-   Keyboards  ---&gt;
      [*]   Mice  ---&gt;
        &lt;M&gt;   PS/2 mouse 
      [*]   Miscellaneous devices  ---&gt;
        &lt;M&gt;   PC Speaker support
    Character devices  ---&gt;
      [*] HPET - High Precision Event Timer
      [*]   Allow mmap of HPET
    [*] USB support  ---&gt;
      &lt;M&gt;   Support for Host-side USB
      [*]     USB runtime power management (autosuspend) and wakeup
      &lt;M&gt;   USB Monitoring
      &lt;M&gt;   EHCI HCD (USB 2.0) support
      &lt;M&gt;   OHCI HCD support
      &lt;M&gt;   UHCI HCD (most Intel and VIA) support
      &lt;M&gt;   USB Mass Storage support
    [*] Real Time Clock  ---&gt;
      [*]   Set system time from RTC on startup and resume
      (rtc0)  RTC used to set the system time
      [*]   /sys/class/rtc/rtcN (sysfs)
      [*]   /dev/rtcN (character devices)
      &lt;M&gt;   PC-style 'CMOS'
    [*] DMA Engine support  ---&gt;
      &lt;M&gt;   Intel I/OAT DMA support
      [*]   Network: TCP receive copy offload
    [*] IOMMU Hardware Support  ---&gt;
      [*]   Support for DMA Remapping Devices
      [*]     Enable DMA Remapping Devices by default
      [*]   Support for Interrupt Remapping (EXPERIMENTAL)
    File systems  ---&gt;
      &lt;M&gt; The Extended 4 (ext4) filesystem                       ### you may  want to set as &lt;*&gt; to avoid complex initramfs
      [*]   Use ext4 for ext2/ext3 file systems
      [*]   Ext4 extended attributes
      [*]     Ext4 POSIX Access Control Lists
      [*]     Ext4 Security Labels
      [*] Inotify support for userspace
      Pseudo filesystems  ---&gt;
        [*]   Tmpfs POSIX Access Control Lists
        -*-   Tmpfs extended attributes
  Kernel hacking  ---&gt;
    [*] Kernel debugging                                          ### powertop
    [*] Collect kernel timers statistics                          ### powertop
    [*] Tracers  ---&gt;                                             ### powertop
      [*]   Trace process context switches and events             ### powertop
    [*] Write protect kernel read-only data structures
&lt;/pre&gt;}}

Also apply [[Gentoo/Firewall_Using_Firehol]] kernel configuration.

OpenRC cgroup integration:

{{Kernel||&lt;pre&gt;
  General setup  ---&gt;
    [*] Control Group support  ---&gt;
      [*]   Freezer cgroup subsystem
      [*]   Device controller for cgroups
      [*]   Cpuset support
      [*]   Simple CPU accounting cgroup subsystem
      [*]   Group CPU scheduler  ---&gt;
        [*]   Group scheduling for SCHED_OTHER
        [*]   Group scheduling for SCHED_RR/FIFO
      &lt;M&gt;   Block IO controller
  IO Schedulers  ---&gt;
    &lt;M&gt; CFQ I/O scheduler
    [*]   CFQ Group Scheduling support
&lt;/pre&gt;}}

{{File|/etc/conf.d/modules|&lt;pre&gt;
modules=&quot;${modules}
af-packet
&quot;
modules=&quot;${modules}
inet_lro
ioatdma
cfq-iosched
&quot;
&lt;/pre&gt;}}

{{File|/etc/local.d/iosched.start|&lt;pre&gt;
#!/bin/sh
find /sys/class/block/*/. -name scheduler | while read f; do echo cfq &gt; &quot;$f&quot;; done
exit 0
&lt;/pre&gt;}}

== Maintainer ==

[[User:Alonbl|Alon Bar-Lev]]

{{AuthorList|{{Author|Alon Bar-Lev|2011-11-25|type=original}}}}</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/Linux Configuration Dell E6410</title>
    <id>43</id>
    <revision>
      <id>238</id>
      <timestamp>2013-06-05T21:00:55Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve">= Alonbl's Dell E6410 =

Following is extension to [[Gentoo/Linux_Configuration_Common]] with Dell E6410 configuration.

Same guidelines of minimal module only configuration.

== Hardware ==

=== PCI ===

{{Codeline|&lt;pre&gt;
00:00.0 Host bridge [0600]: Intel Corporation Core Processor DRAM Controller [8086:0044] (rev 02)
00:02.0 VGA compatible controller [0300]: Intel Corporation Core Processor Integrated Graphics Controller [8086:0046] (rev 02)
00:19.0 Ethernet controller [0200]: Intel Corporation 82577LM Gigabit Network Connection [8086:10ea] (rev 05)
00:1a.0 USB Controller [0c03]: Intel Corporation 5 Series/3400 Series Chipset USB2 Enhanced Host Controller [8086:3b3c] (rev 05)
00:1b.0 Audio device [0403]: Intel Corporation 5 Series/3400 Series Chipset High Definition Audio [8086:3b56] (rev 05)
00:1c.0 PCI bridge [0604]: Intel Corporation 5 Series/3400 Series Chipset PCI Express Root Port 1 [8086:3b42] (rev 05)
00:1c.1 PCI bridge [0604]: Intel Corporation 5 Series/3400 Series Chipset PCI Express Root Port 2 [8086:3b44] (rev 05)
00:1c.2 PCI bridge [0604]: Intel Corporation 5 Series/3400 Series Chipset PCI Express Root Port 3 [8086:3b46] (rev 05)
00:1c.3 PCI bridge [0604]: Intel Corporation 5 Series/3400 Series Chipset PCI Express Root Port 4 [8086:3b48] (rev 05)
00:1d.0 USB Controller [0c03]: Intel Corporation 5 Series/3400 Series Chipset USB2 Enhanced Host Controller [8086:3b34] (rev 05)
00:1e.0 PCI bridge [0604]: Intel Corporation 82801 Mobile PCI Bridge [8086:2448] (rev a5)
00:1f.0 ISA bridge [0601]: Intel Corporation Mobile 5 Series Chipset LPC Interface Controller [8086:3b07] (rev 05)
00:1f.2 RAID bus controller [0104]: Intel Corporation Mobile 82801 SATA RAID Controller [8086:282a] (rev 05)
00:1f.3 SMBus [0c05]: Intel Corporation 5 Series/3400 Series Chipset SMBus Controller [8086:3b30] (rev 05)
00:1f.6 Signal processing controller [1180]: Intel Corporation 5 Series/3400 Series Chipset Thermal Subsystem [8086:3b32] (rev 05)
02:00.0 Network controller [0280]: Intel Corporation WiFi Link 6000 Series [8086:422c] (rev 35)
03:00.0 CardBus bridge [0607]: Ricoh Co Ltd Device [1180:e476] (rev 02)
03:00.1 SD Host controller [0805]: Ricoh Co Ltd Device [1180:e822] (rev 03)
03:00.4 FireWire (IEEE 1394) [0c00]: Ricoh Co Ltd Device [1180:e832] (rev 03)
3f:00.0 Host bridge [0600]: Intel Corporation Core Processor QuickPath Architecture Generic Non-core Registers [8086:2c62] (rev 02)
3f:00.1 Host bridge [0600]: Intel Corporation Core Processor QuickPath Architecture System Address Decoder [8086:2d01] (rev 02)
3f:02.0 Host bridge [0600]: Intel Corporation Core Processor QPI Link 0 [8086:2d10] (rev 02)
3f:02.1 Host bridge [0600]: Intel Corporation Core Processor QPI Physical 0 [8086:2d11] (rev 02)
3f:02.2 Host bridge [0600]: Intel Corporation Core Processor Reserved [8086:2d12] (rev 02)
3f:02.3 Host bridge [0600]: Intel Corporation Core Processor Reserved [8086:2d13] (rev 02)
&lt;/pre&gt;}}

=== USB ===

{{Codeline|&lt;pre&gt;
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 002 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 001 Device 002: ID 8087:0020 Intel Corp. Integrated Rate Matching Hub
Bus 002 Device 002: ID 8087:0020 Intel Corp. Integrated Rate Matching Hub
Bus 001 Device 005: ID 05ca:1814 Ricoh Co., Ltd HD Webcam
Bus 002 Device 003: ID 413c:8187 Dell Computer Corp. DW375 Bluetooth Module
Bus 002 Device 004: ID 0a5c:5800 Broadcom Corp. BCM5880 Secure Applications Processor
Bus 001 Device 007: ID 413c:2513 Dell Computer Corp. internal USB Hub of E-Port Replicator
Bus 001 Device 008: ID 413c:2513 Dell Computer Corp. internal USB Hub of E-Port Replicator
&lt;/pre&gt;}}

== BIOS ==

* Use only Intel integrated video controller, it saves power, and Intel have better support for Linux.
* Use AHCI SATA not compatible mode.

== Kernel ==

{{Kernel||&lt;pre&gt;
  Processor type and features  ---&gt;
    (4) Maximum number of CPUs
    [*] Enable KSM for page merging
    (64) Amount of low memory, in kilobytes, to reserve for the BIOS
    -*- MTRR (Memory Type Range Register) support
    [*]   MTRR cleanup support
    (1)     MTRR cleanup enable value (0-1)
    (1)     MTRR cleanup spare reg num (0-7)
  Power management and ACPI options  ---&gt;
    [*] Suspend to RAM and standby
    [*] Hibernation (aka 'suspend to disk')
    [*] Run-time PM core functionality
    [*] ACPI (Advanced Configuration and Power Interface) Support  ---&gt;
      &lt;M&gt;   AC Adapter
      &lt;M&gt;   Battery
      -*-   Button
      -*-   Video
      &lt;M&gt;   Fan
      [*]   Dock
      &lt;M&gt;   Processor
      &lt;M&gt;   Thermal Zone
    CPU Frequency scaling  ---&gt;
      [*] CPU Frequency scaling
      &lt;M&gt;   CPU frequency translation statistics
      [*]     CPU frequency translation statistics details
      Default CPUFreq governor (performance)  ---&gt;
      -*-   'performance' governor
      &lt;M&gt;   'powersave' governor
      &lt;M&gt;   'userspace' governor for userspace frequency scaling
      &lt;M&gt;   'ondemand' cpufreq policy governor
      &lt;M&gt;   'conservative' cpufreq governor
      x86 CPU frequency scaling drivers  ---&gt;
        &lt;M&gt; ACPI Processor P-States drivers
    -*- CPU idle PM support
    [*]   Cpuidle Driver for Intel Processors
  [*] Networking support  ---&gt;
    -*-   Wireless  ---&gt;
      &lt;M&gt;   cfg80211 - wireless configuration API
      [*]     enable powersave by default
      [*]     cfg80211 wireless extensions compatibility
      [*]   Wireless extensions sysfs files
      &lt;M&gt;   Common routines for IEEE802.11 drivers
      &lt;M&gt;   Generic IEEE 802.11 Networking Stack (mac80211)
    &lt;M&gt;   RF switch subsystem support  ---&gt;
  Device Drivers  ---&gt;
    [*] Block devices  ---&gt; 
      &lt;M&gt;   Packet writing on CD/DVD media
      (8)     Free buffers for data gathering
      [*]     Enable write caching (EXPERIMENTAL)
      &lt;M&gt; Serial ATA and Parallel ATA drivers  ---&gt;
        [*]   ATA ACPI Support
        &lt;M&gt;   AHCI SATA support                                             ### you may  want to set as &lt;*&gt; to avoid complex initramfs
    [*] Network device support  ---&gt;
      [*]   Ethernet (1000 Mbit)  ---&gt;
        &lt;M&gt;   Intel(R) PRO/1000 PCI-Express Gigabit Ethernet support
      [*]   Wireless LAN  ---&gt;
        &lt;M&gt;   Intel Wireless WiFi Next Gen AGN - Wireless-N/Advanced-N/Ultimate-N (iwlagn)
    -*- I2C support  ---&gt;
      &lt;M&gt;   I2C device interface
      [*]   Autoselect pertinent helper modules
      I2C Hardware Bus support  ---&gt;
        &lt;M&gt; Intel 82801 (ICH/PCH)
    {M} Hardware Monitoring support  ---&gt;
      &lt;M&gt;   Intel Core/Core2/Atom temperature sensor
    &lt;M&gt; Sound card support  ---&gt;
      &lt;M&gt;   Advanced Linux Sound Architecture  ---&gt;
        &lt;M&gt;   Sequencer support
        [*]   PCI sound devices  ---&gt;
          &lt;M&gt;   Intel HD Audio  ---&gt;
            (64)  Pre-allocated buffer size for HD-audio drivers
            [*]   Support digital beep via input layer
            (1)     Digital beep registration mode (0=off, 1=on, 2=mute sw on/off)
            [*]   Support jack plugging notification via input layer
            [*]   Build Analog Device HD-audio codec support
            [*]   Aggressive power-saving on HD-audio
            (30)    Default time-out for HD-audio power-save modesetting
    [*] X86 Platform Specific Device Drivers  ---&gt;
      &lt;M&gt;   WMI Hotkeys for Dell All-In-One series                ### Will aprear only after selection of WMI
      &lt;M&gt;   WMI
      &lt;M&gt;     MSI WMI extras
&lt;/pre&gt;}}

{{File|/etc/conf.d/modules|&lt;pre&gt;
modules=&quot;${modules}
thinkpad_acpi
ac
battery
fan
processor
thermal
coretemp
&quot;modules=&quot;${modules}
acpi-cpufreq
cpufreq-conservative
cpufreq-ondemand
cpufreq-powersave
&quot;

&lt;/pre&gt;}}

== Packages ==

{{Root|emerge net-wireless/wpa_supplicant}}
{{Root|net-wireless/iwl6000-ucode}}

== Configuration ==

{{File|/etc/conf.d/net|&lt;pre&gt;
modules=&quot;wpa_supplicant&quot;
rc_net_wlan0_need=&quot;firewall&quot;    # if you are using firewall
config_wlan0=&quot;dhcp&quot;
wpa_cli_wlan0=&quot;-G3600&quot;      # this saves power
wpa_supplicant_wlan0=&quot;-D nl80211&quot;

rc_net_eth0_need=&quot;firewall&quot;    # if you are using firewall
config_eth0=&quot;dhcp&quot;
&lt;/pre&gt;}}

{{Root|ln -s net.lo /etc/init.d/net.wlan0}}
{{Root|ln -s net.lo /etc/init.d/net.eth0}}

== More hardware ==

* [[Gentoo/Intel_Integrated_Graphics_Controller|Video]]
* [[Gentoo/Bluetooth]]
* [[Gentoo/Lenovo_UVC_Camera|Webcam]]

== References ==

There are other variant of documentations, however I find them difficult to maintain, as a computer is container of its hardware, so laptop article should contain minimal information and reference to its hardware components.

* [[Gentoo/HP_Elitebook_8530w]]
* [[Gentoo/Iwlwifi]]

== Maintainer ==

[[User:Alonbl|Alon Bar-Lev]]

{{AuthorList|{{Author|Alon Bar-Lev|2011-11-25|type=original}}}}</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/Linux Configuration Thinkpad W500</title>
    <id>42</id>
    <revision>
      <id>246</id>
      <timestamp>2013-06-05T21:05:21Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve">= Alonbl's Thinkpad W500 =

Following is extension to [[Gentoo/Linux_Configuration_Common]] with Thinkpad W500 configuration.

Same guidelines of minimal module only configuration.

== Hardware ==

=== PCI ===

{{Codeline|&lt;pre&gt;
00:00.0 Host bridge [0600]: Intel Corporation Mobile 4 Series Chipset Memory Controller Hub [8086:2a40] (rev 07)
00:02.0 VGA compatible controller [0300]: Intel Corporation Mobile 4 Series Chipset Integrated Graphics Controller [8086:2a42] (rev 07)
00:02.1 Display controller [0380]: Intel Corporation Mobile 4 Series Chipset Integrated Graphics Controller [8086:2a43] (rev 07)
00:03.0 Communication controller [0780]: Intel Corporation Mobile 4 Series Chipset MEI Controller [8086:2a44] (rev 07)
00:03.3 Serial controller [0700]: Intel Corporation Mobile 4 Series Chipset AMT SOL Redirection [8086:2a47] (rev 07)
00:19.0 Ethernet controller [0200]: Intel Corporation 82567LM Gigabit Network Connection [8086:10f5] (rev 03)
00:1a.0 USB Controller [0c03]: Intel Corporation 82801I (ICH9 Family) USB UHCI Controller #4 [8086:2937] (rev 03)
00:1a.1 USB Controller [0c03]: Intel Corporation 82801I (ICH9 Family) USB UHCI Controller #5 [8086:2938] (rev 03)
00:1a.2 USB Controller [0c03]: Intel Corporation 82801I (ICH9 Family) USB UHCI Controller #6 [8086:2939] (rev 03)
00:1a.7 USB Controller [0c03]: Intel Corporation 82801I (ICH9 Family) USB2 EHCI Controller #2 [8086:293c] (rev 03)
00:1b.0 Audio device [0403]: Intel Corporation 82801I (ICH9 Family) HD Audio Controller [8086:293e] (rev 03)
00:1c.0 PCI bridge [0604]: Intel Corporation 82801I (ICH9 Family) PCI Express Port 1 [8086:2940] (rev 03)
00:1c.1 PCI bridge [0604]: Intel Corporation 82801I (ICH9 Family) PCI Express Port 2 [8086:2942] (rev 03)
00:1c.3 PCI bridge [0604]: Intel Corporation 82801I (ICH9 Family) PCI Express Port 4 [8086:2946] (rev 03)
00:1c.4 PCI bridge [0604]: Intel Corporation 82801I (ICH9 Family) PCI Express Port 5 [8086:2948] (rev 03)
00:1d.0 USB Controller [0c03]: Intel Corporation 82801I (ICH9 Family) USB UHCI Controller #1 [8086:2934] (rev 03)
00:1d.1 USB Controller [0c03]: Intel Corporation 82801I (ICH9 Family) USB UHCI Controller #2 [8086:2935] (rev 03)
00:1d.2 USB Controller [0c03]: Intel Corporation 82801I (ICH9 Family) USB UHCI Controller #3 [8086:2936] (rev 03)
00:1d.7 USB Controller [0c03]: Intel Corporation 82801I (ICH9 Family) USB2 EHCI Controller #1 [8086:293a] (rev 03)
00:1e.0 PCI bridge [0604]: Intel Corporation 82801 Mobile PCI Bridge [8086:2448] (rev 93)
00:1f.0 ISA bridge [0601]: Intel Corporation ICH9M-E LPC Interface Controller [8086:2917] (rev 03)
00:1f.2 SATA controller [0106]: Intel Corporation ICH9M/M-E SATA AHCI Controller [8086:2929] (rev 03)
00:1f.3 SMBus [0c05]: Intel Corporation 82801I (ICH9 Family) SMBus Controller [8086:2930] (rev 03)
03:00.0 Network controller [0280]: Intel Corporation PRO/Wireless 5100 AGN [Shiloh] Network Connection [8086:4237]
15:00.0 CardBus bridge [0607]: Ricoh Co Ltd RL5c476 II [1180:0476] (rev ba)
15:00.1 FireWire (IEEE 1394) [0c00]: Ricoh Co Ltd R5C832 IEEE 1394 Controller [1180:0832] (rev 04)
15:00.2 SD Host controller [0805]: Ricoh Co Ltd R5C822 SD/SDIO/MMC/MS/MSPro Host Adapter [1180:0822] (rev 21)
15:00.3 System peripheral [0880]: Ricoh Co Ltd R5C843 MMC Host Controller [1180:0843] (rev 11)
15:00.4 System peripheral [0880]: Ricoh Co Ltd R5C592 Memory Stick Bus Host Adapter [1180:0592] (rev 11)
15:00.5 System peripheral [0880]: Ricoh Co Ltd xD-Picture Card Controller [1180:0852] (rev 11)
&lt;/pre&gt;}}

=== USB ===

{{Codeline|&lt;pre&gt;
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 002 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 003 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub
Bus 004 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub
Bus 005 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub
Bus 006 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub
Bus 007 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub
Bus 008 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub
Bus 001 Device 004: ID 17ef:4807 Lenovo UVC Camera
Bus 004 Device 002: ID 08ff:2810 AuthenTec, Inc. AES2810
Bus 004 Device 004: ID 0a5c:2145 Broadcom Corp. Bluetooth with Enhanced Data Rate II
&lt;/pre&gt;}}

== BIOS ==

* Use only Intel integrated video controller, it saves power, and Intel have better support for Linux.
* Use AHCI SATA not compatible mode.

== Kernel ==

{{Kernel||&lt;pre&gt;
  Processor type and features  ---&gt;
    (2) Maximum number of CPUs
    [*] Enable KSM for page merging
    (64) Amount of low memory, in kilobytes, to reserve for the BIOS
    -*- MTRR (Memory Type Range Register) support
    [*]   MTRR cleanup support
    (1)     MTRR cleanup enable value (0-1)
    (2)     MTRR cleanup spare reg num (0-7)
  [*] Networking support  ---&gt;
    -*-   Wireless  ---&gt;
      &lt;M&gt;   cfg80211 - wireless configuration API
      [*]     enable powersave by default
      [*]     cfg80211 wireless extensions compatibility
      [*]   Wireless extensions sysfs files
      &lt;M&gt;   Common routines for IEEE802.11 drivers
      &lt;M&gt;   Generic IEEE 802.11 Networking Stack (mac80211)
    &lt;M&gt;   RF switch subsystem support  ---&gt;
  Device Drivers  ---&gt;
    [*] Block devices  ---&gt; 
      &lt;M&gt;   Packet writing on CD/DVD media
      (8)     Free buffers for data gathering
      [*]     Enable write caching (EXPERIMENTAL)
      &lt;M&gt; Serial ATA and Parallel ATA drivers  ---&gt;
        [*]   ATA ACPI Support
        &lt;M&gt;   AHCI SATA support                                             ### you may  want to set as &lt;*&gt; to avoid complex initramfs
    [*] Network device support  ---&gt;
      [*]   Ethernet (1000 Mbit)  ---&gt;
        &lt;M&gt;   Intel(R) PRO/1000 PCI-Express Gigabit Ethernet support
      [*]   Wireless LAN  ---&gt;
        &lt;M&gt;   Intel Wireless WiFi Next Gen AGN - Wireless-N/Advanced-N/Ultimate-N (iwlagn)
    -*- I2C support  ---&gt;
      &lt;M&gt;   I2C device interface
      [*]   Autoselect pertinent helper modules
      I2C Hardware Bus support  ---&gt;
        &lt;M&gt; Intel 82801 (ICH/PCH)
    {M} Hardware Monitoring support  ---&gt;
      &lt;M&gt;   Intel Core/Core2/Atom temperature sensor
    &lt;M&gt; Sound card support  ---&gt;
      &lt;M&gt;   Advanced Linux Sound Architecture  ---&gt;
        &lt;M&gt;   Sequencer support
        [*]   PCI sound devices  ---&gt;
          &lt;M&gt;   Intel HD Audio  ---&gt;
            (64)  Pre-allocated buffer size for HD-audio drivers
            [*]   Support digital beep via input layer
            (1)     Digital beep registration mode (0=off, 1=on, 2=mute sw on/off)
            [*]   Support jack plugging notification via input layer
            [*]   Build Conexant HD-audio codec support
            [*]   Aggressive power-saving on HD-audio
            (30)    Default time-out for HD-audio power-save modesetting
    &lt;M&gt; MMC/SD/SDIO card support  ---&gt;
      &lt;M&gt;   MMC block device drivers
      (8)     Number of minors per block devices
      [*]     Use bounce buffer for simple hosts
      &lt;M&gt;   Secure Digital Host Controller Interface support
      &lt;M&gt;   SDHCI support on PCI bus
&lt;/pre&gt;}}

And follow [[Gentoo/Thinkpad_Common]].

== Packages ==

{{Root|emerge net-wireless/wpa_supplicant}}
{{Root|net-wireless/iwl5000-ucode}}

== Configuration ==

{{File|/etc/conf.d/net|&lt;pre&gt;
modules=&quot;wpa_supplicant&quot;
rc_net_wlan0_need=&quot;firewall&quot;    # if you are using firewall
config_wlan0=&quot;dhcp&quot;
wpa_cli_wlan0=&quot;-G3600&quot;      # this saves power
wpa_supplicant_wlan0=&quot;-D nl80211&quot;

rc_net_eth0_need=&quot;firewall&quot;    # if you are using firewall
config_eth0=&quot;dhcp&quot;
&lt;/pre&gt;}}

{{Root|ln -s net.lo /etc/init.d/net.wlan0}}
{{Root|ln -s net.lo /etc/init.d/net.eth0}}

== More hardware ==

* [[Gentoo/Intel_Integrated_Graphics_Controller|Video]]
* [[Gentoo/Bluetooth]]
* [[Gentoo/Lenovo_UVC_Camera|Webcam]]
* Modem cannot be used as it conexant and these guys do not release the specs.
* AuthenTec AES2810 (was UPEK) is supported by {{Package|sys-auth/libfprint}}, however it is unmaintained.

== References ==

There are other variant of documentations, however I find them difficult to maintain, as a computer is container of its hardware, so laptop article should contain minimal information and reference to its hardware components.

* [[Gentoo/Lenovo_ThinkPad_T500/W500]]
* [[Gentoo/Iwlwifi]]

== Maintainer ==

[[User:Alonbl|Alon Bar-Lev]]

{{AuthorList|{{Author|Alon Bar-Lev|2011-11-25|type=original}}}}</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/Linux Disk Encryption Using LoopAES And SmartCards</title>
    <id>57</id>
    <revision>
      <id>177</id>
      <timestamp>2013-06-05T20:17:14Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <minor/>
      <comment>moved [[Linux Disk Encryption Using LoopAES And SmartCards]] to [[Gentoo/Linux Disk Encryption Using LoopAES And SmartCards]]</comment>
      <text xml:space="preserve">= Linux, Loop-AES and Optional Smartcard Based Disk Encryption =

The goal is to create an encrypted linux system using TuxOnIce or uswsusp on a loop-AES encrypted harddrive that is also encrypted when suspended, optionally storing the encryption keys on PKCS#11 cryptographic tokens (Smartcards).

This manual focus is to demonstrate the process and challenges, and still be productive for actual usage.

We would like to thank the following people:

* Jari Ruusu who made loop-aes available.
* Pavel Machek and Rafael J. Wysocki who made uswsusp available.
* Nigel Cunningham who made TuxOnIce available.
* Michal Januszewski for his work on fbsplash/gensplash.

The following demonstrates a working method and includes a check to see if the unencrypted /boot partition was changed (leading to a possibly compromised kernel or initrd/initramfs). And If you use frame buffer splash you also get a nice bootsplash with suspend/resume status and a set of tools to compile your kernel correctly.

We hope you will find this information useful.

== Required Components ==

* loop-aes from http://sourceforge.net/projects/loop-aes/ needed to encrypt a disk on-the-fly.
* aespipe from http://sourceforge.net/projects/loop-aes/ needed to encrypt/decrypt partition.
* uswsusp from http://suspend.sf.net optional: needed for suspending.
* TuxOnIce from http://www.tuxonice.net optional:needed for suspending.
* suspend2-userui from http://www.tuxonice.net optional: needed for suspend/resume status report in tuxonice configuration.
* aescrypt from http://www.aescrypt.com/ optional: need to handle file based keys by aescrypt.
* gpg from http://www.gnupg.org/ optional: needed to handle file based keys by gnupg.

== Prerequisites ==

Knowledge of all of these is easy to obtain with the help of Google and the documentation for TuxOnIce and Loop-AES.

* You know how to compile utilities in static mode.
* You know how to create initramfs.
* Make sure you have a working initramfs and that you control the init/linuxrc script.

* Make sure you have a working TuxOnIce or uswsusp environment.
* Make sure you have a working loop-aes environment, test loop on files.
* Generate keys to be used to encrypt your disk.
* Compile aescrypt/gpg, losetup, aespipe as static.
* You have a backup of all data on your system. If something breaks you could easily lose the entire partition.

{{Warning|No really, back up your data.}}

== Partitions ==

In order to have a secure encrypted and suspendable environment, you will need to have at least three partitions on your hard drive.
* boot partition
:Unencrypted /boot partition, used to hold kernel, initramfs and keyfile. 
* swap partition
:Encrypted swap partition, used for suspending, resuming, and safely swapping memory to disk. 
* root partition
:Encrypted root partition, your data may be stored here. 

{{Warning|Throughout this document the following partitions are used, you should replace them with your own.}}
* /dev/sda1 - boot
* /dev/sda2 - swap
* /dev/sda3 - root 

{{Note| We recommend that you use at least two version of your kernel: a testing one for trying out new kernels and a stable one that is known to work. An encrypted root partition makes this very important as an unbootable kernel unbootable or missing kernel modules can make it very difficult to recover your system and data. You can use the kernel option CONFIG_LOCALVERSION to give each kernel a unique name to avoid confusion. ALWAYS have a WORKING backup kernel once you have a working environment.}}

{{Note|We recommend using Loop-AES in Multi-key-v3 mode.}}

There are a number of ways to store the decryption keys and we try to accommodate them all. A key may be kept on a PKCS#11 cryptographic token, in a keyfile encrypted with symmetric encryption. If you do not have a smartcard, you can store a keyfile on external media such as a cd-rom or usb thumb drive. Please refer to the Loop-AES documentation for instructions on generating keys and a security analysis. Because symmetric encryption is heavily dependent on the strength of the passphrase used, http://www.diceware.com is suggested for generating strong passphrases.

== Beginning the Process ==

=== Outline ===

* Compile a new kernel with necessary patches and additions
* Test new kernel
* Create an initramfs
* Create encryption keys
* Set up the framework for Loop-AES encrypted root and swap
* Actually encrypt root and swap
* Prepare suspend framework
* Test the final product 

=== Compiling a New Kernel ===

* Compile your kernel with TuxOnIce or uswsusp support, initramfs support and NO loop device support.
* Compile loop-aes module. 

Add:
{{File|/etc/portage/package.use/loop-aes.conf|&lt;pre&gt;
sys-apps/loop-aes-losetup static
app-crypt/aespipe static
sys-fs/loop-aes keyscrub
app-crypt/aescrypt static # optional if file based key by aescrypt is used
app-crypt/gnupg static # optional if file based key by gnupg is used
&lt;/pre&gt;}}

sys-apps/loop-aes-losetup is available via overlay at http://github.com/alonbl/alon-barlev-overlay.git

{{Root|emerge sysfs/loop-aes app-crypt/aespipe sys-apps/loop-aes-losetup}}

=== Testing additions ===

Having done one of the two options above, you should now reboot into your new kernel to test the new features. Use the Loop-AES documentation to ensure that you can create a file-backed encrypted loop and that everything works properly. Don't forget to modprobe loop if you built Loop-AES as a module.

=== Create Initramfs ===

An initramfs is a lot like the familiar initrd only it uses a different archiving format (cpio instead of tar) and is accessed by the kernel slightly differently. Initramfs is capable of some things initrd just can't do and is the wave of the future.

Look at initramfs section in order to understand how to create the initramfs.

=== Initramfs Kernel Parameters ===

The linuxrc script accepts the following additional kernel parameters:
* initrd_util
:* pkcs11:application:label,label,label
::use PKCS#11 smartcards. 
:* aescrypt:device:fstype:file,file,file&lt;br&gt;
::use aescrypt files located at device. wait for device to be available. 
:* gpgfile:device:fstype:file,file,file&lt;br&gt;
::use gnupg files located at device. wait for device to be available. 
* initrd_devices=/dev/sdXN,/dev/sdYM,...
:devices to loop over. 
* initrd_loopstart=N
:The first loop index (/dev/loopN) 
*  initrd_shell=N
:Interrupts the initramfs and drops to a shell at a specified location (rescue, install, repare), see the linuxrc for more locations. 

If no initrd_* parameter is specify, the initramfs will perform regular boot with no encryption support.

Example:
 initrd_util=aescrypt:/dev/sda1:ext2:/swap.key,/root.key initrd_devices=/dev/sda2,/dev/sda3 initrd_loopstart=4

This will load utilities from /dev/sda1 and map:
* /dev/loop4-&gt;/dev/sda2 with key from /swap.key
* /dev/loop5-&gt;/dev/sda3 with key from /root.key

=== Create Encryption Keys ===

==== Using a file ====

Run the following command:
{{Root|&lt;nowiki&gt;head -c 2925 /dev/random | uuencode -m - | head -n 66 | tail -n 65 |
        aescrypt -e -o /boot/root.key -&lt;/nowiki&gt;}}

==== Using PKCS#11 cryptographic token ====

Install pkcs11-data:
{{Root|emerge app-crypt/pkcs11-data}}

Run the following command, replacing pkcs11_provider_library with your PKCS#11 provider library:
{{Root|&lt;nowiki&gt;pkcs11-data --add-provider=pkcs11_provider_library --cmd=tokens&lt;/nowiki&gt;}}

The output will include all available tokens, select the correct token, the id='...' field is the token id to be used in next command.

Run the following command, replacing pkcs11_provider_library with your PKCS#11 provider library, and token_id with the output taken from previous command, please remember to add single quote for token_id.
{{Root|&lt;nowiki&gt;head -c 2925 /dev/random | uuencode -m - | head -n 66 | tail -n 65 |
        gzip | pkcs11-data --add-provider=pkcs11_provider_library --cmd=import \
                --token='token_id' --application=DISK --label=MY&lt;/nowiki&gt;}}

=== Loop-AES Framework ===

At least the following need to be in your /etc/fstab for your system to boot properly. The suspended image will be written to /dev/loop4. Remember that loop4 maps to sda2 and loop5 maps to sda3. At this time be sure that your system is capable of mounting and unmounting Loop-AES volumes.

Modify:
{{File|/etc/fstab|&lt;pre&gt;
/dev/sda1               /boot           ext2            defaults,noatime,ro     1 2
/dev/loop5              /               ext3            noatime                 0 1
/dev/loop4              none            swap            sw                      0 0
&lt;/pre&gt;}}

=== Actual Encrypting Step ===

Boot your new kernel with your new initramfs and the following arguments:
 root=/dev/sda3 initrd_shell=install

You should get a shell after the initramfs has setup itself correctly but before it has mounted any partitions.

This next step goes over all of /dev/sda3 (root partition) and encrypts it. Be sure that Loop-AES is functioning in your kernel, you have created the encryption keys and the encryption keys are available on the partition passed as initrd_util. If any of the above are not true it either will not work or you will lose all your data.

==== Encryption using aescrypt ====

Run the following command:

{{Root|mkdir /mnt}}
{{Root|&lt;nowiki&gt;mount -o ro /dev/sda1 /mnt&lt;/nowiki&gt;}}
{{Root|aescrypt -d -o /tmp/key1 /mnt/key1.key}}
{{Root|&lt;nowiki&gt;dd if=/dev/sda3 bs=64k | \
        aespipe -e AES256 -p 8 8&lt; /tmp/key1 | \
        dd of=/dev/sda3 bs=64k conv=notrunc&lt;/nowiki&gt;}}
{{Root|&lt;nowiki&gt;dd if=/dev/zero of=/tmp/key1 count=10000 conv=notrunc&lt;/nowiki&gt;}}
{{Root|rm /tmp/key1}}

==== Encryption using gpg key ====

Run the following command:

{{Root|mkdir /mnt}}
{{Root|&lt;nowiki&gt;mount -o ro /dev/sda1 /mnt&lt;/nowiki&gt;}}
{{Root|&lt;nowiki&gt;dd if=/dev/sda3 bs=64k | \
        aespipe -G / -K /mnt/root.gpg -e AES256 | \
        dd of=/dev/sda3 bs=64k conv=notrunc&lt;/nowiki&gt;}}

==== Encryption using PKCS#11 cryptographic token ====

First start PKCS#11 reader support, usually the following commands will do:

{{Root|&lt;nowiki&gt;for mod in `cat /etc/modules/pkcs11`; do modprobe ${mod}; done
mount -t usbfs usbfs /proc/bus/usb
pcscd --force-reader-polling                [--force-reader-polling requred for &gt;=pcsc-lite-1.4.0]&lt;/nowiki&gt;}}

Now perform the actual encryption, don't be alarmed that the key is exported to a file, since this file resides in memory, and there is no swap.

{{Root|&lt;nowiki&gt;pkcs11-data --add-provider=pkcs11_provider_library --cmd=export --application=DISK --label=MY | \
        gunzip &gt; /tmp/key1&lt;/nowiki&gt;}}
{{Root|&lt;nowiki&gt;dd if=/dev/sda3 bs=64k | \
        aespipe -e AES256 -p 8 8&lt; /tmp/key1 | \
        dd of=/dev/sda3 bs=64k conv=notrunc&lt;/nowiki&gt;}}
{{Root|&lt;nowiki&gt;dd if=/dev/zero of=/tmp/key1 count=10000 conv=notrunc&lt;/nowiki&gt;}}
{{Root|rm /tmp/key1}}

=== First success boot ===

If you use aescrypt key, reboot using the following arguments:
 root=/dev/loop5 initrd_encmode=loop-aes:AES256 initrd_util=aescrypt:/dev/sda1:ext2:/root.key \
        initrd_devices=/dev/sda3 initrd_loopstart=5

If you use PKCS#11 cryptographic token, reboot using the following arguments:
  root=/dev/loop5 initrd_encmode=loop-aes:AES256 initrd_util=pkcs11:DISK:MY \
        initrd_readers=openct initrd_devices=/dev/sda3 initrd_loopstart=5

You should be prompted for the key password and boot should succeed.

=== Handle swap ===

Now we need to encrypt your swap partition.

Create a new key for the swap partition as you have done for your root.

Reboot with the following arguments:
  root=/dev/loop5 initrd_encmode=loop-aes:AES256 initrd_util=gpgfile:/dev/sda1:ext2:/swap.gpg,/root.gpg \
        initrd_devices=/dev/sda2,/dev/sda3 initrd_loopstart=4 resume=/dev/loop4

You should be prompted for the password to the gpg key and boot should succeed.

After boot create swap file:

{{Root|mkswap /dev/loop4}}
{{Root|swapon -a}}

=== Congratulations ===

You have a working Loop-AES environment.

=== Software Suspend Framework ===

Now to get software uswsusp or TuxOnIce to work. For TuxOnIce specify a resume= parameter at kernel command-line, for uswsusp update /etc/suspend.conf of initramfs and on your root. Both should point to your swap partition (/dev/loop4).

Specify the suspend mode at kernel command-line
  initrd_suspend_mode=suspend2 or initrd_suspend_mode=uswsusp

If use uswsusp:
{{Root|emerge sys-power/suspend}}

==== hibernate.conf ====

Add the following lines to hibernate.conf.

This will check the boot partition on every resume, add:
{{File|/etc/hibernate/common.conf|&lt;pre&gt;
OnResume 00 /usr/bin/boot-digest-check
&lt;/pre&gt;}}

This will unmount boot partition so it can be mounted during boot by initramfs with no data loss, add:
{{File|/etc/hibernate/common.conf|&lt;pre&gt;
Unmount /boot
Mount /boot
&lt;/pre&gt;}}

If you are using fbsplsah, this will activate splash during suspend/resume, modify:
{{File|/etc/hibernate/common.conf|&lt;pre&gt;
FBSplash on
FBSplashTheme %%THEME%%
&lt;/pre&gt;}}

==== Syslinux ====

{{File|extlinux.conf|&lt;pre&gt;
PROMPT 0
DEFAULT menu

TIMEOUT 30
ONTIMEOUT x86_64-3.1.0-gentoo-r1

MENU TITLE Boot

LABEL x86_64-3.1.0-gentoo-r1
KERNEL kernel-x86_64-3.1.0-gentoo-r1
INITRD initramfs-x86_64-3.1.0-gentoo-r1
APPEND root=/dev/sda3 rootfstype=ext4 ro video=inteldrmfb:1920x1200-32@60 splash=silent,fadein,theme:livecd-2007.0 quiet console=tty1 initrd_suspend_mode=uswsusp resume=/dev/sda2 intel_iommu=off initrd_encmode=loop-aes:AES256 initrd_util=gpgfile:ext2:/dev/sda1:/swap.gpg,/root.gpg initrd_devices=/dev/sda2,/dev/sda3 initrd_loopstart=4

LABEL menu
MENU HIDE
KERNEL vesamenu.c32
&lt;/pre&gt;}}

{{Note|&lt;nowiki&gt;This example is using the frame buffer driver rather than vanilla vesafb. Plain vesafb would require an additional argument similar to: vga=791&lt;/nowiki&gt;}}

== Boot partition integrity ==

sys-apps/boot-digest is available via overlay at http://github.com/alonbl/alon-barlev-overlay.git .

Use boot-digest-mark utility in order to store the digest of the boot partition, so that you will be notified if it is changed. Configure your system to run boot-digest-check during your boot process.

{{Root|emerge sys-apps/boot-digest}}
{{Root|rc-update addd boot-digest-check boot}}

After you finish all your modifications, you should mark the current boot partition's digest:

{{Root|boot-digest-mark}}

During boot or resume, you will receive a warning message if someone has tampered with your unencrypted boot partition.

==== Trying It All Out ====

Now try to hibernate... Good luck!

== Extras ==

=== Using PKCS#11 cryptographic tokens ===

You can use PKCS#11 cryptographic tokens to hold secret key. The symmetric keys are stored on the card as private data object. The advantage to this approach is that it is stronger that using RSA encryption on the symmetric keys.

Create a file /etc/pkcs11.conf with the following format, replace pkcs11_provider_library with the actual name of the PKCS#11 provider library.
{{File|/etc/pkcs11.conf|&lt;pre&gt;
--token-wait --add-provider=pkcs11_provider_library
&lt;/pre&gt;}}

You should have udev/mdev support and pcscd in the initramfs and specify initrd_util=pkcs11 as a kernel parameter.

A utility pkcs11-data for import/export of data objects is also required.

Since PKCS#11 provider is a dynamic library, some components of initramfs cannot be compiled statically.

You can import existing gpg keys to smartcard by using the following sequence.

Run the following command, replacing pkcs11_provider_library with your PKCS#11 provider library:

{{Root|&lt;nowiki&gt; pkcs11-data  --add-provider=pkcs11_provider_library --cmd=tokens&lt;/nowiki&gt;}}

The output will include all available tokens, select the correct token, the id='...' field is the token id to be used in next command.

Run the following command, replacing pkcs11_provider_library with your PKCS#11 provider library, and token_id with the output taken from previous command, please remember to add single quote for token_id.

{{Root|&lt;nowiki&gt;gpg &lt; keyfile.gpg | gzip | pkcs11-data --add-provider=pkcs11_provider_library --cmd=import --token='token_id' \
	--application=DISK --label=MY&lt;/nowiki&gt;}}

=== Reverting ===

You can revert and decrypt your filesystems. Boot your new kernel with your new initramfs and the following arguments:
  root=/dev/sda3 initrd_shell=install

You should get a shell after the initramfs has setup itself correctly but before it has mounted any partitions.

=== Decryption using gpg key ===

Run the following command:

{{Root|mkdir /mnt}}
{{Root|mount -o ro /dev/sda1 /mnt}}
{{Root|&lt;nowiki&gt;dd if=/dev/sda3 bs=64k | \
        aespipe -G / -K /mnt/keyfile.gpg -e AES256 -d | \
        dd of=/dev/sda3 bs=64k conv=notrunc&lt;/nowiki&gt;}}

=== Decryption using PKCS#11 cryptographic token ===

First start PKCS#11 reader support, usually the following commands will do:

{{Root|for mod in `cat /etc/modules/pkcs11`; do modprobe ${mod}; done}}
{{Root|mount -t usbfs usbfs /proc/bus/usb}}

{{Root|pcscd}}
or:
{{Root|mkdir /var/run/openct}}
{{Root|openct-control init}}

Now perform the actual decryption, don't be alarmed that the key is exported to a file, since this file resides in memory, and there is no swap.

{{Root|&lt;nowiki&gt;pkcs11-data --add-provider=pkcs11_provider_library --cmd=export --application=DISK --label=MY | \
        gunzip &gt; /tmp/key1&lt;/nowiki&gt;}}
{{Root|&lt;nowiki&gt;dd if=/dev/sda3 bs=64k | \
        aespipe -e AES256 -d -p 8 8&lt; /tmp/key1 | \
        dd of=/dev/sda3 bs=64k conv=notrunc&lt;/nowiki&gt;}}
{{Root|&lt;nowiki&gt;dd if=/dev/zero of=/tmp/key1 count=10000 conv=notrunc&lt;/nowiki&gt;}}
{{Root|rm /tmp/key1}}

== Open issues ==

There is no known way to protect against sophisticated kernel attach on the unencrypted boot partition that will cause the hash check to succeed but will write your password on a location of the disk.

For now the only way to detect this is to digest the boot partition and compare it to hashes stored on the encrypted file system. This comparison is run during every boot and every resume from suspend.

In order to minimize the access of external people to this partition, consider putting the kernel and initramfs on a USB mass storage device and boot from this device. Combining with PKCS#11 cryptographic token it is the best solution.

== initramfs ==

=== Busybox ===

==== Applets ====

{{Codeline|&lt;pre&gt;
[
cat
chroot
chvt                                (Optional, splash)
cp
dd
echo
grep
killall
ln
mdev                                (Optional, mdev)
mkdir
mknod
modprobe
mount
sh
stty                                (Optional, gpg)
test
sed
switch_root
tty
rm
rmmod
umount
&lt;/pre&gt;}}

In case smartcards are used or plug&amp;play is needed for USB storage, additions to genkernel default configuration:
  CONFIG_FEATURE_DD_IBS_OBS # for initial encryption (notrunc)
  CONFIG_FEATURE_MDEV_CONF
  CONFIG_FEATURE_MDEV_EXEC

=== Initramfs Structure ===

{{Codeline|&lt;pre&gt;
+-+-/
  +-+- dev
  | +--- fb0                         (Optional, fbsplash &amp;&amp; !mdev)
  | +--- fbsplash                    (Optional, fbsplash &amp;&amp; !mdev)
  | +--- snapshot                    (Optional, uswsusp &amp;&amp; !mdev)
  | +--- sd[a-d][0-4]                (Optional, !mdev)
  | +--- loop?                       (Optional, !mdev)
  +-+- etc
  | +--- suspend.conf                (Optional, uswsusp)
  | +--- pkcs11.conf                 (Optional, PKCS#11)
  | +--- splash                      (Optional, fbsplash)
  | \-+- modules
  |   +--- boot                      (a list of modules required for boot)
  |   +--- pkcs11                    (Optional, a list of modules required for PKCS#11)
  |   \--- suspend2                  (a list of modules required for TuxOnIce resume)
  +-+- lib
  | \-+- modules
  |   \-+- `uname -r`
  |     +-+- block
  |     | \--- loop.ko
  |     \-+- kernel
  |       \-+- crypto
  |         \--- lzf.ko              (If you want to compress your TuxOnIce image)
  +-+- sbin
  | +--- losetup.crypt               (Must be different name than busybox losetup)
  | +--- fbcondecor_helper           (Optional, fbsplash)
  | +--- tuxoniceui_fbsplash         (Optional, TuxOnIce &amp;&amp; fbsplash)
  | +--- tuxoniceui_text             (Optional, TuxOnIce &amp;&amp; text)
  | \--- resume                      (Optional, uswsusp)
  \-+- usr
    +-+- bin
    | +--- aespipe
    | +--- gpg                       (Optional, no PKCS#11)
    | +--- gpg-agent                 (Optional, no PKCS#11, gnupg&gt;=2.0)
    | +--- aescrypt                  (Optional, no PKCS#11, aescrypt)
    | \--- pkcs11-data               (Optional, PKCS#11)
    +-+- lib
    | \--- readers                   (Optional, pcsc)
    \-+- sbin
      +--- pcscd                     (Optional, pcsc)
      +--- openct-control            (Optional, openct)
      \--- ifdhandler                (Optional, openct)
&lt;/pre&gt;}}

=== linuxrc ===

{{Code|linuxrc|&lt;pre&gt;
#!/bin/sh
# Copyright 2005-2011 Alon Bar-Lev &lt;alon.barlev@gmail.com&gt;
# Distributed under the terms of the GNU General Public License v2
#
# The following standard kernel parameters are supported:
#	root		root device
#	rootfstype	root filesystem type (optional, default is auto detection)
#	ro		mount root as read only
#	[0-9]|S		runlevel
#
# The following custom kernel parameters are supported:
#       initrd_kmap=kmap[:font]
#	       Fullpath(inside initramfs /) to kmap and font(optional).
#	initrd_shell=N
#		Interrupts the initramfs and drops to a shell at a specified location
#		(0-none,1-on start,2-after setup,etc..), see the linuxrc for more locations.
#		Special N=resuce, N=install, N=repair
#       initrd_encmode=&lt;mode&gt;
#		&lt;empty&gt;
#			No encryption.
#		loop-aes[:cipher]
#			Enables loop-AES support.
#		dm-crypt
#			Enables DM-Crypt support.
#	initrd_util
#		pkcs11:application:label,label,label
#			use PKCS#11 smartcards.
#		gpgfile|aescrypt|keyfile:device:fstype:file,file,file[:passphrase]
#			use gnupg or aes crypt file located at device.
#			wait for device to be available.
#			device can be 'none'
#		passphrase:id,id,id			(dm-crypt)
#			use passphrases read from the user, each
#			id signify passphrase for a device, id
#			may be the same.
#	initrd_devices
#		Devices for encryption setup.
#	initrd_suspend_mode
#		tuxonice
#		uswsusp
#	initrd_resume_ui
#		auto (default)
#		none
#		fbsplash
#		text
#
#	initrd_readers
#		pcscd
#			Run pcscd.
#		openct
#			Run openct.
#
#	loop-aes specific
#       -----------------
#	initrd_loopstart=N
#		The first loop index (/dev/loopN)
#
#	dm-crypt specific
#       -----------------
#	initrd_dmnames=name,name
#		Logical names for dmsetup
#
# The following module lists are used files at /dev/modules:
#	boot		boot time modules loaded but not removed.
#	tuxonice	TuxOnIce modules.
#	remdev		modules required to access removable media.
#	pkcs11		modules required to access smartcard.
#
# Examples:
#    loop-AES
#	root=/dev/loop5 rootfstype=ext3 ro \
#		video=radeonfb:1400x1050-32@60 acpi_sleep=s3_bios \
#		splash=silent,fadein,theme:livecd-2006.0 quiet console=tty1 \
#		initrd_encmode=loop-aes \
#		initrd_util=gpgfile:/dev/sda1:ext2:/keys/swap.gpg,/keys/root.gpg \
#		initrd_devices=/dev/hda2,/dev/hda3 initrd_loopstart=4 \
#		initrd_suspend_mode=tuxonice resume=swap:/dev/loop4
#
#     DM-Crypt
#	root=/dev/sda3 \
#		video=radeonfb:1400x1050-32@60 acpi_sleep=s3_bios \
#		splash=verbose,theme:livecd-2006.0 quiet console=tty1 \
#		initrd_encmode=dm-crypt \
#		initrd_util=gpgfile:/dev/sdb1:ext2:/keys/swap.gpg,/keys/root.gpg \
#		initrd_devices=/dev/sda2,/dev/sda3 initrd_dmnames=swap,root
#		initrd_suspend_mode=tuxonice resume=swap:/dev/mapper/swap 
#
# History
# -----------------
# 2012.10.10 - Alon Bar-Lev
#	Added support for aescrypt as alternative of gpg
# 2008.05.06 - Alon Bar-Lev
#	Added initrd_readers= parameters.
#	People who used smartcards need to add initrd_readers=pcscd
#	to keep their configuration working.
# 2008.05.03 - Casper Biering
#	Fix typo in keymap.
# 2008.03.23 - Alon Bar-Lev
#	Update to newer busybox that genkernel supports.
# 2007.11.04 - Matyas Tibor
#	gpg --log-file -&gt; gpg --logger-file
# 2007.11.03 - Alon Bar-Lev
#	TuxOnIce changes.
#	initrd_suspend_mode must be specified on command-line.
# 2007.09.07 - Alon Bar-Lev
#	Added resume= parameter support.
#	Make resume device and splash aware.
# 2007.08.17 - Alon Bar-Lev
#	splashutils-0.5 required.
# 2007.07.14 - Alon Bar-Lev
#	Add uswsusp support.
# 2007.06.04 - Alon Bar-Lev
#	Fixup newroot issue.
#	Fixup initrd_shell to have rescue, install, repair.
# 2007.05.06 - Alon Bar-Lev
#	Support a configuration without legacy sysfs
# 2006.10.19 - Federico Zagarzazú, Alon Bar-Lev
#	Added support for dm-crupt
#	Added support for simple files for storing key
#	Switched to busybox's switch_root
# 2006.10.10 - Alon Bar-Lev
#	Fixed gpg handling, many thanks to Pat Double for doing the tests.
# 2006.09.29 - Alon Bar-Lev
#	Merged some of Federico work.
#	Modified format for initrd_util gpgfile, added fstype.
# 2006.09.07 - Federico Zagarzazú
# 	Initial support for dm-crypt (via cryptsetup(luks))
#	Some style changes.
#	Added support to load kmap and font.
#	Added f_echo for fancy init messages.
#	Support verbose splash at bootup.
# 2006.08.25 - Alon Bar-Lev
#	Switched udev into busybox mdev.
#	Moved PKCS#11 application and label into command line.
#	As recommended from Jari Ruusu a seperate key is required for each loop.
# 2006.05.07 - Alon Bar-Lev
#	Added cipher local option.
#	Removed writing the key into memory file.
# 2006.05.01 - Alon Bar-Lev
#	Added gpg static passphrase option.
# 2006.04.30 - Alon Bar-Lev
#	Allow linuxrc.local to supply defaults.
# 2006.04.27 - Alon Bar-Lev
#	Change initrd_util parameter:
#		pkcs11
#		gpgfile:device:file
#	Support for wait for util device if gpgfile.
#	No need to have stty anymore since gpg does it for us.
# 2006.02.01 - Alon Bar-Lev
#	Support of disabling selected stages.
# 2006.01.24 - Alon Bar-Lev
#	Move to fbsplashds in daemon mode,
#	since none-daemon mode does not paint splash currectly.
# 2005.11.24 - Alon Bar-Lev
#	Added udev support.
#	Added PKCS#11 support.
# 2005.06.07 - Alon Bar-Lev
#	Written template from gentoo.org.
#

# don't edit
global_splash_verbose=0
global_mdev_active=0

# colors
color_black='\x1b[30;01m'
color_red='\x1b[31;01m'
color_green='\x1b[32;01m'
color_yellow='\x1b[33;01m'
color_blue='\x1b[34;01m'
color_off='\x1b[0;0m'

#
# The following variables can(and should) be
# overidden by cryptfs
#

# General 
cfg_setup_initramfs=1		# Setup initramfs enviroment.
cfg_install_applets=1		# Install busybox applets at runtime(creates symlinks for all applets
				# that are compiled into busybox).
cfg_start_mdev=1		# Start mdev(Busybox's mini-udev implementation)
cfg_shell_checkpoint=0		# Shell checkpoint (initrd_shell)
cfg_tmp_keys_rep=/tmp/keys	# Where keys are temporary stored
cfg_tmp_keys_stat=/tmp/keys	# Where keys status stored
cfg_kmap=			# Load kmap (initrd_kmap)
cfg_font=			# Load font (initrd_kmap)
cfg_init=/sbin/init		# Init to execute from root device
cfg_newroot=/newroot		# Mountpoint for root
cfg_remmnt=/mnt			# Mountpoint for removable device
cfg_root_device=		# Root device (root)
cfg_root_mode=ro		# Root mount mode (ro)
cfg_root_type=			# Root filesystem type (rootfstype)
cfg_resume_device=		# Resume device.
cfg_hand_root_control=1		# Execute init from root device
cfg_util_type=			# Type of utility (gpgfile,aescrypt,pkcs11,passphrase,keyfile) (initrd_util)
cfg_remdev=			# Device assigned to removable media for gpgfile|aescrypt utility. (initrd_util=gpgfile|aescrypt)
cfg_remdev_fs=			# Device assigned to removable media for gpgfile|aescrypt utility. (initrd_util=gpgfile|aescrypt)
cfg_key_files=			# Files, one for each loop/device, comma separated (initrd_util=gpgfile|aescrypt)
cfg_gpg_pass=			# Static passphrase (initrd_util=gpgfile|aescrypt)
cfg_pkcs11_application=		# PKCS#11 data object application name (initrd_util=pkcs11)
cfg_pkcs11_labels=		# PKCS#11 data object labels, one for each loop, (initrd_util=pkcs11)
cfg_pkcs11_pass=	 	# PKCS#11 PIN (initrd_util=pkcs11)
cfg_passphrase_id=		# Passphrase comma separated ides (initrd_util=passphrase)
cfg_devices=			# Devices to decrypt (initrd_devices)
cfg_suspend_mode=		# Type of suspend/resume to use
cfg_resume_ui=auto		# Type of ui for resume

# loop-AES
cfg_loopaes=0			# 1 == loopAES support enabled (initrd_encmode=loop-aes)
cfg_loopstart=0			# Loop start index (initrd_loopstart)
cfg_cipher=&quot;AES256&quot;             # Encryption cipher

# dm-crypt
cfg_dmcrypt=0			# 1 == dm-crypt support enabled (initrd_encmode=dm-crypt)
cfg_dmnames=			# Logical names of DM crypt
cfg_keyfile_files=		# Files(keyfiles), one for each device, comma separated (initrd_util=keyfile)

# readers
cfg_openct=0			# Enable openct
cfg_pcscd=0			# Enable pcscd

if [ -e /linuxrc.local ]; then
	. /linuxrc.local
fi

f_parse_head() {
	local s=&quot;${1}&quot;
	local d=&quot;${2}&quot;

	echo &quot;${s%%${d}*}&quot;
}

f_parse_remove_head() {
	local s=&quot;${1}&quot;
	local d=&quot;${2}&quot;
	
	local r=&quot;${s#*${d}}&quot;
	if [ &quot;${r}&quot; = &quot;${s}&quot; ]; then
		echo &quot;&quot;
	else
		echo &quot;${r}&quot;
	fi
}

f_echo() {
	local type=&quot;${1}&quot;
	local msg=&quot;${2}&quot;
	local opts=&quot;${3}&quot;
	local eopts
	local colors_on
	local colors_off

	if [ &quot;${cfg_color_msg}&quot; != 0 ]; then
		colors_off=&quot;${color_off}&quot;

		case &quot;${type}&quot; in
			err)
				colors_on=&quot;${color_red}&quot;
			;;
			inf)
				colors_on=&quot;${color_yellow}&quot;
			;;
			msg|*)
				colors_on=&quot;${color_green}&quot;
			;;
		esac

		local o
		for o in $(echo &quot;${opts}&quot; | sed 's/,/ /'); do
			case &quot;${o}&quot; in
				nonl)
					eopts=&quot;$eopts -n&quot;
				;;
			esac
		done
	fi

	echo ${eopts} -e &quot; ${colors_on}*${color_off} ${msg}&quot;
}

f_modprobe_group() {
	local group=&quot;${1}&quot;

	# Add -k on &gt;=busybox-1.8
	[ -f &quot;/etc/modules/${group}&quot; ] &amp;&amp; cat &quot;/etc/modules/${group}&quot; | xargs -n1 modprobe &gt; /dev/null 2&gt;&amp;1
}

f_rmmod_group() {
	local group=&quot;${1}&quot;

	# use modprobe -r on &gt;=busybox-1.8
	[ -f &quot;/etc/modules/${group}&quot; ] &amp;&amp; cat &quot;/etc/modules/${group}&quot; | xargs -n1 rmmod &gt; /dev/null 2&gt;&amp;1
	rmmod -a
}

f_killallwait() {
	local p=&quot;${1}&quot;

	while killall -q -3 &quot;${p}&quot;; do
		sleep 1
	done
}

f_die() {
	local message=&quot;${1}&quot;

	f_splash_verbose

	f_echo err &quot;${message}&quot;
	exec /bin/sh
}

f_shell_checkpoint() {
	local level=&quot;${1}&quot;

	if [ &quot;${cfg_shell_checkpoint}&quot; = &quot;${level}&quot; ]; then
		f_splash_verbose
		exec /bin/sh
	fi
}

f_splash_verbose() {
	[ &quot;${global_splash_verbose}&quot; = 0 ] &amp;&amp; chvt 1
}

f_splash_silent() {
	[ &quot;${global_splash_verbose}&quot; = 0 ] &amp;&amp; chvt 2
}

f_splash_message() {
	local msg=&quot;${1}&quot;
	[ &quot;${global_splash_verbose}&quot; = 0 ] &amp;&amp; BOOT_MSG=&quot;${msg}&quot; fbcondecor_helper 2 'repaint'
}

f_loadkmap() {
	if [ -n &quot;${cfg_kmap}&quot; ]; then
		if [ -e &quot;${cfg_kmap}&quot; ]; then
			loadkmap &lt; &quot;${cfg_kmap}&quot;
		else
			f_die &quot;Error: keymap \&quot;${cfg_kmap}\&quot; does not exist.&quot;
		fi
	fi
	if [ -n &quot;${cfg_font}&quot; ]; then
		if [ -e &quot;${cfg_font}&quot; ]; then
			loadfont &lt; &quot;${cfg_font}&quot;
		else
			f_die &quot;Error: font \&quot;${cfg_font}\&quot; does not exist.&quot;
		fi
	fi
}

f_hand_root_control() {
	[ -d &quot;${cfg_newroot}&quot; ] || mkdir &quot;${cfg_newroot}&quot;

	mount -o &quot;${cfg_root_mode}&quot; ${cfg_root_type:+-t &quot;${cfg_root_type}&quot;} \
		&quot;${cfg_root_device}&quot; &quot;${cfg_newroot}&quot; || f_die &quot;Cannot mount root filesystem&quot;

	f_stop_mdev
	umount /proc
	umount /sys

	exec switch_root -c &quot;/dev/console&quot; &quot;${cfg_newroot}&quot; &quot;${cfg_init}&quot; ${init_arg}
}

f_setup_mdev() {
	if [ -x /sbin/mdev ]; then
		/sbin/mdev -s
		echo /sbin/mdev &gt; /proc/sys/kernel/hotplug
		global_mdev_active=1
	fi
}

f_stop_mdev() {
	if [ ${global_mdev_active} != 0 ]; then
		echo &gt; /proc/sys/kernel/hotplug
	fi
}

f_reset_environment() {
	export PATH=&quot;${OLDPATH}&quot;
}

f_mount_remdev() {
	f_shell_checkpoint 302
	f_modprobe_group &quot;remdev&quot;

	local first_time=1
	while ! mount -n -o ro ${cfg_remdev_fs:+-t &quot;${cfg_remdev_fs}&quot;} &quot;${cfg_remdev}&quot; &quot;${cfg_remmnt}&quot; &gt; /dev/null 2&gt;&amp;1; do
		if [ ${first_time} != 0 ]; then
			f_echo inf &quot;Please insert removable device ${cfg_remdev}...&quot;
			first_time=0
		fi
		sleep 2
	done
	f_shell_checkpoint 303
}

f_umount_remdev() {
	umount -n &quot;${cfg_remmnt}&quot;
	f_rmmod_group &quot;remdev&quot;
}

f_resume_uswsusp() {
	local args
	local features=&quot;$(resume --version | grep FEATURES)&quot;
	[ -n &quot;${cfg_resume_device}&quot; ] &amp;&amp; args=&quot;${args} --resume_device=${cfg_resume_device}&quot;
	echo &quot;${features}&quot; | grep fbsplash &gt; /dev/null &amp;&amp; [ -n &quot;${splash_theme}&quot; -a &quot;${global_splash_verbose}&quot; = 0 ] &amp;&amp; [ &quot;${cfg_resume_ui}&quot; = &quot;auto&quot; -o &quot;${cfg_resume_ui}&quot; = &quot;fbsplash&quot; ] &amp;&amp; args=&quot;${args} --parameter=\&quot;splash=y\&quot;&quot;
	eval resume ${args}
}

f_resume_tuxonice() {
	local tuxonice_userui_program=&quot;/sys/power/tuxonice/user_interface/program&quot;
	local tuxonice_do_resume=&quot;/sys/power/tuxonice/do_resume&quot;
	local tuxonice_resume=&quot;/sys/power/tuxonice/resume&quot;

	#
	# Backward compatibility
	#
	if [ -e /proc/suspend2 ]; then
		tuxonice_userui_program=&quot;/sys/power/suspend2/user_interface/program&quot;
		tuxonice_do_resume=&quot;/sys/power/suspend2/do_resume&quot;
		tuxonice_resume=&quot;/sys/power/suspend2/resume2&quot;
	elif [ -e /proc/suspend2 ]; then
		tuxonice_userui_program=&quot;/proc/suspend2/userui_program&quot;
		tuxonice_do_resume=&quot;/proc/suspend2/do_resume&quot;
		tuxonice_resume=&quot;/proc/suspend2/resume2&quot;
	fi

	f_modprobe_group &quot;tuxonice&quot;
	[ -n &quot;${splash_theme}&quot; ] &amp;&amp; ln -s &quot;/etc/splash/${splash_theme}&quot; /etc/splash/suspend2
	if [ &quot;${cfg_resume_ui}&quot; != &quot;none&quot; -a &quot;${global_splash_verbose}&quot; = 0 ]; then
		if [ &quot;${cfg_resume_ui}&quot; = &quot;auto&quot; ]; then
			if [ -z &quot;${splash_theme}&quot; ]; then
				if which &quot;suspend2ui_text&quot; &gt; /dev/null 2&gt;&amp;1; then
					which &quot;suspend2ui_text&quot; &gt; &quot;${tuxonice_userui_program}&quot;
				fi
				if which &quot;tuxonice_text&quot; &gt; /dev/null 2&gt;&amp;1; then
					which &quot;tuxonice_text&quot; &gt; &quot;${tuxonice_userui_program}&quot;
				fi
			else
				if which &quot;suspend2ui_fbsplash&quot; &gt; /dev/null 2&gt;&amp;1; then
					which &quot;suspend2ui_fbsplash&quot; &gt; &quot;${tuxonice_userui_program}&quot;
				fi
				if which &quot;tuxonice_fbsplash&quot; &gt; /dev/null 2&gt;&amp;1; then
					which &quot;tuxonice_fbsplash&quot; &gt; &quot;${tuxonice_userui_program}&quot;
				fi
			fi
		else
			if which &quot;suspend2ui_${cfg_resume_ui}&quot;; &gt; /dev/null 2&gt;&amp;1; then
				which &quot;suspend2ui_${cfg_resume_ui}&quot; &gt; &quot;${tuxonice_userui_program}&quot;
			fi
			if which &quot;tuxonice_${cfg_resume_ui}&quot;; &gt; /dev/null 2&gt;&amp;1; then
				which &quot;tuxonice_${cfg_resume_ui}&quot; &gt; &quot;${tuxonice_userui_program}&quot;
			fi
		fi
	fi
	[ -n &quot;${cfg_resume_device}&quot; ] &amp;&amp; echo &quot;${cfg_resume_device}&quot; &gt; &quot;${tuxonice_resume}&quot;
	echo &gt; &quot;${tuxonice_do_resume}&quot;
	f_rmmod_group tuxonice
}

f_resume() {
	case &quot;${cfg_suspend_mode}&quot; in
		tuxonice)	f_resume_tuxonice;;
		uswsusp)	f_resume_uswsusp;;
	esac
}

f_keys_read_pkcs11() {

	f_shell_checkpoint 101
	f_modprobe_group &quot;pkcs11&quot;
	if [ &quot;${cfg_pcscd}&quot; != &quot;0&quot; ]; then
		mount -n -t usbfs usbfs /proc/bus/usb
		sleep 3	# usbfs takes time
		pcscd --force-reader-polling
	fi
	if [ &quot;${cfg_openct}&quot; != &quot;0&quot; ]; then
		mkdir -p /var/run/openct
		openct-control init
	fi
	f_shell_checkpoint 102

	local labels=&quot;${cfg_pkcs11_labels}&quot;
	local index=0
	local pkcs11_objects
	while [ -n &quot;${labels}&quot; ]; do
		local label

		label=$(f_parse_head &quot;${labels}&quot; &quot;,&quot;)
		labels=$(f_parse_remove_head &quot;${labels}&quot; &quot;,&quot;)

		pkcs11_objects=&quot;${pkcs11_objects} \&quot;--application=${cfg_pkcs11_application}\&quot; \&quot;--label=${label}\&quot; \&quot;--file=${cfg_tmp_keys_rep}/${index}.raw\&quot;&quot;

		index=$((${index}+1))
	done

	while ! eval pkcs11-data $(cat /etc/pkcs11.conf) --cmd=export ${pkcs11_objects}; do
		f_echo msg &quot;Please try again.&quot;
	done

	local key
	for key in &quot;${cfg_tmp_keys_rep}&quot;/*; do
		gunzip -c &quot;${key}&quot; &gt; $(echo ${key} | sed 's/.raw//').key
	done

	f_shell_checkpoint 103
	if [ &quot;${cfg_pcscd}&quot; != &quot;0&quot; ]; then
		f_killallwait pcscd
		while ! umount -n /proc/bus/usb &gt; /dev/null 2&gt;&amp;1; do
			sleep 1
		done
	fi
	if [ &quot;${cfg_openct}&quot; != &quot;0&quot; ]; then
		openct-control shutdown &gt; /dev/null
	fi
	f_shell_checkpoint 104
	f_rmmod_group &quot;pkcs11&quot;
	f_shell_checkpoint 105
}

f_keys_read_aescrypt() {

	local index=0
	local bad_pass=1
	while [ ${bad_pass} != 0 ]; do
		if [ -z &quot;${cfg_pass}&quot; ]; then
			stty -echo
			echo -n &quot;Passphrase: &quot;
			read cfg_pass
			echo
			stty echo
		fi
		bad_pass=0

		local file
		for file in $(echo &quot;${cfg_key_files}&quot; | sed 's/,/ /g'); do
			if ! [ -f &quot;${cfg_remmnt}/${file}&quot; ]; then
				f_die &quot;Cannot access ${cfg_remdev}:${file}&quot;
			fi

			if ! aescrypt -d -p &quot;${cfg_pass}&quot; \
				-o &quot;${cfg_tmp_keys_rep}/${index}.key&quot; \
				&quot;${cfg_remmnt}/${file}&quot;; then
				bad_pass=1
			else
				index=$((${index}+1))
			fi
		done

		unset cfg_pass

		if [ ${bad_pass} != 0 ]; then
			echo &quot;Please try again.&quot; &gt;&amp;2
		fi
	done
}

f_keys_read_gpg() {

	local index=0
	local bad_pass=1
	while [ ${bad_pass} != 0 ]; do
		if [ -z &quot;${cfg_pass}&quot; ]; then
			stty -echo
			echo -n &quot;Passphrase: &quot;
			read cfg_pass
			echo
			stty echo
		fi
		bad_pass=0

		local file
		for file in $(echo &quot;${cfg_key_files}&quot; | sed 's/,/ /g'); do
			if ! [ -f &quot;${cfg_remmnt}/${file}&quot; ]; then
				f_die &quot;Cannot access ${cfg_remdev}:${file}&quot;
			fi

			if ! echo &quot;${cfg_pass}&quot; | \
				gpg --homedir / \
					--batch \
					--logger-file /dev/null \
					--passphrase-fd 0 \
					--decrypt &quot;${cfg_remmnt}/${file}&quot; &gt; \
			 		&quot;${cfg_tmp_keys_rep}/${index}.key&quot;; then

				bad_pass=1
			else
				index=$((${index}+1))
			fi
		done

		unset cfg_pass

		if [ ${bad_pass} != 0 ]; then
			echo &quot;Please try again.&quot; &gt;&amp;2
		fi
	done
}

f_keys_read_keyfile() {
	local index=0 file
	for file in $(echo &quot;${cfg_keyfile_files}&quot; | sed 's/,/ /g'); do
		if ! [ -f &quot;${cfg_remmnt}/${file}&quot; ]; then
			f_die &quot;Cannot access ${cfg_remdev}:${file}&quot;
		else
			cp &quot;${cfg_remmnt}/${file}&quot; &quot;${cfg_tmp_keys_rep}/${index}.key&quot;
		fi
		index=$((${index}+1))
	done
}

f_keys_read_passphrase() {
	local first_time=0
	local index=0
	local id

	#
	# If no rejects assume first time
	#
	[ &quot;$(find &quot;${cfg_tmp_keys_stat}&quot;)&quot; = &quot;${cfg_tmp_keys_stat}&quot; ] &amp;&amp; first_time=1

	for id in $(echo &quot;${cfg_passphrase_id}&quot; | sed 's/,/ /g'); do

		#
		# If first time or rejected
		#
		if [ &quot;${first_time}&quot; != 0 -o -f &quot;${cfg_tmp_keys_stat}/${index}.rejected&quot; ]; then
			
			rm -f &quot;${cfg_tmp_keys_stat}/${index}.rejected&quot; &gt; /dev/null 2&gt;&amp;1

			if [ -f &quot;${cfg_tmp_keys_rep}/passphrase_${id}&quot; ]; then
				cp &quot;${cfg_tmp_keys_rep}/passphrase_${id}&quot; &quot;${cfg_tmp_keys_rep}/${index}.key&quot;
			else
				local password

				stty -echo
				echo -n &quot;Passphrase (${id}): &quot;
				read password
				echo
				stty echo

				echo &quot;${password}&quot; &gt; &quot;${cfg_tmp_keys_rep}/${index}.key&quot;
				echo &quot;${password}&quot; &gt; &quot;${cfg_tmp_keys_rep}/passphrase_${id}&quot;
			fi
		fi

		index=$((${index}+1))
	done
}

f_keys_clean() {
	if [ -d &quot;${cfg_tmp_keys_rep}&quot; ]; then
		local i
		for i in &quot;${cfg_tmp_keys_rep}&quot;/*; do
			dd if=/dev/zero &quot;of=${i}&quot; conv=notrunc bs=1024 count=10 &gt; /dev/null 2&gt;&amp;1
		done
		rm -fr &quot;${cfg_tmp_keys_rep}&quot;
	fi
}

f_keys_read() {

	[ -d &quot;${cfg_tmp_keys_rep}&quot; ] || mkdir -p &quot;${cfg_tmp_keys_rep}&quot;
	[ -d &quot;${cfg_tmp_keys_stat}&quot; ] || mkdir -p &quot;${cfg_tmp_keys_stat}&quot;

	f_shell_checkpoint 201

	case &quot;${cfg_util_type}&quot; in
		pkcs11)
			f_keys_read_pkcs11
		;;
		gpgfile|aescrypt|keyfile)
			f_mount_remdev
			case &quot;${cfg_util_type}&quot; in
				gpgfile) f_keys_read_gpg ;;
				aescrypt) f_keys_read_aescrypt ;;
				keyfile) f_keys_read_keyfile ;;
			esac
			f_umount_remdev
		;;
		passphrase)
			f_keys_read_passphrase
		;;
	esac

	f_shell_checkpoint 202
}

f_opendevices_loopaes() {
	local error=0

	#
	# map loop devices
	#
	local index=0
	local device
	for device in $(echo &quot;${cfg_devices}&quot; | sed 's/,/ /g'); do
		local keyfile=&quot;${cfg_tmp_keys_rep}/${index}.key&quot;

		if [ -f &quot;${keyfile}&quot; ]; then
			if ! losetup.crypt -p 0 -e &quot;${cfg_cipher}&quot; \
				&quot;/dev/loop$((${cfg_loopstart}+${index}))&quot; \
				&quot;${device}&quot; &lt; &quot;${keyfile}&quot;; then

				touch &quot;${cfg_tmp_keys_stat}/${index}.rejected&quot;
				f_echo err &quot;Cannot loop ${device}&quot;
				error=1
			fi
		fi

		index=&quot;$((${index}+1))&quot;
	done

	return &quot;${error}&quot;
}

f_opendevices_dmcrypt() {
	local error=0

	#
	# map loop devices
	#
	local index=0
	local names=&quot;${cfg_dmnames}&quot;
	local device
	for device in $(echo &quot;${cfg_devices}&quot; | sed 's/,/ /g'); do

		local name=$(f_parse_head &quot;${names}&quot; &quot;,&quot;)
		names=$(f_parse_remove_head &quot;${names}&quot; &quot;,&quot;)
		[ &quot;${device}&quot; == &quot;${cfg_root_device}&quot; ] &amp;&amp; cfg_root_device=&quot;/dev/mapper/${name}&quot;

		local keyfile=&quot;${cfg_tmp_keys_rep}/${index}.key&quot;

		if [ -f &quot;${keyfile}&quot; ]; then

			f_echo msg &quot;Opening ${name}...&quot;

			local gen_prm
			if cryptsetup isLuks &quot;${device}&quot; &gt; /dev/null 2&gt;&amp;1; then
				gen_prm=&quot;luksOpen \&quot;${device}\&quot; \&quot;${name}\&quot;&quot;
			else
				gen_prm=&quot;create \&quot;${name}\&quot; \&quot;${device}\&quot;&quot;
			fi

			local stdin_file
			local key_prm
			if [ &quot;${cfg_util_type}&quot; = &quot;passphrase&quot; ]; then
				stdin_file=&quot;${keyfile}&quot;
				key_prm=&quot;&quot;
			else
				stdin_file=&quot;/dev/null&quot;
				key_prm=&quot;-d \&quot;${keyfile}\&quot;&quot;
			fi

			if ! eval cryptsetup ${key_prm} ${gen_prm} &lt; &quot;${stdin_file}&quot;; then
				touch &quot;${cfg_tmp_keys_stat}/${index}.rejected&quot;
				f_echo err &quot;Failed to decrypt ${device}&quot;
				error=1
			fi
		fi

		index=&quot;$((${index}+1))&quot;
	done

	return &quot;${error}&quot;
}

f_opendevices() {
	local error=0

	if [ &quot;${cfg_dmcrypt}&quot; != 0 ]; then
		f_opendevices_dmcrypt || error=1
	elif [ &quot;${cfg_loopaes}&quot; != 0 ]; then
		f_opendevices_loopaes || error=1
	fi

	return &quot;${error}&quot;
}

f_setup_initramfs() {
	umask 0077

	#
	# basic mounts
	#
	if ! [ -f /proc/cmdline ]; then
		mount -t proc none /proc
	fi
	mount -t sysfs /sys /sys
	mount -o remount,rw /

	#
	# create utilities
	#
	if [ &quot;${cfg_install_applets}&quot; != 0 ]; then
		/bin/busybox --install -s
	fi

	[ &quot;$0&quot; != &quot;/init&quot; ] &amp;&amp; f_die &quot;initrd is not supported&quot;
	[ -e /linuxrc -a &quot;$0&quot; = &quot;/init&quot; ] &amp;&amp; rm /linuxrc

	[ ! -d /tmp ] &amp;&amp; mkdir /tmp
	[ ! -d /var/run ] &amp;&amp; mkdir -p /var/run
	[ ! -d &quot;${cfg_remmnt}&quot; ] &amp;&amp; mkdir -p &quot;${cfg_remmnt}&quot; 

	[ -e /dev/tty ] &amp;&amp; rm /dev/tty
	[ -e /dev/tty0 ] &amp;&amp; rm /dev/tty0
	ln -s &quot;$(tty)&quot; /dev/tty
	ln -s &quot;$(tty)&quot; /dev/tty0
}

f_setup_environment() {
	#
	# setup path
	#
	OLDPATH=&quot;${PATH}&quot;
	export PATH=&quot;${PATH}:/sbin:/bin:/usr/sbin:/usr/bin&quot;

	#
	# parse command line
	#
	local x
	for x in $(cat /proc/cmdline); do
		local v=&quot;${x#*=}&quot;
		case &quot;${x}&quot; in
			initrd_suspend_mode=*)
				cfg_suspend_mode=&quot;${v}&quot;
			;;
			initrd_util=*)
				local t
				t=$(f_parse_head &quot;${v}&quot; &quot;:&quot;)
				v=$(f_parse_remove_head &quot;${v}&quot; &quot;:&quot;)
				[ -n &quot;${t}&quot; ] &amp;&amp; cfg_util_type=&quot;${t}&quot;

				case &quot;${cfg_util_type}&quot; in
					&quot;&quot;);;
					pkcs11)
						t=$(f_parse_head &quot;${v}&quot; &quot;:&quot;)
						v=$(f_parse_remove_head &quot;${v}&quot; &quot;:&quot;)
						[ -n &quot;${t}&quot; ] &amp;&amp; cfg_pkcs11_application=&quot;${t}&quot;
						t=$(f_parse_head &quot;${v}&quot; &quot;:&quot;)
						v=$(f_parse_remove_head &quot;${v}&quot; &quot;:&quot;)
						[ -n &quot;${t}&quot; ] &amp;&amp; cfg_pkcs11_labels=&quot;${t}&quot;
						t=$(f_parse_head &quot;${v}&quot; &quot;:&quot;)
						v=$(f_parse_remove_head &quot;${v}&quot; &quot;:&quot;)
						[ -n &quot;${t}&quot; ] &amp;&amp; cfg_pkcs11_pass=&quot;${t}&quot;
					;;
					gpgfile|aescrypt|keyfile)
						t=$(f_parse_head &quot;${v}&quot; &quot;:&quot;)
						v=$(f_parse_remove_head &quot;${v}&quot; &quot;:&quot;)
						[ -n &quot;${t}&quot; ] &amp;&amp; cfg_remdev=&quot;${t}&quot;
						t=$(f_parse_head &quot;${v}&quot; &quot;:&quot;)
						v=$(f_parse_remove_head &quot;${v}&quot; &quot;:&quot;)
						[ -n &quot;${t}&quot; ] &amp;&amp; cfg_remdev_fs=&quot;${t}&quot;
						t=$(f_parse_head &quot;${v}&quot; &quot;:&quot;)
						v=$(f_parse_remove_head &quot;${v}&quot; &quot;:&quot;)
						[ -n &quot;${t}&quot; ] &amp;&amp; cfg_key_files=&quot;${t}&quot;
						t=$(f_parse_head &quot;${v}&quot; &quot;:&quot;)
						v=$(f_parse_remove_head &quot;${v}&quot; &quot;:&quot;)
						[ -n &quot;${t}&quot; ] &amp;&amp; cfg_gpg_pass=&quot;${t}&quot;
					;;
					passphrase)
						t=$(f_parse_head &quot;${v}&quot; &quot;:&quot;)
						v=$(f_parse_remove_head &quot;${v}&quot; &quot;:&quot;)
						[ -n &quot;${t}&quot; ] &amp;&amp; cfg_passphrase_id=&quot;${t}&quot;
					;;
					*)
						f_die &quot;Error: Invalid util argument ${v}&quot;
					;;
				esac
			;;
			initrd_devices=*)
				cfg_devices=&quot;${v}&quot;
			;;
			initrd_loopstart=*)
				cfg_loopstart=&quot;${v}&quot;
			;;
			initrd_dmnames=*)
				cfg_dmnames=&quot;${v}&quot;
			;;
			initrd_shell=*)
				case &quot;${v}&quot; in
					rescue)		v=3;;
					install)	v=5;;
					repair)		v=10;;
				esac
				cfg_shell_checkpoint=&quot;${v}&quot;
			;;
			initrd_kmap=*)
				cfg_kmap=$(f_parse_head &quot;${v}&quot; &quot;:&quot;)
				local m=$(f_parse_remove_head &quot;${v}&quot; &quot;:&quot;)
				[ -n &quot;${m}&quot; ] &amp;&amp; cfg_font=&quot;${m}&quot;
			;;
			initrd_encmode=*)
				case &quot;${v}&quot; in
					loop-aes)	cfg_loopaes=1;;
					loop-aes:*)
						cfg_loopaes=1
						local c=&quot;${v#*:}&quot;
						cfg_cipher=&quot;${c}&quot;
						;;
					dmcrypt)	cfg_dmcrypt=1;;
					dm-crypt)	cfg_dmcrypt=1;;
				esac
			;;
			initrd_resume_ui)
				cfg_resume_ui=&quot;${v}&quot;
			;;
			initrd_readers=*)
				echo &quot;${v}&quot; | grep &quot;pcscd&quot; &gt; /dev/null &amp;&amp; cfg_pcscd=1
				echo &quot;${v}&quot; | grep &quot;openct&quot; &gt; /dev/null &amp;&amp; cfg_openct=1
			;;
			splash=*)
				splash_theme=$(echo &quot;${x}&quot; | sed 's/.*theme://' | sed 's/,.*//')
				[ -n &quot;$(echo ${x} | grep verbose)&quot; ] &amp;&amp; global_splash_verbose=1
			;;
			root=*)
				cfg_root_device=&quot;${v}&quot;
			;;
			rootfstype=*)
				cfg_root_type=&quot;${v}&quot;
			;;
			ro)
				cfg_root_mode=ro
			;;
			resume=*)
				cfg_resume_device=&quot;${v}&quot;
			;;
			[0123456Ss])
				init_arg=&quot;${x}&quot;
			;;
		esac
	done
}

main() {
	[ ${cfg_setup_initramfs} != 0 ] &amp;&amp; f_setup_initramfs

	f_setup_environment
	f_shell_checkpoint 1
	f_modprobe_group &quot;boot&quot;
	f_shell_checkpoint 2
	[ ${cfg_start_mdev} != 0 ] &amp;&amp; f_setup_mdev
	f_loadkmap
	f_shell_checkpoint 3	# rescue point

	if [ -z &quot;${cfg_root_device}&quot; ]; then
		f_die &quot;Error: Please specify root kernel parameter at next reboot.&quot;
	fi
	if [ -z &quot;${cfg_util_type}&quot; -a -n &quot;${cfg_devices}&quot; ]; then
		f_die &quot;Error: Please specify initrd_util kernel parameter at next reboot.&quot;
	fi

	if [ &quot;${cfg_dmcrypt}&quot; != 0 ]; then
		if [ -e &quot;/dev/device-mapper&quot; -a ! -e &quot;/dev/mapper/control&quot; ]; then
			[ -d /dev/mapper ] || mkdir /dev/mapper
			ln -s /dev/device-mapper /dev/mapper/control
		fi
	fi

	f_shell_checkpoint 5	# install point
	if [ -n &quot;${cfg_devices}&quot; ]; then
		local success=&quot;0&quot;

		while [ &quot;${success}&quot; = 0 ]; do
			f_shell_checkpoint 6
			f_splash_verbose
			f_shell_checkpoint 7
			f_keys_read
			f_splash_silent
			f_shell_checkpoint 8
			f_opendevices &amp;&amp; success=&quot;1&quot;
			f_shell_checkpoint 9
			f_keys_clean

			if [ &quot;${cfg_util_type}&quot; != &quot;passphrase&quot; -a &quot;${success}&quot; = 0 ]; then
				f_die &quot;Cannot open/decrypt devices&quot;
			fi
		done
	fi

	f_shell_checkpoint 10	# repair point
	f_splash_message &quot;Trying to resume...&quot;
	f_shell_checkpoint 11
	f_resume
	f_shell_checkpoint 12
	f_splash_message &quot;Booting the system...&quot;
	f_shell_checkpoint 13
	f_reset_environment
	f_shell_checkpoint 14
	[ ${cfg_hand_root_control} != 0 ] &amp;&amp; f_hand_root_control
	f_shell_checkpoint 15
}

main
&lt;/pre&gt;}}

== genkernel-utils ==

Gentoo's genkernel is a wonderful tool that ease kernel compilation process. This tool can be extended in order to provide the following features:
* Replace the default linuxrc with the one provided here, in order to support TuxOnIce/uswsusp, disk encryption and PKCS#11. As genkernel's linuxrc script is not flexible to add additions.
* Add required files to initramfs in order to support TuxOnIce/uswsusp, disk encryption and optionally PKCS#11.
* Handle remerge of kernel depended modules when a new kernel is configured.
* Support two versions of the same kernel (Debug and production), in order to not lock computer when invalid kernel is installed.
* Don't install kernel symbol file in order to make it harder to reverse debug the bzImage. 

app-misc/genkernel-utils is available via overlay at http://github.com/alonbl/alon-barlev-overlay.git .

Edit mygenkernel.conf and use mygenkernel to create your initramfs.

If you like to use genkernel and not mygenkernel, set the followings in /etc/genkernel.conf that suits your installation, so that it will create the correct module groups, add:
{{File|/etc/genkernel.conf|&lt;pre&gt;
disk_mod=&quot;scsi_mod sd_mod libata libahci ahci&quot;
export AMODULES_BOOT=&quot;${disk_mod} loop ext4 evdev&quot;
export AMODULES_SUSPEND2=&quot;suspend_core suspend_compress suspend_userui suspend_block_io suspend_swap lzf&quot;
export AMODULES_PKCS11=&quot;unix uhci-hcd&quot;
export AMODULES_GPGFILE=&quot;usb-storage uhci-hcd&quot;
export AMODULES_CDROM=&quot;sr_mod cdrom zlib_inflate isofs&quot;
export AMODULES_MISC=&quot;vfat&quot;
&lt;/pre&gt;}}

== Maintainer ==

[[User:Alonbl|Alon Bar-Lev]]

{{AuthorList|
{{Author|Alon Bar-Lev|2006-11-01|type=original}}
{{Author|Alon Bar-Lev|2011-11-22|type=original}}
{{Author|Will Ashford|2006-02-06}}
{{Author|Federico Zagarzazú|2011-09-07}}
}}

[[Category:Security]]
[[Category:Encryption]]</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/MIT Kerberos Windows Domain</title>
    <id>55</id>
    <revision>
      <id>209</id>
      <timestamp>2013-06-05T20:22:27Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <minor/>
      <comment>moved [[MIT Kerberos Windows Domain]] to [[Gentoo/MIT Kerberos Windows Domain]]</comment>
      <text xml:space="preserve">= MIT Kerberos Windows Domain Integration =

== Prerequisites ==

# Make sure you have ntpd setup operational. NOTE: You cannot use Windows SNTP as clock source for NTP.
#: However you can do the other way around, having NTP host which is the clock source of Windows SNTP.
# DNS and Reverse-DNS lookup must be operational, make sure both your domain controller and the designated host are available in both modes.
{{Command|dig host.name.com}}
{{Command|host ip.add.re.s}}

== Setup kerberos ==

{{File|/etc/portage/package.use/samba.conf|&lt;pre&gt;
net-fs/samba ads ldap
&lt;/pre&gt;}}

{{Root|emerge app-crypt/mit-krb5 net-fs/samba}}

{{File|/etc/krb5.conf|&lt;pre&gt;
[libdefaults]
        default_realm = MY_DOMAIN.COM
        forwardable = true

[realms]

[domain_realm]

[logging]
        kdc = FILE:/var/log/krb5kdc.log
        admin_server = FILE:/var/log/kadmin.log
        default = FILE:/var/log/krb5lib.log
&lt;/pre&gt;}}

{{Note|The forwardable true is optional, however having this makes *NIX behaves more like windows in delegated authentication}}

Testing:
{{Command|kinit user}}

== Joining Domain ==

{{File|/etc/samba/smb.conf|&lt;pre&gt;
workgroup = MY_WORKGROUP
security = ads
kerberos method = system keytab
client use spnego = yes
realm = MY_DOMAIN.COM
&lt;/pre&gt;}}

{{Root|net ads join -U Administrator}}
{{Root|net ads testjoin
&lt;pre&gt;Join is OK&lt;/pre&gt;}}
{{Root|net ads keytab create -U Administrator}}

=== Integrating Apache Web Server ===

==== Setup ====

{{Note|Integrating Apache Web Server does not require any pam/nss integration}}

{{Root|emerge www-apache/mod_auth_kerb}}

{{Root|net ads keytab add HTTP -U Administrator}}

==== Optional, test ticket ====

{{Root|klist -k /etc/krb5.keytab}}
{{Root|kinit -kt /etc/krb5.keytab -S HTTP/server.name@MY_DOMAIN.COM 'SERVER$'}}

{{Root|chgrp apache /etc/krb5.keytab}}
{{Root|chmod g+r /etc/krb5.keytab}}

==== Configuration ====

{{File|/etc/apache2/11_mod_auth_kerb.conf|&lt;pre&gt;
&lt;IfDefine AUTH_KERB&gt;
LoadModule auth_kerb_module modules/mod_auth_kerb.so

&lt;Directory &quot;/var/www/private&quot;&gt;
        AuthType Kerberos
        AuthName &quot;Kerberos Login&quot;
        Krb5Keytab /etc/krb5.keytab
        KrbAuthRealms MY_DOMAIN.COM
        Require valid-user
&lt;/Directory&gt;
&lt;/IfDefine&gt;
&lt;/pre&gt;}}

=== Integrating pam/nss ===

==== Setup ====

{{File|/etc/portage/package.use/pam.conf|&lt;pre&gt;
sys-auth/pambase pam_krb5
&lt;/pre&gt;}}

{{Root|emerge --update --deep --newuse @world}}

{{Root|emerge sys-auth/nss_ldap}}

Update:
{{File|/etc/ldap.conf|&lt;pre&gt;
#host 127.0.0.1
base DC=mydomain,DC=com
uri ldap://dc.mydomain.com/
binddn CN=ldapbind,CN=Users,DC=mydomain,DC=com
bindpw secret
scope sub
nss_paged_results yes
nss_schema rfc2307bis
# RFC 2307 (AD) mappings
nss_map_objectclass posixAccount user
nss_map_objectclass shadowAccount user
nss_map_attribute uid sAMAccountName
nss_map_attribute homeDirectory unixHomeDirectory
nss_map_attribute shadowLastChange pwdLastSet
nss_map_objectclass posixGroup group
nss_map_attribute uniqueMember member
pam_login_attribute sAMAccountName
pam_filter objectclass=User
pam_password ad
sasl_secprops maxssf=0
&lt;/pre&gt;}}

Update:
{{File|/etc/nssswitch.conf|&lt;pre&gt;
passwd:      files ldap
shadow:      files ldap
group:       files ldap
netgroup:    ldap files
&lt;/pre&gt;}}

==== Test ====

{{Command|id user1
&lt;pre&gt;uid=10012(user1) gid=100(users) groups=100(users)&lt;/pre&gt;}}

Login to user1 with domain password using ssh.

=== Integrating sshd ===

First integrate pam/nss.

Update:
{{File|/etc/ssh/sshd_config|&lt;pre&gt;
GSSAPIAuthentication yes
&lt;/pre&gt;}}

=== Integrating Samba Server ===

First integrate pam/nss.

{{Root|net ads keytab add cifs -U Administrator}}

Set all to system-remote-login:
{{File|/etc/pam.d/samba|&lt;pre&gt;
auth       include      system-remote-login
account    include      system-remote-login
session    include      system-remote-login
password   include      system-remote-login
&lt;/pre&gt;}}

=== Bugzilla ===

Integrate apache.

Go to Administration-&gt;Parameters-&gt;User Authentication, set:
 auth_env_id = REMOTE_USER
 auth_env_email = REMOTE_USER
 user_info_class = Env
 requirelogin = On

== Clients ==

{{Note|Setup client does not require any system wide modification (pam/nss), nor
joining the domain.}}

First authenticate using kinit
{{Command|kinit user}}

Validate ticket:
{{Command|klist}}

=== Firefox ===

# Go to about:config
# Set network.negotiate-auth.trusted-uris to .my_domain.com
# Use only fully qualified DNS names to access internal web sites.

=== Samba Client ===

==== Environment ====

{{File|~/.smb/smb.conf|&lt;pre&gt;
[global]
        workgroup = MY_DOMAIN
        realm = MY_DOMAIN.COM
        security = ads
        client use spnego = yes
&lt;/pre&gt;}}

==== Test ====

{{Command|smbclient -k //server/share}}

== Maintainer ==

[[User:Alonbl|Alon Bar-Lev]]

{{AuthorList|{{Author|Alon Bar-Lev|2011-11-17|type=original}}}}

[[Category:Software]]
[[Category:Security]]</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/Non Root Xorg-Server</title>
    <id>59</id>
    <revision>
      <id>247</id>
      <timestamp>2013-06-05T21:05:42Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve">= Non Root Xorg-Server =

For some starange reason, xorg-server developers do not perform this final step toward non root xorg-server, although kernel and all other components are ready.

The gap is very small, and is opurtunity for all that do not like unneeded root complex processes running on their system.

== Patches ==

{{File|xorg-server-1.11.2-none-root.patch|&lt;pre&gt;
diff --git a/hw/xfree86/os-support/linux/lnx_video.c b/hw/xfree86/os-support/linux/lnx_video.c
index 3d45511..98bbad8 100644
--- a/hw/xfree86/os-support/linux/lnx_video.c
+++ b/hw/xfree86/os-support/linux/lnx_video.c
@@ -501,6 +501,9 @@ xf86EnableIO(void)
        if (ExtendedEnabled)
                return TRUE;

+       if (getenv(&quot;XORGSERVER_NONE_ROOT&quot;) != NULL)
+               return TRUE;
+
 #if defined(__powerpc__)
        ioBase_phys = syscall(__NR_pciconfig_iobase, 2, 0, 0);
&lt;/pre&gt;}}


{{File|xorg-server-1.11.2-r2.ebuild|&lt;pre&gt;
--- xorg-server-1.11.2-r2.ebuild        2011-12-27 23:01:29.000000000 +0200
+++ xorg-server-1.11.2-r2.ebuild        2012-01-10 23:48:08.372447095 +0200
@@ -111,6 +111,7 @@ PATCHES=(
        &quot;${UPSTREAMED_PATCHES[@]}&quot;
        &quot;${FILESDIR}&quot;/${PN}-disable-acpi.patch
        &quot;${FILESDIR}&quot;/${PN}-1.9-nouveau-default.patch
+       &quot;${FILESDIR}&quot;/${PN}-1.11.2-none-root.patch
 )

 pkg_pretend() {
@@ -151,7 +153,7 @@ pkg_setup() {
                $(use_with doc xmlto)
                --sysconfdir=/etc/X11
                --localstatedir=/var
-               --enable-install-setuid
+               --disable-install-setuid
                --with-fontrootdir=/usr/share/fonts
                --with-xkb-output=/var/lib/xkb
                --disable-config-hal
&lt;/pre&gt;}}


'''Optional:''' If you intend to run multiple instances of Xorg, the following kernel patch is required:

{{File|4200-drm-non-root.patch|&lt;pre&gt;
--- a/drivers/gpu/drm/drm_drv.c 2012-01-11 21:10:48.238484914 +0200
+++ b/drivers/gpu/drm/drm_drv.c 2012-01-11 21:11:25.429450927 +0200
@@ -82,8 +82,8 @@ static struct drm_ioctl_desc drm_ioctls[
        DRM_IOCTL_DEF(DRM_IOCTL_SET_SAREA_CTX, drm_setsareactx, DRM_AUTH|DRM_MASTER|DRM_ROOT_ONLY),
        DRM_IOCTL_DEF(DRM_IOCTL_GET_SAREA_CTX, drm_getsareactx, DRM_AUTH),
 
-       DRM_IOCTL_DEF(DRM_IOCTL_SET_MASTER, drm_setmaster_ioctl, DRM_ROOT_ONLY),
-       DRM_IOCTL_DEF(DRM_IOCTL_DROP_MASTER, drm_dropmaster_ioctl, DRM_ROOT_ONLY),
+       DRM_IOCTL_DEF(DRM_IOCTL_SET_MASTER, drm_setmaster_ioctl, 0),
+       DRM_IOCTL_DEF(DRM_IOCTL_DROP_MASTER, drm_dropmaster_ioctl, 0),
 
        DRM_IOCTL_DEF(DRM_IOCTL_ADD_CTX, drm_addctx, DRM_AUTH|DRM_ROOT_ONLY),
        DRM_IOCTL_DEF(DRM_IOCTL_RM_CTX, drm_rmctx, DRM_AUTH|DRM_MASTER|DRM_ROOT_ONLY),
&lt;/pre&gt;}}

== Scripts ==

The following is needed in order to startx in none previliged mode.

{{File|/usr/local/bin/my-startx|&lt;pre&gt;
#!/bin/sh

display=&quot;$1&quot;

sudo my-startx-perm &quot;${display}&quot; &amp;
PPP=&quot;$!&quot;
sleep 1
XORGSERVER_NONE_ROOT=1 setsid startx -- ${display} -logfile /tmp/xorg.$$.log &amp;
sleep 5

exec kill -9 &quot;${PPID}&quot; # exit current shell
&lt;/pre&gt;}}

The following is needed to temporary fix privileges of ttys, not sure why xorg-server is using tty0, and why -novtswitch is not working.

{{File|/usr/local/bin/mystartx-perm|&lt;pre&gt;
#!/bin/sh

die() {
        local m=&quot;$1&quot;
        echo &quot;FATAL: ${m}&quot; &gt;&amp;2
        exit 1
}

change() {
        local user=&quot;$1&quot;
        chown &quot;${user}&quot; /dev/tty0 &quot;${tty}&quot; #/dev/input/event*
}

display=&quot;$1&quot;

case &quot;${display}&quot; in
        :[0-4])
                index=&quot;${display#:}&quot;
        ;;
        *)
                index=&quot;0&quot;
        ;;
esac

while killall -q -0 &quot;$0&quot;; do
        sleep 1
done

tty=&quot;/dev/tty$((7+${index}))&quot;

cleanup() {
        change root
}

trap cleanup 0

[ &quot;$(stat --printf=&quot;%u\n&quot; &quot;${tty}&quot;)&quot; = 0 ] || die &quot;invalid init perm&quot;
change &quot;${SUDO_USER}&quot;
sleep 5

exit 0
&lt;/pre&gt;}}

Enable execute the my-startx-perm using sudo.

{{File|/etc/sudoers.d/xorg-server|&lt;pre&gt;
ALL ALL=(ALL) NOPASSWD: /usr/local/bin/my-startx-perm
&lt;/pre&gt;}}

Enable access to input devices, there must be a better way to do this, enabling this allows any application to tap keyboard/mouse.

{{File|/etc/udev/rules.d/60-xorg-server.rules|&lt;pre&gt;
SUBSYSTEM==&quot;input&quot;,MODE=&quot;0666&quot;
&lt;/pre&gt;}}

Add:
 Option &quot;GrabDevice&quot; &quot;True&quot;

To your input devices so nobody can tap the active devices.

== Test ==

Create ~/.xorg.conf with relevant contents.

As root:
{{Root|/etc/init.d/xdm stop}}

As user:
{{Command|my-startx}}

== Maintainer ==

[[User:Alonbl|Alon Bar-Lev]]

{{AuthorList|{{Author|Alon Bar-Lev|2012-01-11|type=original}}}}

[[Category:Security]]
[[Category:Desktop Environment]]</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/OpenVPN Non Root</title>
    <id>65</id>
    <revision>
      <id>232</id>
      <timestamp>2013-06-05T20:55:05Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve">= OpenVPN Client Non Root =

End result, user can use own tool (I use knemo) to connect/disconnect from {{Package|net-misc/openvpn}}.

The logic is to create tun device and allow users to access it, and wrapping the /sbin/ip
using sudo.

The control of the daemon is done using the OpenVPN management interface.

== Setup ==

{{Kernel|Add tap|&lt;pre&gt;
  Device Drivers  ---&gt; 
    [*] Network device support  ---&gt;
      &lt;M&gt;   Universal TUN/TAP device driver support
&lt;/pre&gt;}}

{{Root|emerge net-misc/openvpn net-dns/openresolv}}

{{Package|net-dns/openresolv}} is optional, but makes life much easier, see [[Gentoo/Openresolv]].

It is very recommended to configure firewall on your computer, see [[Gentoo/Firewall_Using_Firehol|firehol configuration]].

Add:
{{File|/etc/conf.d/net|&lt;pre&gt;
rc_net_vpn0_need=&quot;firewall&quot; # optional, if you setup firewall.
rc_net_vpn0_provide=&quot;!net&quot;
tuntap_vpn0=&quot;tun&quot;
iproute2_vpn0=&quot;group users&quot;
config_vpn0=&quot;null&quot;
txqueuelen_vpn0=&quot;100&quot;
metric_vpn0=&quot;1&quot;
&lt;/pre&gt;}}

{{Root|&lt;nowiki&gt;ln -s net.lo /etc/init.d/net.vpn0
rc-update add net.vpn0 default
/etc/init.d/net.vpn0 start
&lt;/nowiki&gt;}}

{{File|~/openvpn/my-ip|&lt;pre&gt;
#!/bin/sh
sudo /sbin/ip $@
&lt;/pre&gt;}}

{{File|~/openvpn/my-up.sh|&lt;pre&gt;
#!/bin/sh
script=&quot;${0//my-}&quot;
if [ ${EUID} != 0 ] ; then
        if [[ -x /usr/bin/sudo ]] ; then
                echo &quot;&quot; | sudo -p &quot;&quot; -S /etc/openvpn/&quot;${script}&quot; &quot;$@&quot;
                exit $?
        fi
        echo &quot;You need configure sudo to run $0&quot; &gt;&amp;2
        exit 1
else
        /etc/openvpn/&quot;${script}&quot; &quot;$@&quot;
        exit $?
fi
&lt;/pre&gt;}}

{{Command|ln -s my-up.sh ~/openvpn/my-down.sh}}

{{File|~/openvpn/server.conf|Add:&lt;pre&gt;
dev-type tun
dev vpn0
daemon
up my-up.sh
down my-down.sh
iproute my-ip
up-delay
up-restart
down-pre
script-security 2
auth-retry nointeract
management-signal
management 127.0.0.1 2222
management-query-passwords
management-forget-disconnect
remap-usr1 SIGTERM
&lt;/pre&gt;}}

{{File|/etc/sudoers.d/openvpn|&lt;pre&gt;
Defaults        env_keep += &quot;foreign_option_1&quot;
Defaults        env_keep += &quot;foreign_option_2&quot;
Defaults        env_keep += &quot;foreign_option_3&quot;
Defaults        env_keep += &quot;foreign_option_4&quot;
Defaults        env_keep += &quot;foreign_option_5&quot;
Defaults        env_keep += &quot;dev&quot;

%users ALL=(ALL) NOPASSWD: /etc/openvpn/up.sh
%users ALL=(ALL) NOPASSWD: /etc/openvpn/down.sh
%users ALL=(ALL) NOPASSWD: /sbin/ip
&lt;/pre&gt;}}

Until {{bug|391175}} is resolved, update the following to have DNS lookup of vpn0 be prioritized:
{{File|/etc/resolvconf.conf|&lt;pre&gt;
interface_order=&quot;lo lo[0-9]* vpn*&quot;
&lt;/pre&gt;}}

== Dialogs ==

Fetch openvpn-kde-dialogs.pl from [[http://sites.google.com/site/alonbarlev/openvpn-pkcs11 here]], and customize.
Usually comment out
 #use MIME::Base64;
 #use Crypt::X509;

{{Root|emerge dev-perl/Net-Telnet}}

== knemo ==

=== Context menu ===

Start:
{{Command|( /usr/sbin/openvpn --cd /home/user/openvpn --config server.conf &amp; ); exec /home/user/openvpn/openvpn-kde-dialogs.pl 2222 1}}

Stop:
{{Command|killall openvpn}}

== Maintainer ==

[[User:Alonbl|Alon Bar-Lev]]

{{AuthorList|{{Author|Alon Bar-Lev|2011-11-17|type=original}}}}

[[Category:Software]]
[[Category:Security]]
[[Category:Network]]</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/OpenVPN Server</title>
    <id>64</id>
    <revision>
      <id>239</id>
      <timestamp>2013-06-05T21:01:27Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve">= OpenVPN Server =

{{Package|net-misc/openvpn}} network Configuration:
{{Codeline|&lt;pre&gt;
  Internet &lt;---&gt; Router &lt;---&gt; (eth0, 192.168.253.253/24)Gateway(eth1, 10.10.50.253/21) &lt;---&gt; Internet Network (10.10.48.0/21)
&lt;/pre&gt;}}

Minimal server, with simple hardening.

This page is provided as OEM, a complete setup.

== Installation ==

{{Kernel|Add tap|&lt;pre&gt;
  Device Drivers  ---&gt; 
    [*] Network device support  ---&gt;
      &lt;M&gt;   Universal TUN/TAP device driver support
&lt;/pre&gt;}}

{{File|/etc/portage/make.conf|&lt;pre&gt;
CFLAGS=&quot;-O2 -pipe -mtune=native -fomit-frame-pointer -pipe&quot;
CXXFLAGS=&quot;${CFLAGS}&quot;
MAKEOPTS=&quot;-j4&quot;
CHOST=&quot;x86_64-pc-linux-gnu&quot;
PORTDIR=&quot;/var/gentoo/portage&quot;
DISTDIR=&quot;/var/gentoo/distfiles&quot;
PKGDIR=&quot;/var/gentoo/packages&quot;
PORTAGE_GPG_DIR=&quot;/etc/portage/gnupg&quot;
FEATURES=&quot;webrsync-gpg parallel-fetch userfetch userpriv usersandbox&quot;
ACCEPT_LICENSE=&quot;-* @FSF-APPROVED @FSF-APPROVED-OTHER freedist&quot;

USE=&quot;${USE} mmx sse sse2 sse3 caps fam&quot;
USE=&quot;${USE} logrotate&quot;
USE=&quot;${USE} -gnome -qt3 -X&quot;
USE=&quot;${USE} -ruby -perl -fortran -python -lua -java&quot;
USE=&quot;${USE} -berkdb -gdbm -hal&quot;
&lt;/pre&gt;}}

{{Note|Refer to [[Gentoo/Secured_Portage_Sync]] for sync setup}}

{{File|/etc/portage/package.license/base.conf|&lt;pre&gt;
sys-devel/flex FLEX
app-arch/bzip2 BZIP2
sys-libs/cracklib CRACKLIB
sys-process/lsof lsof
dev-perl/Crypt-PasswdMD5 BEER-WARE
sys-apps/debianutils SMAIL
sys-apps/tcp-wrappers tcp_wrappers_license
sys-apps/man-pages-posix man-pages-posix
&lt;/pre&gt;}}

{{File|/etc/portage/package.use/openvpn.conf|&lt;pre&gt;
net-misc/openvpn iproute2
&lt;/pre&gt;}}

Modify:
{{File|/etc/rc.conf|&lt;pre&gt;
rc_hotplug=&quot;*&quot;
&lt;/pre&gt;}}

{{File|/var/lib/portage/world|&lt;pre&gt;
app-admin/logrotate
app-admin/syslog-ng
app-arch/tarsync
app-crypt/gnupg
app-editors/vim
app-portage/gentoolkit
net-dns/openresolv
net-misc/dhcpcd
net-misc/ntp
sys-apps/ifplugd
sys-kernel/genkernel
sys-kernel/gentoo-sources
sys-process/vixie-cron
&lt;/pre&gt;}}

{{Root|emerge net-misc/openvpn}}

Firehol installation see [[Gentoo/Firewall_Using_Firehol]].

== Cryptographic configuration ==

TODO

== Network Configuration ==

{{File|/etc/firehol/firehol.conf|&lt;pre&gt;
version 5

interface eth0 internal
        policy  reject
        protection              strong  10/sec  10
        server  ident           reject  with tcp-reset

        server  all             drop    dst     &quot;10.10.50.255&quot;
        server  all             drop    dst     &quot;255.255.255.255&quot;
        client  all             drop    dst     &quot;228.67.43.91&quot;  #rtsp something
        server  all             drop    dst     &quot;228.67.43.91&quot;  #rtsp something
        client  all             drop    dst     &quot;224.0.0.1&quot;     #igmp something
        server  all             drop    dst     &quot;224.0.0.1&quot;     #igmp something

        server  netbios_dgm     drop
        server  netbios_ns      drop
        server  time            drop

        server  ssh             accept
        server  snmp            accept
        client  ssh             accept
        client  dns             accept
        client  ntp             accept
        client  http            accept
        client  https           accept

interface eth1 external
        policy  reject
        protection              strong  10/sec  10
        server  ident           reject  with tcp-reset

        server  netbios_dgm     drop
        server  netbios_ns      drop
        server  time            drop

        server  https           accept
        client  http            accept
        client  https           accept
        client  smtp            accept

interface vpn0 vpn
        policy  reject
        protection              strong  10/sec  10
        server  ident           reject  with tcp-reset

        server  ssh             accept

router vpn_nat inface eth0 outface vpn0
        route   ident           reject with tcp-reset
        server  ident           reject with tcp-reset
        masquerade              reverse

        client  all             accept
&lt;/pre&gt;}}

{{File|/etc/conf.d/net|&lt;pre&gt;
dns_domain=&quot;mydomain.com&quot;
dns_search=&quot;mydomain.com&quot;

rc_net_eth0_need=&quot;firewall&quot;
config_eth0=&quot;10.10.50.253/21&quot;
dns_servers_eth0=&quot;10.10.50.2 10.10.50.39&quot;

rc_net_eth1_need=&quot;firewall&quot;
config_eth1=&quot;192.168.253.253/24&quot;
routes_eth1=&quot;default via 192.168.253.254&quot;

rc_net_vpn0_need=&quot;firewall&quot;
rc_net_vpn0_provide=&quot;!net&quot;
tuntap_vpn0=&quot;tun&quot;
config_vpn0=&quot;null&quot;
txqueuelen_vpn0=&quot;100&quot;
metric_vpn0=&quot;1&quot;
&lt;/pre&gt;}}

{{Root|ln -s net.lo /etc/init.d/net.vpn0}}

== OpenVPN Configuration ==

{{Root|ln -s openvpn /etc/init.d/openvpn.vpn0}}

{{File|/etc/conf.d/openvpn.vpn0|&lt;pre&gt;
rc_need=&quot;net.vpn0 net.eth1&quot;
&lt;/pre&gt;}}

Add:
{{File|/etc/openvpn/vpn0.conf|&lt;pre&gt;
dev vpn0
dev-type tun
user nobody
group nobody
persist-key
persist-tun
&lt;/pre&gt;}}

Example:
{{File|/etc/openvpn/vpn0.conf|&lt;pre&gt;
dev vpn0
dev-type tun
proto tcp-server
tls-cipher DHE-RSA-AES256-SHA
cipher AES-256-CBC
server 192.168.252.0 255.255.255.0
local 192.168.253.253
lport 443
comp-lzo

user nobody
group nobody
persist-key
persist-tun
chroot /var/openvpn

keepalive 60 120

ca ca.crt
cert server.crt
key server.key
dh dh4096.pem

crl-verify /crl.pem # after chroot

push &quot;route 10.10.48.0 255.255.248.0&quot;
push &quot;dhcp-option DOMAIN mydomain.com&quot;
push &quot;dhcp-option DNS 10.10.50.2&quot;
push &quot;dhcp-option DNS 10.10.50.39&quot;
&lt;/pre&gt;}}

{{Note|As OpenVPN runs under nobody, it cannot clear the vpn0 interface when it goes down, /etc/init.d/net.vpn0 restart is required}}

== Maintainer ==

[[User:Alonbl|Alon Bar-Lev]]

{{AuthorList|{{Author|Alon Bar-Lev|2011-11-16|type=original}}}}

[[Category:Security]]
[[Category:Network]]</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/Openresolv</title>
    <id>61</id>
    <revision>
      <id>248</id>
      <timestamp>2013-06-05T21:06:02Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve">= Openresolv =

{{Package|net-dns/openresolv}} handles /etc/resolv.conf dynamic changes and priority. This is needed as there are several daemons (dhcpcd, ppp, openvpn) that actively rewrites /etc/resolv.conf. This leads to undesired results, as usually only the last settings are preserved.

{{Package|net-dns/openresolv}} provides a common interface for /etc/resolv.conf, and is used by {{Package|sys-apps/openrc}}, {{Package|net-misc/dhcpcd}}, {{Package|net-misc/openvpn}} if openresolv package is installed. There is no direct dependency, so you need to install it directly.

== Installation ==

{{Root|emerge net-dns/openresolv}}

== Manage ==

Usually once installed nothing should be done, to see it working, watch for resolvconf signature within /etc/resolv.conf.
{{Root|cat /etc/resolv.conf}}
{{Codeline|&lt;pre&gt;
# Generated by resolvconf
search mydomain.com domain.name
nameserver 10.10.50.2
nameserver 10.10.50.39
nameserver 192.168.1.1
&lt;/pre&gt;}}

Show status:
{{Root|resolvconf -l}}
{{Codeline|&lt;pre&gt;
# resolvconf -l
# resolv.conf from vpn0
# Generated by openvpn for interface vpn0
domain mydomain.com
nameserver 10.10.50.2
nameserver 10.10.50.39

# resolv.conf from wlan0
# Generated by dhcpcd from wlan0
domain domain.name
nameserver 192.168.1.1
&lt;/pre&gt;}}

Force update:
{{Root|resolvconf -u}}

== Tweeks ==

=== Setting Interface Metrics ===

If [[Gentoo/OpenVPN_Non_Root|OpenVPN]]({{Bug|391175}}) is used or any VPN that does not support interface metrics, interface metrics should be set via /etc/resolvconf.conf

For example, set vpn interface to have higher priority than other interfaces:
{{File|/etc/resolvconf,conf|&lt;pre&gt;
interface_order=&quot;lo lo[0-9]* vpn*&quot;
&lt;/pre&gt;}}

== Maintainer ==

[[User:Alonbl|Alon Bar-Lev]]

{{AuthorList|{{Author|Alon Bar-Lev|2011-11-17|type=original}}}}

[[Category:Network]]</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/PPP Client</title>
    <id>68</id>
    <revision>
      <id>233</id>
      <timestamp>2013-06-05T20:55:27Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve">= PPP Client =

PPP protocol is used by most point to point connections, such as modems and broadband routers. Gentoo provides simple integration.

== Configuration ==

{{Root|emerge net-dialup/ppp net-dns/openresolv}}

{{Package|net-dns/openresolv}} is optional, but makes life much easier, see [[Gentoo/Openresolv]].

It is very recommended to configure firewall on your computer, see [[Gentoo/Firewall_Using_Firehol|firehol configuration]].

{{Kernel||&lt;pre&gt;
  Device Drivers  ---&gt;
    [*] Network device support  ---&gt;
      &lt;M&gt;   PPP (point-to-point protocol) support
        [*]     PPP filtering
        &lt;M&gt;     PPP support for async serial ports
        &lt;M&gt;     PPP support for sync tty ports
        &lt;M&gt;     PPP Deflate compression
        &lt;M&gt;     PPP BSD-Compress compression
        &lt;M&gt;     PPP MPPE compression (encryption) (EXPERIMENTAL)
  -*- Cryptographic API  ---&gt; 
    &lt;M&gt;   Michael MIC keyed digest algorithm
&lt;/pre&gt;}}

Add:
{{File|/etc/conf.d/modules|&lt;pre&gt;
modules=&quot;${modules} ppp-generic&quot;
&lt;/pre&gt;}}

Add:
{{File|/etc/conf.d/net|&lt;pre&gt;
rc_net_ppp0_need=&quot;firewall&quot;  # optional, if you are using firewall
config_ppp0=&quot;ppp&quot;
link_ppp0=&quot;/dev/ttyUSB2&quot; # set your device
username_ppp0=''         # set your username
password_ppp0=''         # set your password
phone_number_ppp0=&quot;*99#&quot; # phone number to dial

pppd_ppp0=&quot;noauth defaultroute usepeerdns lock mru 296 mtu 296&quot;
chat_ppp0=&quot;
ABORT BUSY
ABORT ERROR
ABORT 'NO ANSWER'
ABORT 'NO CARRIER'
ABORT 'NO DIALTONE'
ABORT 'Invalid Login'
ABORT 'Login incorrect'
TIMEOUT 5
'' 'ATZ'
OK AT
OK 'ATDT\T'
TIMEOUT 60
CONNECT ''
TIMEOUT 5
'~--' ''&quot;
&lt;/pre&gt;}}

{{Root|ln -s net.lo /etc/init.d/net.ppp0}}

== Management ==

{{Root|/etc/init.d/net.ppp0 start}}
{{Root|/etc/init.d/net.ppp0 stop}}

== Maintainer ==

[[User:Alonbl|Alon Bar-Lev]]

{{AuthorList|{{Author|Alon Bar-Lev|2011-11-17|type=original}}}}

[[Category:Network]]</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/PPPoE Client</title>
    <id>69</id>
    <revision>
      <id>240</id>
      <timestamp>2013-06-05T21:01:46Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve">= PPPoE Client =

PPPoE is basically PPP over Ethernet, most common used with broadband routers.

== Installation ==

Configure system to run ppp, see [[Gentoo/PPP_Client|how to configure ppp client]].

{{Kernel||&lt;pre&gt;
  Device Drivers  ---&gt;
    [*] Network device support  ---&gt;
      &lt;M&gt;   PPP (point-to-point protocol) support
        &lt;M&gt;     PPP over Ethernet (EXPERIMENTAL)
&lt;/pre&gt;}}

{{Root|emerge net-dialup/rp-pppoe}}

== Configuration ==

Provided eth0 should be used for connection, add:
{{File|/etc/conf.d/net|&lt;pre&gt;
rc_net_ppp1_need=&quot;firewall net.eth0&quot; # firewall is optional
config_ppp1=&quot;ppp&quot;
plugins_ppp1=&quot;pppoe&quot;
link_ppp1=&quot;eth0&quot;
username_ppp1=''   # set your username
password_ppp1=''   # set your password
&lt;/pre&gt;}}

{{Root|ln -s net.lo /etc/init.d/net.ppp1}}

== Management ==

{{Root|/etc/init.d/net.ppp1 start}}
{{Root|/etc/init.d/net.ppp1 stop}}

== Maintainer ==

[[User:Alonbl|Alon Bar-Lev]]

{{AuthorList|{{Author|Alon Bar-Lev|2011-11-17|type=original}}}}

[[Category:Network]]</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/RSA SecurID</title>
    <id>52</id>
    <revision>
      <id>183</id>
      <timestamp>2013-06-05T20:18:09Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <minor/>
      <comment>moved [[RSA SecurID]] to [[Gentoo/RSA SecurID]]</comment>
      <text xml:space="preserve">= RSA SecurID SID800 =

== Device ==

[[File:RSA_SecurID_SID800.png]]

USB
{{Codeline|&lt;pre&gt;
15e1:2007 RSA RSA SecurID (R) Authenticator
&lt;/pre&gt;}}

== Installation ==

Use portage overlay: [http://github.com/alonbl/alon-barlev-overlay http://github.com/alonbl/alon-barlev-overlay].

=== pcsc-lite ===

{{Root|emerge sys-apps/pcsc-lite app-crypt/RSA_SecurID_getpasswd}}

{{Root|/etc/init.d/pcscd start}}

=== openct ===

{{Root|emerge dev-libs/openct app-crypt/RSA_SecurID_getpasswd-openct}}

{{Root|/etc/init.d/openct start}}

== Usage ==

{{Command|RSA_SecurID_getpasswd
&lt;pre&gt;123456&lt;/pre&gt;}}


== Maintainer ==

[[User:Alonbl|Alon Bar-Lev]]

{{AuthorList|{{Author|Alon Bar-Lev|2012-07-11|type=original}}}}

[[Category:Hardware]]</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/Secured Portage Sync</title>
    <id>56</id>
    <revision>
      <id>215</id>
      <timestamp>2013-06-05T20:23:42Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <minor/>
      <comment>moved [[Secured Portage Sync]] to [[Gentoo/Secured Portage Sync]]</comment>
      <text xml:space="preserve">= Secured Portage Sync =

The standard portage sync command uses the unsecured rsync protocol by default.
{{Root|emerge --sync}}
A man in the middle attack or rogue rsync mirror may alter the data and cause malformed packages to be installed.

One alternative is a secure sync using emerge-webrsync, which uses the HTTP protocol to retrieve a validated Portage tarball, signed by the Gentoo Foundation with a GPG key. It will test the tarball signature and timestamp to verify the tarball before it's installed on the system.

== Installation ==

{{Root|emerge app-arch/tarsync app-crypt/gnupg}}

{{Root|mkdir /etc/portage/gnupg}}
{{Root|chmod 0700 /etc/portage/gnupg}}
{{Root|&lt;nowiki&gt;GNUPGHOME=/etc/portage/gnupg gpg --keyserver subkeys.pgp.net --recv-keys 0x96D8BF6D&lt;/nowiki&gt;}}
{{Root|&lt;nowiki&gt;GNUPGHOME=/etc/portage/gnupg gpg --fingerprint 0x96D8BF6D&lt;/nowiki&gt;}}
Be sure to check the double check the fingerprint on the [http://www.gentoo.org/proj/en/releng/#doc_chap5 release engineering page].

Add:
{{File|/etc/portage/make.conf|&lt;pre&gt;
PORTAGE_GPG_DIR=&quot;/etc/portage/gnupg&quot;
FEATURES=&quot;webrsync-gpg parallel-fetch userfetch userpriv usersandbox&quot;
SYNC=&quot;&quot; # so emerge --sync won't work
&lt;/pre&gt;}}

== Sync ==

{{Root|emerge-webrsync}}

== References ==

* http://www.gentoo.org/proj/en/releng/

[[Category:Security]]</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/Sony DualShock3 SixAxis</title>
    <id>51</id>
    <revision>
      <id>241</id>
      <timestamp>2013-06-05T21:02:12Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve">= Sony DualShock3 SixAxis =

[[File:Sony_DualShock3_SixAxis.png|400px]]

This is a work in progress to integrate this device into Linux. USB is working perfectly, bluetooth is progressing.

{{Warning|Beware of fake devices! there are some devices in the market that looks *EXACTLY* like Sony's device but behaves differently, buy only the original.}}

== Configuration ==

You must use kernel 3.1.0 and above!

First, configure [[Gentoo/Bluetooth|bluetooth]].

{{Kernel||&lt;pre&gt;
  [*] Networking support  ---&gt;
    &lt;M&gt;   Bluetooth subsystem support  ---&gt;
      &lt;M&gt;   HIDP protocol support
  Device Drivers  ---&gt;
    Input device support  ---&gt;
      &lt;M&gt;   Joystick interface
      &lt;M&gt;   Event interface
      [*]   Miscellaneous devices  ---&gt;
        &lt;M&gt;   User level driver support
    [*] HID Devices  ---&gt;
      {M}   Generic HID support
      [*]     /dev/hidraw raw HID device support
      &lt;M&gt;   USB Human Interface Device (full HID) support
      Special HID drivers  ---&gt;
       &lt;M&gt; Sony PS3 controller
&lt;/pre&gt;}}

Add:
{{File|/etc/conf.d/modules|&lt;pre&gt;
modules=&quot;${modules} uinput&quot;
&lt;/pre&gt;}}

You need to patch {{Package|net-wireless/bluez}}, send a message to [[User:Alonbl|me]] to get latest.

== Associate ==

This device association is done via USB, once installing the patches, connect the device using USB, and press the Sony button until you see only one led turned on.
Then you can disconnect the device and press the sony button to associate via bluetooth.

== Test ==

You can always test the device using the following command and move stick or press buttons:
{{Command|cat /dev/input/jsX}}

== Maintainer ==

[[User:Alonbl|Alon Bar-Lev]]

{{AuthorList|{{Author|Alon Bar-Lev|2011-11-17|type=original}}}}

[[Category:Hardware]]
[[Category:Bluetooth]]</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/Stealth DHCP</title>
    <id>62</id>
    <revision>
      <id>185</id>
      <timestamp>2013-06-05T20:18:20Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <minor/>
      <comment>moved [[Stealth DHCP]] to [[Gentoo/Stealth DHCP]]</comment>
      <text xml:space="preserve">When using DHCP as client your computer leaves traces of its mac address, hostname and even some uuid at hosting network.

It is possible to leave lower mark.

== Configuration ==

{{Root|emerge net-analyzer/macchanger app-arch/sharutils}}

Add:
{{File|/etc/conf.d/net|&lt;pre&gt;
my_name=`cat /dev/urandom | head --bytes 9 | uuencode -m - | head -n 2 | tail -n 1`

preup() {
        [ -f /var/lib/dhcpcd/dhcpcd.duid ] &amp;&amp; rm /var/lib/dhcpcd/dhcpcd.duid
        return 0
}

rc_net_eth0_need=&quot;firewall&quot;     # optional, if you have firewall
dhcp_eth0=&quot;release nontp nonis nosendhost&quot;
dhcpcd_eth0=&quot;-h ${my_name} -I ${my_name}&quot;
mac_eth0=&quot;random-samekind&quot;
&lt;/pre&gt;}}

== Maintainer ==

[[User:Alonbl|Alon Bar-Lev]]

{{AuthorList|{{Author|Alon Bar-Lev|2011-11-17|type=original}}}}

[[Category:Security]]</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/Suspend To Disk Using uswsusp and genkernel</title>
    <id>58</id>
    <revision>
      <id>217</id>
      <timestamp>2013-06-05T20:23:54Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <minor/>
      <comment>moved [[Suspend To Disk Using uswsusp and genkernel]] to [[Gentoo/Suspend To Disk Using uswsusp and genkernel]]</comment>
      <text xml:space="preserve">{{Package|sys-power/suspend}} aka uswsusp is the mainline suspend/resume solution. It contain both s2ram (suspend to RAM) and s2disk (suspend to disk aka hibernate). The problem is that Genkernel developers ignores the need to use suspend properly see {{Bug|156445|303533}}.

== Preparations ==

{{Kernel||&lt;pre&gt;
  General setup  ---&gt;
    [*] Initial RAM filesystem and RAM disk (initramfs/initrd) support
  Power management and ACPI options  ---&gt;
    [*] Suspend to RAM and standby
    [*] Hibernation (aka 'suspend to disk')
    [*] ACPI (Advanced Configuration and Power Interface) Support  ---&gt;
      -*-   Button
&lt;/pre&gt;}}

Assuming swap partition is at /dev/sda2:
{{File|/etc/suspend.conf|&lt;pre&gt;
snapshot device = /dev/snapshot
resume device = /dev/sda2
compute checksum = y
compress = y
&lt;/pre&gt;}}

{{Root|cp /usr/share/genkernel/defaults/linuxrc /usr/share/genkernel/defaults/linuxrc.uswsusp}}
Modify:
{{File|/usr/share/genkernel/defaults/linuxrc.uswsusp|&lt;pre&gt;
 #!/bin/sh
 
 . /etc/initrd.defaults
 . /etc/initrd.scripts
+swsusp_resume() {
+    /sbin/resume
+}
 splash() {
&lt;/pre&gt;}}
{{Root|mkdir -p /var/lib/genkernel/overlay/etc /var/lib/genkernel/overlay/sbin}}
{{Root|cp /etc/suspend.conf /var/lib/genkernel/overlay/etc}}
{{Root|cp /usr/lib/suspend/resume /var/lib/genkernel/overlay/sbin}}
{{Root|&lt;nowiki&gt;genkernel --linuxrc=/usr/share/genkernel/defaults/linuxrc.uswsusp --initramfs-overlay=/var/lib/genkernel/overlay your_standard_parameters&lt;/nowiki&gt;}}

Basically it will use standard genkernel process with the patched linuxrc script and inject the resume utility and suspend.conf into the initramfs.

== Test ==

* Switch to text mode.
* Run:
{{Root|s2disk}}
* Wait for computer to turn off.
* Turn on computer.
* After boot you should resume right after the s2disk.

== Integrating splashutils ==

uswsusp can show nice splash activity during suspend/resume.

{{File|/etc/portage/package.use/suspend.conf|&lt;pre&gt;
sys-power/suspend fbsplash
&lt;/pre&gt;}}

Add:
{{File|/etc/suspend.conf|&lt;pre&gt;
splash = y
&lt;/pre&gt;}}

Recreate the initramfs overlay with the new resume and suspend.conf.

Run genkernel again now as splash enabled, and again.

== Tweeks ==

=== hibernate-script ===

Suspending from graphical environment or within complex environment requires tweaking. There are two alternatives: [http://packages.gentoo.org/package/sys-power/hibernate-script sys-power/hibernate-script] and sys-power/pm-utils.

I use the hibernate-script as it is simple and extensible framework.

Modify:
{{File|/etc/hibernate/common.conf|&lt;pre&gt;
SaveClock yes             # this will save current system time into RTC when suspending.
FBSplash on               # this will turn on splash during hibernate-script operation.
Unmount /boot /mnt/tmp    # in case resume fails, or filesystem is accessed during boot, better to umount it cleanly before suspend.
FullSpeedCPU yes          # perform suspend as fast as we can, even if we chose to save power on batteries for example.
OnSuspend 55 sync         # execute command during suspend
GentooModulesAutoload yes # hack for Gentoo
SwitchToTextMode no       # save if you are using kernel mode switching
&lt;/pre&gt;}}

Now you can suspend from anywhere, try:
{{Root|hibernate}}

=== acpid ===

{{Root|emerge sys-apps/acpid}}
{{Root|rc-update add acpid default}}

The following will suspend to disk when sleep button is pressed, and suspend to RAM if power button is pressed or lid is closed, add:
{{File|/etc/acpid/default.sh|&lt;pre&gt;
         button)
                 case &quot;$action&quot; in
+                        power)
+                                /usr/sbin/hibernate
+
+                        ;;
+                        lid)
+                                grep -q closed /proc/acpi/button/lid/LID/state &amp;&amp; \
+                                        /usr/sbin/hibernate-ram
+                        ;;
+                        sleep)
+                                /usr/sbin/hibernate
+                        ;;
&lt;/pre&gt;}}

== Suspend to RAM ==

Suspend to RAM is more problematic than suspend to disk as it requires hardware support and cooperation. In most recent laptops it works correctly.

Use the hibernate script, you may need to alter:
{{File|ususpend-ram.conf|&lt;pre&gt;
USuspendRamForce yes     # if hardware is unrecognized (most probably)
USuspendRamAcpiSleep 3   # if you experiencing problem in waking up, also try 1 or 2
&lt;/pre&gt;}}

{{Root|hibernate-ram}}

If still not being able to wake up, try to play with other tweaks available in file.

== Maintainer ==

[[User:Alonbl|Alon Bar-Lev]]

{{AuthorList|{{Author|Alon Bar-Lev|2011-11-17|type=original}}}}

[[Category:Power Management]]</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/Syslinux Bootloader</title>
    <id>72</id>
    <revision>
      <id>159</id>
      <timestamp>2013-06-05T20:14:39Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <minor/>
      <comment>moved [[Syslinux Bootloader]] to [[Gentoo/Syslinux Bootloader]]</comment>
      <text xml:space="preserve">= Syslinux Bootloader =

People probably don't know that {{Package|sys-boot/syslinux}} bootloader is good replacement to other &quot;advanced&quot; bootloaders such as Grub.

For sure syslinux is better maintained than Grub, so after long time of using Grub [[Alonbl|I]] switched.

Unlike Grub syslinux is well behaved bootloader and does not need any special requirement.

syslinux components:
* syslinux - FAT filesystem bootloader.
* extlinux - ext2 filesystem bootloader.
* pxelinux - network pxe bootloader.
* isolinux - ISO-9660 (cdrom) bootloader.

This manual should be kept simple for most of common usages (extlinux, syslinux), for advanced usages refer to upstream site or other pages.

== Installation ==

{{Root|emerge sys-boot/syslinux}}

{{Warning|Assuming /dev/sda1 is the boot partition, if not make the adjustments!}}

Install MBR:
{{Root|cat /usr/share/syslinux/mbr.bin &gt; /dev/sda}}

Set boot partition as active:
{{Root|fdisk /dev/sda}}
{{Codeline|&lt;pre&gt;
Command (m for help): a
Partition number (1-4): 1
Command (m for help): w
&lt;/pre&gt;}}

=== extlinux bootloader installation ===

{{Warning|Assuming /dev/sda1 is the boot partition, if not make the adjustments!}}

{{Root|mount /dev/sda1 /boot}}
{{Root|extlinux --install /boot}}
{{Root|umount /boot}}

=== syslinux bootloader installation ===

{{Note|Most probably you don't need to use FAT filesystem these days, consider ext2 filesystem for your boot partition}}

{{Warning|Assuming /dev/sda1 is the boot partition, if not make the adjustments!}}

{{Root|mount /dev/sda1 /boot}}
{{Root|syslinux --install /dev/sda1}}
{{Root|umount /boot}}

=== pxelinux bootloader installation ==

TODO

== Configuration ==

Configuration file varies between bootloaders:
* syslinux - syslinux.cfg
* extlinux - extlinux.conf
* isolinux - isolinux.cfg

The configuration format is the same.

=== Simple configuration ===

{{File|extlinux.conf|&lt;pre&gt;
LABEL x86_64-3.1.0-gentoo-r1
KERNEL kernel-x86_64-3.1.0-gentoo-r1
INITRD initramfs-x86_64-3.1.0-gentoo-r1
APPEND real_root=/dev/sda3
&lt;/pre&gt;}}

=== Menu configuration ===

The following configuration provides a simple text menu example.

This is done via the vesamenu module, in some cases where vesa is not compatible, the simpler menu module will work.

Logic:
# Do not wait for user interaction and select the &quot;menu&quot; configuration.
# The &quot;menu&quot; configuration entry actually loads the &quot;vesamenu.c32&quot; module.
# The vesamenu module reads the same configuration file, but now present entries as menu entries.
# The &quot;menu&quot; entry will be hidden.
# After 3 seconds (3*10=30) The default x86_64-3.1.0-gentoo-r1 entry will be selected.

Copy the VESA menu module into the boot filesystem.
{{Root|cp /usr/share/syslinux/vesamenu.c32 /boot}}

{{File|extlinux.conf|&lt;pre&gt;
PROMPT 0
DEFAULT menu

TIMEOUT 30
ONTIMEOUT x86_64-3.1.0-gentoo-r1

MENU TITLE Boot

LABEL x86_64-3.1.0-gentoo-r1
KERNEL kernel-x86_64-3.1.0-gentoo-r1
INITRD initramfs-x86_64-3.1.0-gentoo-r1
APPEND real_root=/dev/sda3

LABEL x86_64-3.1.0-gentoo
KERNEL kernel-x86_64-3.1.0-gentoo
INITRD initramfs-x86_64-3.1.0-gentoo
APPEND real_root=/dev/sda3

LABEL menu
MENU HIDE
KERNEL vesamenu.c32
&lt;/pre&gt;}}

== Maintainer ==

[[User:Alonbl|Alon Bar-Lev]]

{{AuthorList|{{Author|Alon Bar-Lev|2011-11-17|type=original}}}}

[[Category:Boot]]</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/Thinkpad Common</title>
    <id>81</id>
    <revision>
      <id>187</id>
      <timestamp>2013-06-05T20:18:35Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <minor/>
      <comment>moved [[Thinkpad Common]] to [[Gentoo/Thinkpad Common]]</comment>
      <text xml:space="preserve">
IBM Thinkpad mobile computers were always a great choice for Linux users. The BIOS and peripheral were supported due to IBM discloser of hardware specs.

Thinkpad BIOS was always compatible for suspend to ram and and suspend to disk.

Thinkpad ACPI module translated events read from NVRAM to actual ACPI events (such as dock, lid and button events). The NVRAM is a special device that
can be used in order to read the state of the special Thinkpad keys. It is not event driven, so it must be pulled by
the Thinkpad ACPI module.

HDAPS (Hard disk protection system) is a feature of Thinkpad that senses movements, and may use in order to park disks in order to keep them safe.

Recently also TPM chip was added, it is standard 1.2 TPM device and may be used by TPM enabled software.

== Kernel ==

Typical Thinkpad specific configuration:

{{Kernel||&lt;pre&gt;
  Power management and ACPI options  ---&gt;
    [*] Suspend to RAM and standby
    [*] Hibernation (aka 'suspend to disk')
    [*] Run-time PM core functionality
    [*] ACPI (Advanced Configuration and Power Interface) Support  ---&gt;
      &lt;M&gt;   AC Adapter
      &lt;M&gt;   Battery
      -*-   Button
      -*-   Video
      &lt;M&gt;   Fan
      [*]   Dock
      &lt;M&gt;   Processor
      &lt;M&gt;   Thermal Zone
    CPU Frequency scaling  ---&gt;
      [*] CPU Frequency scaling
      &lt;M&gt;   CPU frequency translation statistics
      [*]     CPU frequency translation statistics details
      Default CPUFreq governor (performance)  ---&gt;
      -*-   'performance' governor
      &lt;M&gt;   'powersave' governor
      &lt;M&gt;   'userspace' governor for userspace frequency scaling
      &lt;M&gt;   'ondemand' cpufreq policy governor
      &lt;M&gt;   'conservative' cpufreq governor
      x86 CPU frequency scaling drivers  ---&gt;
        &lt;M&gt; ACPI Processor P-States drivers
    -*- CPU idle PM support
    [*]   Cpuidle Driver for Intel Processors
  Device Drivers  ---&gt;
    Character devices  ---&gt;
      &lt;M&gt; TPM Hardware Support  ---&gt;
        &lt;M&gt;   TPM Interface Specification 1.2 Interface
    [*] X86 Platform Specific Device Drivers  ---&gt;
      &lt;M&gt;   ThinkPad ACPI Laptop Extras 
      [*]     Console audio control ALSA interface
      [*]     Allow control of important LEDs (unsafe)
      [*]     Video output control support
      [*]     Support NVRAM polling for hot keys
&lt;/pre&gt;}}

{{File|/etc/conf.d/modules|&lt;pre&gt;
modules=&quot;${modules} thinkpad_acpi&quot;

modules=&quot;${modules}
ac
battery
fan
processor
thermal
coretemp
&quot;

modules=&quot;${modules}
acpi-cpufreq
cpufreq-conservative
cpufreq-ondemand
cpufreq-powersave
&quot;&lt;/pre&gt;}}

== Misc ==

=== X11 ===

To use scroll add the following:

{{File|/etc/X11/xorg.conf.d/30-trackpoint.conf|&lt;pre&gt;
Section &quot;InputClass&quot;
        Identifier      &quot;MyMouse&quot;
        MatchProduct    &quot;TrackPoint&quot;

        Option          &quot;Buttons&quot;               &quot;3&quot;
        Option          &quot;EmulateWheel&quot;
        Option          &quot;EmulateWheelButton&quot;    &quot;2&quot;
EndSection
&lt;/pre&gt;}}

=== hdaps ===

{{File|/etc/portage/package.use/thinkpad.conf|&lt;pre&gt;
app-laptop/tp_smapi hdaps
&lt;/pre&gt;}}

{{Root|emerge app-laptop/tp_smapi app-laptop/hdapsd}}

Until {{Bug|392475}} resolved, add at end:
{{File|/etc/conf.d/hdapsd|&lt;pre&gt;
OPTIONS=&quot;${OPTIONS} -l&quot;
&lt;/pre&gt;}}

{{Root|rc-update add hdapsd default}}
{{Root|/etc/init.d/hdapsd start}}

==== KDE widget ====

{{Root|emerge hdaps_monitor}}

Add HDPS widget to tray.

=== TPM ===

TODO

== Maintainer ==

[[User:Alonbl|Alon Bar-Lev]]

{{AuthorList|{{Author|Alon Bar-Lev|2011-11-25|type=original}}}}

[[Category:Lenovo_Laptops]]</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/USB Power Saving</title>
    <id>48</id>
    <revision>
      <id>219</id>
      <timestamp>2013-06-05T20:24:21Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <minor/>
      <comment>moved [[USB Power Saving]] to [[Gentoo/USB Power Saving]]</comment>
      <text xml:space="preserve">= USB Power Saving =

Linux has the ability to poweroff USB devices and let the USB device request to wake up.

{{Warning|Many optical mice does not support this, as once their power is down they cannot detect motion}}

== Configuration ==

{{Kernel||&lt;pre&gt;
  Device Drivers  ---&gt;
    [*] USB support  ---&gt;
      &lt;M&gt;   Support for Host-side USB
      [*]     USB runtime power management (autosuspend) and wakeup
&lt;/pre&gt;}}

Set auto suspend to 1 seconds:
{{File|/etc/modprobe.d/usb.conf|&lt;pre&gt;
options usbcore autosuspend=1
&lt;/pre&gt;}}

Enforce for every device:
{{File|/etc/udev/rules.d/60-power.rules|&lt;pre&gt;
SUBSYSTEM!=&quot;usb&quot;, GOTO=&quot;power_usb_rules_end&quot;
ACTION!=&quot;add&quot;, GOTO=&quot;power_usb_rules_end&quot;

KERNEL==&quot;[0-9]*:*&quot;, WAIT_FOR_SYSFS=&quot;bInterfaceProtocol&quot;
PROGRAM=&quot;/bin/sleep 0.1&quot;

ATTR{power/level}==&quot;*&quot;, ATTR{power/level}=&quot;auto&quot;

LABEL=&quot;power_usb_rules_end&quot;
&lt;/pre&gt;}}

[[Category:Power Management]]</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/USB SATA JM20337</title>
    <id>53</id>
    <revision>
      <id>161</id>
      <timestamp>2013-06-05T20:15:00Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <minor/>
      <comment>moved [[USB SATA JM20337]] to [[Gentoo/USB SATA JM20337]]</comment>
      <text xml:space="preserve">= USB-SATA Bridge JM20337 =

{{Warning|ATTENTION: This device does not work with disks larger than 2.2T.}}

Refer to [http://comments.gmane.org/gmane.linux.usb.general/62798 this] thread.

== Device ==

[[File:USB_SATA_JM20337.jpg]]

USB
{{Codeline|&lt;pre&gt;
152d:2338 JMicron Technology Corp. / JMicron USA Technology Corp. JM20337 Hi-Speed USB to SATA &amp; PATA Combo Bridge
&lt;/pre&gt;}}

== Installation ==

Standard USB mass storage device.

[[Category:Hardware]]</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/USB SATA SPIF225A</title>
    <id>54</id>
    <revision>
      <id>249</id>
      <timestamp>2013-06-05T21:06:41Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve">= USB-SATA Bridge SPIF225A =

{{Note|This device supports disks larger than 2.2T.}}

{{Warning|DO NOT BUY THIS PRODUCT}}

On some computers the device cannot be plugged-in, errors:
 Nov 17 22:00:02 localhost kernel: usb 3-1.2: device descriptor read/64, error -32
 Nov 17 22:00:02 localhost kernel: usb 3-1.2: device descriptor read/64, error -32
 Nov 17 22:00:02 localhost kernel: usb 3-1.2: new full-speed USB device number 26 using ehci_hcd
 Nov 17 22:00:02 localhost kernel: usb 3-1.2: device descriptor read/64, error -32
 Nov 17 22:00:02 localhost kernel: usb 3-1.2: device descriptor read/64, error -32
 Nov 17 22:00:02 localhost kernel: usb 3-1.2: new full-speed USB device number 27 using ehci_hcd
 Nov 17 22:00:03 localhost kernel: usb 3-1.2: device not accepting address 27, error -32
 Nov 17 22:00:03 localhost kernel: usb 3-1.2: new full-speed USB device number 28 using ehci_hcd
 Nov 17 22:00:03 localhost kernel: usb 3-1.2: device not accepting address 28, error -32
 Nov 17 22:00:03 localhost kernel: hub 3-1:1.0: unable to enumerate USB device on port 2
 Nov 17 22:00:07 localhost kernel: ehci_hcd 0000:00:1a.0: power state changed by ACPI to D3cold
 Nov 17 22:01:17 localhost kernel: ehci_hcd 0000:00:1a.0: power state changed by ACPI to D0

Connecting via usb hub makes it work. As far as I investigated it relates to the current level the device pulls.

== Device ==

[[File:USB_SATA_SPIF225A.jpg|200px]]

USB
{{Codeline|&lt;pre&gt;
152d:2329 JMicron Technology Corp. / JMicron USA Technology Corp. transcend storejet 25P
&lt;/pre&gt;}}

Unlike other devices, specifications is [http://www.datasheet4u.net_/datasheet/S/P/I/SPIF225A_Sunplus.pdf.html available].

== Installation ==

Standard USB mass storage device with automatic quirks.

== Issues ==

Device must be plugged-in before hard disk power is connected.

Device comes without power supply, so I had to buy [[Gentoo/USB_SATA_JM20337]] just for the power supply.

== Maintainer ==

[[User:Alonbl|Alon Bar-Lev]]

{{AuthorList|{{Author|Alon Bar-Lev|2012-09-06|type=original}}}}

[[Category:Hardware]]</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/Userspace software suspend</title>
    <id>79</id>
    <revision>
      <id>221</id>
      <timestamp>2013-06-05T20:24:46Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <minor/>
      <comment>moved [[Userspace software suspend]] to [[Gentoo/Userspace software suspend]]</comment>
      <text xml:space="preserve">Userspace software suspend, also known as µswsusp or uswsusp, is a system for hibernating/suspending. It supports suspend-to-RAM, suspend-to-disk, and &quot;suspend-to-both&quot;.

Uswsusp is an altenative to [[TuxOnIce]] (Suspend2), which is the suspend-to-disk tool recommended by the [http://www.gentoo.org/doc/en/power-management-guide.xml#doc_chap7 Gentoo Power Management Guide]. It is the successor to swsusp, a suspend-to-disk mechanism built into 2.6 kernels that notably lacked support for LVM.

== Comparison with TuxOnIce ==

TuxOnIce has many more [http://www.tuxonice.net/features features] than uswsusp, like writing to multiple swap devices. An interesting feature that both uswsusp and TuxOnIce have is &quot;suspend-to-both&quot;, where the system state is recorded to both RAM and disk so the computer can resume quickly while staying resilient to power loss. On uswsusp, &quot;suspend-to-both&quot; is a explicit method to suspend, ready to use; on TuxOnIce it requires a bit of configuration: user needs to manually set {{Path|/sys/power/tuxonice/powerdown_method}} to {{Codeline|3}} or do it by a helper, like [[Userspace_software_suspend#Hibernate_script|hibernate-script]] which can be set with option {{Codeline|PowerdownMethod 3}}.

Uswsusp has, arguably, a better design than TuxOnIce, as most of its code is in userland rather than in the kernel. TuxOnIce requires patches to the mainline kernel, meaning you have to either run {{Package|sys-kernel/tuxonice-sources|direct=yes}} or patch your kernel by hand. Running tuxonice-sources may not be an option if you're already running a patched kernel (xen-sources, hardened-sources, etc.) or you need a newer kernel version than the tuxonice-sources ebuilds offer.

== Installation ==

Make sure your kernel has initramfs and suspend support enabled. You can probably leave &quot;Default resume partition&quot; blank if you're using an initramfs.
{{Kernel|Suspend kernel config|&lt;pre&gt;
 General setup  ---&gt;
    [*] Initial RAM filesystem and RAM disk (initramfs/initrd) support
  Power management and ACPI options  ---&gt;
    [*] Suspend to RAM and standby
    [*] Hibernation (aka 'suspend to disk')
    [*] ACPI (Advanced Configuration and Power Interface) Support  ---&gt;
      -*-   Button
&lt;/pre&gt;}}

Unmask {{Package|sys-power/suspend|direct=yes}}, the userspace programs for uswsusp. Emerge suspend and the {{Package|sys-power/hibernate-script|direct=yes}} wrapper.
{{File|/etc/portage/package.accepted_keywords/suspend.conf|&lt;pre&gt;
sys-power/suspend ~amd64
&lt;/pre&gt;}}

{{Root|emerge -av suspend hibernate-script}}

== Configuration ==

=== Uswsusp ===

Uswsusp reads its configuration from {{Path|/etc/suspend.conf}}. The key parameter is {{Codeline|resume device}}, which you should set to the path of your swap device.
{{File|/etc/suspend.conf|&lt;pre&gt;
snapshot device = /dev/snapshot
resume device = /dev/RESUME_DEVICE
compute checksum = y
compress = y
&lt;/pre&gt;}}

=== Hibernate script ===

The hibernate script, described in the [http://www.gentoo.org/doc/en/power-management-guide.xml#doc_chap7 Gentoo Power Management Guide], is a wrapper for various suspend and hibernate implementations. It handles stopping and starting any services and drivers that don't play well with suspend, as well as invoking the actual suspend commands.

Recommended settings:

{{File|/etc/hibernate/common.conf|&lt;pre&gt;
SaveClock yes             # this will save current system time into RTC when suspending.
Unmount /boot /mnt/tmp    # in case resume fails, or filesystem is accessed during boot, better to umount it cleanly before suspend.
FullSpeedCPU yes          # perform suspend as fast as we can, even if we chose to save power on batteries for example.
OnSuspend 55 sync         # execute command during suspend
GentooModulesAutoload yes # hack for Gentoo
SwitchToTextMode no       # save if you are using kernel mode switching
&lt;/pre&gt;}}

That'll get you started, but you may have to do further machine-specific configuration. Check out {{Codeline|man hibernate.conf}}, especially the VBE and force options.

== Integration with initramfs ==


You will need an initramfs that runs resume. If you don't have one, [[initramfs|this page]] can walk you through making one. If you already have one -- either homemade or generated by genkernel -- you will likely have to configure your initramfs to support uswsusp. If you're not sure whether you use an initramfs, check for an initrd line in your bootloader configuration ({{Path|/boot/grub/grub.conf}} or {{Path|/boot/lilo/lilo.conf}}).

=== Genkernel ===
It looks like the current version of genkernel doesn't support uswsusp, but the next version might. {{Bug|156445}} explains the current situation and contains a patch to make uswsusp work.

The simple manual method:

{{Root|cp /usr/share/genkernel/defaults/linuxrc /usr/share/genkernel/defaults/linuxrc.uswsusp}}
Modify:
{{File|/usr/share/genkernel/defaults/linuxrc.uswsusp|&lt;pre&gt;
 #!/bin/sh
 
 . /etc/initrd.defaults
 . /etc/initrd.scripts
+swsusp_resume() {
+    /sbin/resume
+}
 splash() {
&lt;/pre&gt;}}
{{Root|mkdir -p /var/lib/genkernel/overlay/etc /var/lib/genkernel/overlay/sbin}}
{{Root|cp /etc/suspend.conf /var/lib/genkernel/overlay/etc}}
{{Root|cp /usr/lib/suspend/resume /var/lib/genkernel/overlay/sbin}}
{{Root|&lt;nowiki&gt;genkernel --linuxrc=/usr/share/genkernel/defaults/linuxrc.uswsusp --initramfs-overlay=/var/lib/genkernel/overlay \
       your_standard_parameters&lt;/nowiki&gt;}}

Basically it will use standard genkernel process with the patched linuxrc script and inject the resume utility and suspend.conf into the initramfs.

=== Custom initramfs ===

If you use a custom initramfs that mounts your root file system and/or activates your swap, you need to alter your usual init steps slightly to get resume from suspend-to-disk working. Basically, you need to manually invoke uswsusp's userspace resume utility before the root partition is mounted. 

The minimal example below shows how to integrate uswsusp with a simple LVM/dm-crypt setup. If used, make sure that {{Package|sys-apps/busybox}} and {{Package|sys-fs/lvm2}} were emerged with the {{EnableFlag|static}} USE flag enabled and {{Package|sys-fs/cryptsetup}} was emerged with the {{USEFlag|dynamic}} USE flag disabled.

==== Populating directory tree ====
Create and populate the directories for your initramfs. The commands below work for {{Keyword|amd64}}; for {{Keyword|x86}}, substitute {{Path|/usr/lib64}} with {{Path|/usr/lib}}:
{{Command|&lt;nowiki&gt;mkdir ~/initramfs
cd ~/initramfs
mkdir bin dev dev/mapper dev/vc etc etc/lvm newroot proc sys
cp /bin/busybox /sbin/cryptsetup /usr/lib64/suspend/resume bin
cp /sbin/lvm.static bin/lvm
ln -s busybox bin/sh
ln -s lvm bin/vgchange
cp -a /dev/console /dev/null /dev/sda2 /dev/snapshot /dev/random /dev/urandom dev
ln -s ../console dev/vc/0
cp /etc/suspend.conf etc
cp /etc/lvm/lvm.conf etc/lvm
&lt;/nowiki&gt;}}
{{Note|Remember to update your initramfs's binaries and {{Path|suspend.conf}} whenever you update their counterparts on the root file system. Rebuild the {{Path|initramfs.img}} after copying the new files.}}

==== Init script example ====
Write an init script to suit your needs.

The example script here assumes a single dm-crypt/LUKS partition, inside of which is an LVM volume group, inside of which is the root volume and the swap volume.  The swap volume is the &quot;resume device&quot; (configured in {{Path|/etc/suspend.conf}}) where uswsusp dumps the machine's state, so the resume has to happen after the swap is unlocked, but before the root volume is mounted. If the resume command finds a suspend image, then the command never returns and the rest of the script is not executed; otherwise, init proceeds normally.

{{Note|This is just an example, not a generic init script. It won't work on your system without modification. Customize it to handle your actual storage layout.}}
{{File|~/initramfs/init|&lt;pre&gt;
#!/bin/sh

mount -t proc proc /proc
mount -t sysfs sysfs /sys
sleep 2  # wait for kernel msgs to quiet

if cryptsetup luksOpen /dev/sda2 vault; then
  vgchange -ay vault_vg
  resume
  mount -r /dev/mapper/vault_vg-root /newroot

  if [[ -x /newroot/sbin/init ]]; then
    umount /sys /proc
    exec switch_root /newroot /sbin/init
  fi
fi

# Uncomment if you want a rescue shell
# exec sh
&lt;/pre&gt;}}
{{Command|chmod a+x init}}

If you want to add more advanced functionality to your init script, like reading kernel command line parameters or loading a keymap, consult the excellent [[DM-Crypt with LUKS#Initramfs.27s_init|init script]] in the [[DM-Crypt with LUKS]] article.

==== Install script ====
This script builds an initramfs image from your {{Path|~/initramfs}} directory tree and copies the image to {{Path|/boot}}. Run this script whenever you change a file in your initramfs.
{{File|~/initramfs/install|&lt;pre&gt;
#!/bin/sh

if ! mount | grep ' on /boot ' &gt; /dev/null; then
  echo 1&gt;&amp;2 &quot;WARNING: /boot doesn't appear to be mounted&quot;
fi

find . | cpio --quiet -o -H newc | gzip -9 &gt; /boot/initramfs.img

&lt;/pre&gt;}}
{{Command|chmod a+x install}}
{{Root|mount /boot
./install}}

==== Configuring the bootloader ====
Configure your bootloader to use your initramfs image. For Grub, add/edit an initrd line to the appropriate boot entry in {{Path|grub.conf}}.

{{File|/boot/grub/grub.conf|&lt;pre&gt;
title Linux
root (hd0,0)
kernel /vmlinuz
initrd /initramfs.img
&lt;/pre&gt;}}

== Usage ==

Uswsusp uses three userspace utilities -- s2ram, s2disk, and s2both -- to execute suspend-to-RAM, suspend-to-disk, and suspend-to-both, respectively. The preferred method for suspending, however, is via the hibernate script, so you shouldn't need to invoke the s2* commands directly unless you're testing your setup.

=== Suspend-to-disk / Suspend-to-both ===
To suspend-to-disk (or suspend-to-both, depending on how you configured {{Path|/etc/hibernate/hibernate.conf}}), just run hibernate as root:
{{Root|hibernate}}

Actually {{Path|/etc/hibernate/hibernate.conf}} refers to 
{{Path|/etc/hibernate/disk.conf}} which tries to load {{Path|ususpend-disk.conf}}. You may want to change this line to {{Path|ususpend-both.conf}} to use suspend-to-both.

=== Suspend-to-RAM ===
To suspend-to-RAM, run:
{{Root|hibernate-ram}}

=== Troubleshooting ===

If something goes wrong, first try suspend/resume without X11 running, most issues are video card related.

Also try s2disk directly from text mode without hibernate script and see if it works.

Suspend to RAM is more problematic than suspend to disk as it requires hardware support and cooperation. In most recent laptops it works correctly. 

{{File|/etc/hibernate/ususpend-ram.conf|&lt;pre&gt;
USuspendRamForce yes     # if hardware is unrecognized (most probably)
USuspendRamAcpiSleep 3   # if you experiencing problem in waking up, also try 1 or 2
&lt;/pre&gt;}}

Then try:
{{Root|hibernate-ram}}

If suspend fails not resume, look at {{Path|var/log/messages}}, you may find modules that broke the suspend cycle, try to unload them during suspend:

{{File|/etc/hibernate/ram.conf|&lt;pre&gt;
UnloadModules MODULE_NAME
&lt;/pre&gt;}}

Try googling for how other people with your particular hardware (e.g., video card) have gotten it to work.

If the screen stays black when you resume, your computer may still be running fine even though the display is borked. Before you reset the machine, try to shut it down cleanly with {{Key|Ctrl+Alt+Del}} or by ssh'ing in.

== Integrating acpid ==

The following will suspend to disk when sleep button is pressed, and suspend to RAM if power button is pressed or lid is closed, add:

{{Root|emerge sys-apps/acpid}}
{{Root|rc-update add acpid default}}

{{File|/etc/acpid/default.sh|&lt;pre&gt;
         button)
                 case &quot;$action&quot; in
+                        power)
+                                /usr/sbin/hibernate
+
+                        ;;
+                        lid)
+                                grep -q closed /proc/acpi/button/lid/LID/state &amp;&amp; \
+                                        /usr/sbin/hibernate-ram
+                        ;;
+                        sleep)
+                                /usr/sbin/hibernate
+                        ;;
&lt;/pre&gt;}}

You may need to ajust the lid button location to match your architecture.

== Integrating splashutils ==

uswsusp can show nice splash activity during suspend/resume.

{{File|/etc/portage/package.use/suspend.conf|&lt;pre&gt;
sys-power/suspend fbsplash
&lt;/pre&gt;}}

Add:
{{File|/etc/suspend.conf|&lt;pre&gt;
splash = y
&lt;/pre&gt;}}

{{File|/etc/hibernate/common.conf|&lt;pre&gt;
FBSplash on
&lt;/pre&gt;}}

Recreate the initramfs overlay with the new resume and suspend.conf.

Recreate your initramfs with new suspend.conf and try again.

== Links ==

[http://suspend.sourceforge.net/ Userspace software suspend]

[http://forums.gentoo.org/viewtopic-p-6428835.html#6428835 From the forums : a simple init script to resume from uswsusp in your initramfs]


[[Category:Power Management]]</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/VM Tap Networking</title>
    <id>67</id>
    <revision>
      <id>242</id>
      <timestamp>2013-06-05T21:02:49Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve">= VM Tap Networking =

Most of recent VMs support Linux native tap driver. A simple integration with OpenRC eases the use.

What you get is the following setup:

  Host(vbr0) &lt;--+--&gt; (vm0)VM0
     |         |
    NAT        +--&gt; (vm1)VM1
     |
   (eth0)

The NAT is optional, if you like you can add eth0 to the bridge and have the VMs accessing the
network directly.

== Configuration ==

{{Kernel||&lt;pre&gt;
  [*] Networking support  ---&gt; 
    Networking options  ---&gt;
      &lt;M&gt; 802.1d Ethernet Bridging
      [*]   IGMP/MLD snooping
  Device Drivers  ---&gt; 
    [*] Network device support  ---&gt;
      &lt;M&gt;   Universal TUN/TAP device driver support
&lt;/pre&gt;}}

{{Kernel|KVM|&lt;pre&gt;
  Device Drivers  ---&gt; 
    [*] Network device support  ---&gt;
      &lt;M&gt;   MAC-VLAN support (EXPERIMENTAL)
      &lt;M&gt;     MAC-VLAN based tap driver (EXPERIMENTAL)
  [*] Virtualization  ---&gt;
    &lt;M&gt;   Host kernel accelerator for virtio net (EXPERIMENTAL)
&lt;/pre&gt;}}

{{Root|emerge net-misc/bridge-utils}}

Add:
{{File|/etc/conf.d/net|&lt;pre&gt;
tuntap_vm0=&quot;tap&quot;
rc_net_vm0_need=&quot;firewall&quot;
iproute2_vm0=&quot;group users&quot;
config_vm0=&quot;null&quot;

tuntap_vm1=&quot;tap&quot;
rc_net_vm1_need=&quot;firewall&quot;
iproute2_vm1=&quot;group users&quot;
config_vm1=&quot;null&quot;

rc_net_vbr0_provide=&quot;!net&quot;
rc_net_vbr0_need=&quot;firewall net.vm0 net.vm1&quot; # firewall is optional
bridge_vbr0=&quot;vm0 vm1&quot;
config_vbr0=&quot;192.168.151.1/24&quot;
brctl_vbr0=&quot;setfd 0
sethello 1
stp off&quot;
&lt;/pre&gt;}}

To enable NAT to world, see [[Gentoo/Firewall_Using_Firehol]]:

{{Root|emrege net-firewall/firehol}}
{{Root|rc-update add firehol default}}

{{File|/etc/firehol/firehol.conf|&lt;pre&gt;
interface &quot;eth+ wlan+ ppp+&quot; inet1
        policy  reject
        protection              strong  10/sec  10
        server  ident           reject  with tcp-reset

        client  all             accept

interface &quot;vbr0&quot; local1
        policy  reject
        protection              strong  10/sec  10
        server  ident           reject  with tcp-reset

        client  all             accept

router tun_nat  inface &quot;eth+ wlan+ ppp+&quot; outface &quot;vbr0&quot;
        route   ident           reject with tcp-reset
        server  ident           reject with tcp-reset
        masquerade              reverse

        client  all             accept
&lt;/pre&gt;}}

{{Root|ln -s net.lo /etc/init.d/net.vm0}}
{{Root|ln -s net.lo /etc/init.d/net.vm1}}
{{Root|ln -s net.lo /etc/init.d/net.vbr0}}

{{Root|/etc/init.d/net.vbr0 start}}

Also recommended to install dnsmasq and use host machine as DNS source pf VMs, so VM can always find correct DNS.

{{Root|emerge net-dns/dnsmasq}}

If you are using VPN or dynamic interfacing, modify:
{{File|/etc/conf.d/dnsmasq|&lt;pre&gt;
DNSMASQ_OPTS=&quot;--strict-order&quot;
&lt;/pre&gt;}}

{{Root|rc-update add dnsmasq default}}
{{Root|/etc/init.d/dnsmasq start}}

== qemu settings ==

Arguments:
  -net nic,netdev=eth0 -netdev tap,id=eth0,ifname=vm0,script=/bin/true

KVM Arguments:
  -net nic,netdev=eth0,model=virtio -netdev tap,id=eth0,ifname=vm0,script=/bin/true,vhost=on

== Maintainer ==

[[User:Alonbl|Alon Bar-Lev]]

{{AuthorList|{{Author|Alon Bar-Lev|2011-11-17|type=original}}}}

[[Category:Network]]</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/Vpnc Non Root</title>
    <id>66</id>
    <revision>
      <id>250</id>
      <timestamp>2013-06-05T21:07:11Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve">= vpnc Non Root =

End result, user can use own tool (I use knemo) to connect/disconnect from {{Package|net-misc/vpnc}}.

The logic is to create tun device and allow users to access it, and wrapping the /sbin/ip and /sbin/resolvconf
using sudo.

== Setup ==

{{Kernel|Add tap|&lt;pre&gt;
  Device Drivers  ---&gt; 
    [*] Network device support  ---&gt;
      &lt;M&gt;   Universal TUN/TAP device driver support
&lt;/pre&gt;}}

Setup portage overlay from [https://github.com/alonbl/alon-barlev-overlay here].

{{Root|emerge net-misc/vpnc net-dns/openresolv}}

{{Package|net-dns/openresolv}} is optional, but makes life much easier, see [[Gentoo/Openresolv]].

It is very recommended to configure firewall on your computer, see [[Gentoo/Firewall_Using_Firehol|firehol configuration]].

Add:
{{File|/etc/conf.d/net|&lt;pre&gt;
rc_net_vpn0_need=&quot;firewall&quot; # optional, if you setup firewall.
rc_net_vpn0_provide=&quot;!net&quot;
tuntap_vpn0=&quot;tun&quot;
iproute2_vpn0=&quot;group users&quot;
config_vpn0=&quot;null&quot;
txqueuelen_vpn0=&quot;100&quot;
metric_vpn0=&quot;10&quot;
&lt;/pre&gt;}}

{{Root|&lt;nowiki&gt;ln -s net.lo /etc/init.d/net.vpn0
rc-update add net.vpn0 default
/etc/init.d/net.vpn0 start
&lt;/nowiki&gt;}}

{{Command|mkdir -p ~/vpnc/run}}

Add the following to your configuration:
{{File|~/vpnc/site.conf|&lt;pre&gt;
Interface name vpn0
Local Port 0
Pidfile /home/@USER@/vpnc/run/pid
Script VAR_RUN=&quot;/home/@USER@/vpnc/run&quot; ROUTE_METRIC=&quot;10&quot; IPROUTE=&quot;sudo /sbin/ip&quot; RESOLVCONF=&quot;sudo /sbin/resolvconf&quot; /etc/vpnc/vpnc-script
Xauth interactive
&lt;/pre&gt;}}

{{File|/etc/sudoers.d/vpnc|&lt;pre&gt;
%users ALL=(ALL) NOPASSWD: /sbin/ip
%users ALL=(ALL) NOPASSWD: /sbin/resolvconf
&lt;/pre&gt;}}

== &lt;div id=&quot;cli&quot;&gt;cli&lt;/div&gt; ==

Start:
{{Command|/usr/sbin/vpnc /home/@USER@/vpnc/site.conf}}

Stop:
{{Command|&lt;nowiki&gt;VAR_RUN=&quot;/home/@USER@/vpnc/run&quot; /usr/sbin/vpnc-disconnect&lt;/nowiki&gt;}}

== knemo ==

=== Dialogs ===

{{File|~/vpnc/vpnc-getpass|&lt;pre&gt;
#!/bin/sh

die() {
        local m=&quot;$1&quot;
        echo &quot;FATAL: $1&quot; &gt;&amp;2
        exit 1
}

prompt=&quot;$1&quot;

[ -z &quot;${prompt}&quot; ] &amp;&amp; die &quot;usage: $0 prompt&quot;

kdialog --title &quot;vpnc&quot; --password &quot;$prompt&quot; || die &quot;password&quot;
&lt;/pre&gt;}}

Add the following to your configuration:
{{File|~/vpnc/site.conf|&lt;pre&gt;
Password Program /home/@USER@/vpnc/vpnc-getpass
&lt;/pre&gt;}}

=== Context menu ===

Start/stop same as [[#cli|cli]] above.

== Maintainer ==

[[User:Alonbl|Alon Bar-Lev]]

{{AuthorList|{{Author|Alon Bar-Lev|2012-08-15|type=original}}}}

[[Category:Software]]
[[Category:Security]]
[[Category:Network]]</text>
    </revision>
  </page>
  <page>
    <title>Gentoo/ZTE USB GSM Modem</title>
    <id>50</id>
    <revision>
      <id>234</id>
      <timestamp>2013-06-05T20:56:07Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve">= ZTE USB GSM Modem =

== Device ==

[[File:ZTE_USB_GSM_Modem.jpg|200px]]

USB
{{Codeline|&lt;pre&gt;
19d2:2000 ONDA Communication S.p.A. ZTE MF627/MF628/MF628+/MF636+ HSDPA/HSUPA
19d2:0117 ONDA Communication S.p.A.
&lt;/pre&gt;}}

== Installation ==

{{Kernel||&lt;pre&gt;
  Device Drivers  ---&gt;
    SCSI device support  ---&gt;
      {M} SCSI device support
      &lt;M&gt; SCSI CDROM support
    [*] USB support  ---&gt;
      &lt;M&gt;   USB Mass Storage support
&lt;/pre&gt;}}

You should also configure the system to run PPP.&amp;nbsp; See [[Gentoo/PPP_Client|how to configure ppp client]].

Device is first exposed as CDROM, need special utility to switch it into modem mode.
{{Root|emerge sys-apps/usb_modeswitch}}

Unplug and plug device. You should see it as:
 19d2:2000 ONDA Communication S.p.A. ZTE MF627/MF628/MF628+/MF636+ HSDPA/HSUPA
Then it should be converted to:
 19d2:0117 ONDA Communication S.p.A.

== Network configuration ==

Add:
{{File|/etc/conf.d/net|&lt;pre&gt;
rc_net_ppp2_need=&quot;firewall&quot;           # optional, if you have firewall
config_ppp2=&quot;ppp&quot;
link_ppp2=&quot;/dev/ttyUSB4&quot;
pppd_ppp2=&quot;noauth defaultroute usepeerdns lock mru 296 mtu 296&quot;
phone_number_ppp2=&quot;*99#&quot;
isp_ppp2=&quot;internet&quot;               # set this to match your network
chat_ppp2=&quot;
ABORT BUSY
ABORT ERROR
ABORT 'NO ANSWER'
ABORT 'NO CARRIER'
ABORT 'NO DIALTONE'
ABORT 'Invalid Login'
ABORT 'Login incorrect'
TIMEOUT 5
'' 'ATZ'
OK AT+cfun=1
OK AT+cgreg=1
OK AT+CGDCONT=1,\\\&quot;IP\\\&quot;,\\\&quot;${isp_ppp2}\\\&quot;
OK AT
OK 'ATDT\T'
TIMEOUT 60
CONNECT ''
TIMEOUT 5
'~--' ''&quot;
&lt;/pre&gt;}}

{{Root|ln -s net.lo /etc/init.d/net.ppp2}}

== Manage ==

{{Root|/etc/init.d/net.ppp2 start}}
{{Root|/etc/init.d/net.ppp2 stop}}

== Maintainer ==

[[User:Alonbl|Alon Bar-Lev]]

{{AuthorList|{{Author|Alon Bar-Lev|2011-11-17|type=original}}}}

[[Category:Hardware]]
[[Category:Network]]</text>
    </revision>
  </page>
  <page>
    <title>Main Page</title>
    <id>1</id>
    <revision>
      <id>254</id>
      <timestamp>2013-06-05T21:12:43Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve">= Welcome to Alon Bar-Lev's Site =

* [[User:Alonbl]]
* [[Gentoo]]</text>
    </revision>
  </page>
  <page>
    <title>Template:Author</title>
    <id>14</id>
    <revision>
      <id>25</id>
      <timestamp>2013-06-05T09:02:58Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <comment>Created page with &quot;{{#ifeq: {{{type}}}|original|Originally written by|{{#ifeq: {{{type}}}|translate|Translated by|Edited by}}}}: {{{1}}} - {{{2}}}&lt;br/&gt; &lt;noinclude&gt;{{TemplateDoc}}[[Category:Template...&quot;</comment>
      <text xml:space="preserve">{{#ifeq: {{{type}}}|original|Originally written by|{{#ifeq: {{{type}}}|translate|Translated by|Edited by}}}}: {{{1}}} - {{{2}}}&lt;br/&gt;
&lt;noinclude&gt;{{TemplateDoc}}[[Category:Templates]]&lt;/noinclude&gt;</text>
    </revision>
  </page>
  <page>
    <title>Template:Author/Doc</title>
    <id>17</id>
    <revision>
      <id>30</id>
      <timestamp>2013-06-05T09:09:32Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <comment>Created page with &quot;This template is generally used in conjuction with [[:Template:AuthorList]]. It takes two arguments - author name and date. Optionally you can specify edit type via &quot;type&quot; option...&quot;</comment>
      <text xml:space="preserve">This template is generally used in conjuction with [[:Template:AuthorList]]. It takes two arguments - author name and date. Optionally you can specify edit type via &quot;type&quot; option (default is general edit).  This should only be used if you have made a major content change or addition to the article, basic maintenance does not warrant this tag.

Example:

&lt;pre&gt;* {{Author|Xificurk|2008-11-04|type=original}}
* {{Author|Mikevalstar|2008-11-04|type=translate}}
* {{Author|Jeremy|2008-11-04}}&lt;/pre&gt;


Will produce:

* {{Author|Xificurk|2008-11-04|type=original}}
* {{Author|Mikevalstar|2008-11-04|type=translate}}
* {{Author|Jeremy|2008-11-04}}

&lt;noinclude&gt;[[Category:Template Documentation]]&lt;/noinclude&gt;</text>
    </revision>
  </page>
  <page>
    <title>Template:AuthorList</title>
    <id>13</id>
    <revision>
      <id>24</id>
      <timestamp>2013-06-05T08:59:50Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <comment>Created page with &quot;== Authors == {{{1}}}  &lt;span style=&quot;font-size: 0.9em;&quot;&gt;''Authors are people who have worked on this document and have made significant changes to its content. If you have edited ...&quot;</comment>
      <text xml:space="preserve">== Authors ==
{{{1}}}

&lt;span style=&quot;font-size: 0.9em;&quot;&gt;''Authors are people who have worked on this document and have made significant changes to its content. If you have edited this article and wish to add yourself to the authors list please read &quot;[[Help:FAQ#Who_are_Authors|Who are Authors]]&quot;.''&lt;/span&gt;
&lt;noinclude&gt;[[Category:Templates]]&lt;/noinclude&gt;</text>
    </revision>
  </page>
  <page>
    <title>Template:Box</title>
    <id>6</id>
    <revision>
      <id>13</id>
      <timestamp>2013-05-24T08:22:43Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <comment>Initial add</comment>
      <text xml:space="preserve">&lt;div style=&quot;border: 1px solid {{{color|#333}}}; background-color: {{{bgcol|#F3F3F3}}}; overflow: auto&quot;&gt;&lt;div&gt;&lt;span style=&quot;background-color: {{{color|#333}}}; color: {{{titlecol|white}}}&quot;&gt;{{{1}}}&lt;/span&gt;{{#if:{{{description|}}}|&lt;span style=&quot;color: {{{descriptioncol|{{{color|#333}}}}}};&quot;&gt;{{{description}}}&lt;/span&gt;|}}&lt;/div&gt;&lt;br style=&quot;clear: both;&quot; /&gt;&lt;div&gt;{{{2}}}&lt;/div&gt;&lt;/div&gt;</text>
    </revision>
  </page>
  <page>
    <title>Template:Bug</title>
    <id>37</id>
    <revision>
      <id>58</id>
      <timestamp>2013-06-05T09:30:48Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <comment>Created page with &quot;[http://bugs.gentoo.org/buglist.cgi?quicksearch={{{1}}} bug {{{1}}}]&lt;noinclude&gt;{{TemplateDoc}}&lt;/noinclude&gt;&quot;</comment>
      <text xml:space="preserve">[http://bugs.gentoo.org/buglist.cgi?quicksearch={{{1}}} bug {{{1}}}]&lt;noinclude&gt;{{TemplateDoc}}&lt;/noinclude&gt;</text>
    </revision>
  </page>
  <page>
    <title>Template:Bug/Doc</title>
    <id>38</id>
    <revision>
      <id>59</id>
      <timestamp>2013-06-05T09:31:01Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <comment>Created page with &quot;Template for providing a bug search based on bug number for bugs listed at http://bugs.gentoo.org/.  Example: &lt;nowiki&gt;{{Bug|249640}}&lt;/nowiki&gt;  Will produce: {{Bug|249640}}  &lt;noin...&quot;</comment>
      <text xml:space="preserve">Template for providing a bug search based on bug number for bugs listed at http://bugs.gentoo.org/.

Example:
&lt;nowiki&gt;{{Bug|249640}}&lt;/nowiki&gt;

Will produce:
{{Bug|249640}}

&lt;noinclude&gt;[[Category:Template Documentation]]&lt;/noinclude&gt;</text>
    </revision>
  </page>
  <page>
    <title>Template:Code</title>
    <id>11</id>
    <revision>
      <id>27</id>
      <timestamp>2013-06-05T09:06:30Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve">{| width=&quot;100%&quot; cellpadding=0 cellspacing=0 style=&quot;background-color: #f2fff2; border: solid 1px #bfffbf;&quot; 
| style=&quot;background-color: #c1ffc1; border: solid 1px #a0ffa0; border-bottom: 1px solid #888; font-size: 0.9em&quot; | '''Code:''' {{{1}}}
|- 
|
{{{2}}}
|}&lt;noinclude&gt;&lt;br/&gt;{{TemplateDoc}}[[Category:Templates]]&lt;/noinclude&gt;</text>
    </revision>
  </page>
  <page>
    <title>Template:Code/Doc</title>
    <id>18</id>
    <revision>
      <id>31</id>
      <timestamp>2013-06-05T09:11:27Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <comment>Created page with &quot;This template is for code.  Example: &lt;pre&gt;{{Code|xorg.conf|&lt;pre&gt; Section &quot;Monitor&quot;         Identifier   &quot;Monitor0&quot;         VendorName   &quot;Monitor Vendor&quot;         ModelName    &quot;Mon...&quot;</comment>
      <text xml:space="preserve">This template is for code.

Example:
&lt;pre&gt;{{Code|xorg.conf|&lt;pre&gt;
Section &quot;Monitor&quot;
        Identifier   &quot;Monitor0&quot;
        VendorName   &quot;Monitor Vendor&quot;
        ModelName    &quot;Monitor Model&quot;
        Modeline     &quot;800x480&quot;  29.58  800 816 896 992  480 481 484 497  -HSync +Vsync
EndSection
&amp;lt;/pre&gt;}}&lt;/pre&gt;

Will produce:
{{Code|xorg.conf|&lt;pre&gt;
Section &quot;Monitor&quot;
        Identifier   &quot;Monitor0&quot;
        VendorName   &quot;Monitor Vendor&quot;
        ModelName    &quot;Monitor Model&quot;
        Modeline     &quot;800x480&quot;  29.58  800 816 896 992  480 481 484 497  -HSync +Vsync
EndSection
&lt;/pre&gt;}}

&lt;noinclude&gt;[[Category:Template Documentation]]&lt;/noinclude&gt;</text>
    </revision>
  </page>
  <page>
    <title>Template:Codeline</title>
    <id>3</id>
    <revision>
      <id>28</id>
      <timestamp>2013-06-05T09:07:49Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve">&lt;span style=&quot;background-color:#dfdfdf; font-family:monospace;&quot;&gt;{{{1}}}&lt;/span&gt;&lt;noinclude&gt;{{TemplateDoc}}[[Category:Templates]]&lt;/noinclude&gt;</text>
    </revision>
  </page>
  <page>
    <title>Template:Codeline/Doc</title>
    <id>16</id>
    <revision>
      <id>29</id>
      <timestamp>2013-06-05T09:08:21Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <comment>Created page with &quot;This template is for code which is included inline.  Example: &lt;nowiki&gt;{{Codeline|app-text/nano **}}&lt;/nowiki&gt;  Will produce: {{Codeline|app-text/nano **}}  &lt;noinclude&gt;[[Category:T...&quot;</comment>
      <text xml:space="preserve">This template is for code which is included inline.

Example: &lt;nowiki&gt;{{Codeline|app-text/nano **}}&lt;/nowiki&gt;

Will produce: {{Codeline|app-text/nano **}}

&lt;noinclude&gt;[[Category:Template Documentation]]&lt;/noinclude&gt;</text>
    </revision>
  </page>
  <page>
    <title>Template:Command</title>
    <id>25</id>
    <revision>
      <id>47</id>
      <timestamp>2013-06-05T09:22:34Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve">&lt;div style=&quot;background-color:#ddffdd; color:#000000; padding:.05em .5em; margin:.5em; border:1px solid #99cc99; border-left:10px solid #99cc99; font-size: 92%; white-space:pre; font-family:monospace; width: 55%;&quot;&gt;{{{1}}}&lt;/div&gt;&lt;noinclude&gt;{{TemplateDoc}}[[Category:Templates]]&lt;/noinclude&gt;</text>
    </revision>
  </page>
  <page>
    <title>Template:Command/Doc</title>
    <id>26</id>
    <revision>
      <id>46</id>
      <timestamp>2013-06-05T09:22:20Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <comment>Created page with &quot;This template is for commands which can be run by any user. For commands which should be run as root, use [[Template:Root]].  Command output should not be included within this te...&quot;</comment>
      <text xml:space="preserve">This template is for commands which can be run by any user. For commands which should be run as root, use [[Template:Root]].

Command output should not be included within this template. Use either [[Template:Codeline]] (for in-line output usage) or &amp;lt;pre&gt; &amp;lt;/pre&gt; (for blocks of output).

Example:
&lt;nowiki&gt;{{Command|emerge --pretend -uDNvt @world}} &lt;/nowiki&gt;

Will produce:
{{Command|emerge --pretend -uDNvt @world}}


If your template comes out with &lt;nowiki&gt;{{{1}}}&lt;/nowiki&gt; instead of the parameter value, see [[Help:FAQ#Template_.28eg._Command_or_User.29_contents_come_out_as_.7B.7B.7B1.7D.7D.7D|the FAQs page]].

'''Note:''' This template is restricted in width to avoid issues with TOC templates.

&lt;noinclude&gt;[[Category:Template Documentation]]&lt;/noinclude&gt;</text>
    </revision>
  </page>
  <page>
    <title>Template:DisableFlag</title>
    <id>33</id>
    <revision>
      <id>54</id>
      <timestamp>2013-06-05T09:27:42Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <comment>Created page with &quot;&lt;strong style=&quot;color:red;&quot;&gt;-{{{1}}}&lt;/strong&gt;&lt;noinclude&gt;{{TemplateDoc}}&lt;/noinclude&gt;&quot;</comment>
      <text xml:space="preserve">&lt;strong style=&quot;color:red;&quot;&gt;-{{{1}}}&lt;/strong&gt;&lt;noinclude&gt;{{TemplateDoc}}&lt;/noinclude&gt;</text>
    </revision>
  </page>
  <page>
    <title>Template:EnableFlag</title>
    <id>34</id>
    <revision>
      <id>55</id>
      <timestamp>2013-06-05T09:27:57Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <comment>Created page with &quot;&lt;strong style=&quot;color:green;&quot;&gt;{{{1}}}&lt;/strong&gt;&lt;noinclude&gt;{{TemplateDoc}}&lt;/noinclude&gt;&quot;</comment>
      <text xml:space="preserve">&lt;strong style=&quot;color:green;&quot;&gt;{{{1}}}&lt;/strong&gt;&lt;noinclude&gt;{{TemplateDoc}}&lt;/noinclude&gt;</text>
    </revision>
  </page>
  <page>
    <title>Template:File</title>
    <id>5</id>
    <revision>
      <id>32</id>
      <timestamp>2013-06-05T09:12:20Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve">&lt;div style=&quot;border: 1px solid rgb(255, 191, 191); padding: .2em .3em; margin: .2em .2em; background-color: rgb(255, 242, 242);&quot;&gt;&lt;div style=&quot;background-color: #ffc1c1; padding: .2em; margin: .2em; border: solid 1px #ff7070; font-size: 92%; &quot;&gt;'''File:''' {{{1}}}&lt;/div&gt;{{{2}}}&lt;/div&gt;&lt;noinclude&gt;{{TemplateDoc}}[[Category:Templates]]&lt;/noinclude&gt;</text>
    </revision>
  </page>
  <page>
    <title>Template:File/Doc</title>
    <id>19</id>
    <revision>
      <id>33</id>
      <timestamp>2013-06-05T09:12:38Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <comment>Created page with &quot;This template is used to include the contents of files.  Example: &lt;pre&gt;{{File|/etc/conf.d/915resolution|&lt;pre&gt; # Copyright 1999-2006 Gentoo Foundation # Distributed under the term...&quot;</comment>
      <text xml:space="preserve">This template is used to include the contents of files.

Example: &lt;pre&gt;{{File|/etc/conf.d/915resolution|&lt;pre&gt;
# Copyright 1999-2006 Gentoo Foundation
# Distributed under the terms of the GNU General Public License v2
# $Header: /var/cvsroot/gentoo-x86/sys-apps/915resolution/files/confd,v 1.3 2007/04/17 16:52:24 genstef Exp $

# Config file for /etc/init.d/915resolution
# based on the config file included with sys-apps/855resolution

# this example will replace mode &quot;4d&quot; with 1280x768x24
# to replace more than one mode do something like this
#replace=&quot;'4d 1280 768 24' '5c 1400 1050 16'&quot;
replace=&quot;'5c 800 480 32'&quot;

# if you want to log the output add the file here.
# this will be overwritten at every boot
log=&quot;/var/log/915resolution&quot;
&amp;lt;/pre&gt;}}&lt;/pre&gt;

Will produce:
{{File|/etc/conf.d/915resolution|&lt;pre&gt;
# Copyright 1999-2006 Gentoo Foundation
# Distributed under the terms of the GNU General Public License v2
# $Header: /var/cvsroot/gentoo-x86/sys-apps/915resolution/files/confd,v 1.3 2007/04/17 16:52:24 genstef Exp $

# Config file for /etc/init.d/915resolution
# based on the config file included with sys-apps/855resolution

# this example will replace mode &quot;4d&quot; with 1280x768x24
# to replace more than one mode do something like this
#replace=&quot;'4d 1280 768 24' '5c 1400 1050 16'&quot;
replace=&quot;'5c 800 480 32'&quot;

# if you want to log the output add the file here.
# this will be overwritten at every boot
log=&quot;/var/log/915resolution&quot;
&lt;/pre&gt;}}

To markup ''only'' the name of a file (e.g., {{path|/etc/conf.d/915resolution}}), use [[Template:Path]] instead.

&lt;noinclude&gt;[[Category:Template Documentation]]&lt;/noinclude&gt;</text>
    </revision>
  </page>
  <page>
    <title>Template:Kernel</title>
    <id>4</id>
    <revision>
      <id>40</id>
      <timestamp>2013-06-05T09:16:59Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve">{| width=&quot;100%&quot; cellpadding=0 cellspacing=0 style=&quot;background-color: rgb(250, 235, 215); border: solid 3px rgb(112, 112, 255); padding: 1px;&quot; 
| style=&quot;background-color: rgb(112, 112, 255); color: rgb(255, 255, 255); font-size: 0.9em; padding-left: 3px;&quot; | '''Linux Kernel Configuration:''' {{{1}}}
|- 
|
{{{2}}}
|}&lt;noinclude&gt;&lt;br/&gt;{{TemplateDoc}}[[Category:Templates]]&lt;/noinclude&gt;</text>
    </revision>
  </page>
  <page>
    <title>Template:Kernel/Doc</title>
    <id>23</id>
    <revision>
      <id>41</id>
      <timestamp>2013-06-05T09:17:18Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <comment>Created page with &quot;This template is for kernel configuration options. These should be shown using the &quot;make menuconfig&quot; layout.  Example: &lt;pre&gt;{{Kernel|EeePC kernel config|&lt;pre&gt; Processor type and ...&quot;</comment>
      <text xml:space="preserve">This template is for kernel configuration options. These should be shown using the &quot;make menuconfig&quot; layout.

Example:
&lt;pre&gt;{{Kernel|EeePC kernel config|&lt;pre&gt;
Processor type and features  ---&amp;gt;

     [*] Tickless System (Dynamic Ticks)

Power management options  ---&amp;gt;
     [*] Power Management support
     [*] ACPI (Advanced Configuration and Power Interface) Support  ---&amp;gt;
           &amp;lt;M&amp;gt;   AC Adapter
           &amp;lt;M&amp;gt;   Battery  
           &amp;lt; &amp;gt;   ASUS/Medion Laptop Extras
     [*] CPU Frequency scaling
           &amp;lt;M&amp;gt;   'ondemand' cpufreq policy governor
           &amp;lt;M&amp;gt;   ACPI Processor P-States driver
           &amp;lt;M&amp;gt;   Intel Pentium 4 clock modulation
&amp;lt;/pre&gt;}}&lt;/pre&gt;

Will produce:
{{Kernel|EeePC kernel config|&lt;pre&gt;
Processor type and features  ---&amp;gt;

     [*] Tickless System (Dynamic Ticks)

Power management options  ---&amp;gt;
     [*] Power Management support
     [*] ACPI (Advanced Configuration and Power Interface) Support  ---&amp;gt;
           &amp;lt;M&amp;gt;   AC Adapter
           &amp;lt;M&amp;gt;   Battery  
           &amp;lt; &amp;gt;   ASUS/Medion Laptop Extras
     [*] CPU Frequency scaling
           &amp;lt;M&amp;gt;   'ondemand' cpufreq policy governor
           &amp;lt;M&amp;gt;   ACPI Processor P-States driver
           &amp;lt;M&amp;gt;   Intel Pentium 4 clock modulation
&lt;/pre&gt;}}

&lt;noinclude&gt;[[Category:Template Documentation]]&lt;/noinclude&gt;</text>
    </revision>
  </page>
  <page>
    <title>Template:Key</title>
    <id>87</id>
    <revision>
      <id>114</id>
      <timestamp>2013-06-05T19:39:12Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <comment>Created page with &quot;&lt;span style=&quot;border:1px solid #bbbbbb; padding: 1.5pt; min-width: 1em; background: #eeeeee; font-weight: bold; font-size: small;&quot;&gt;{{{1}}}&lt;/span&gt;&lt;noinclude&gt;{{TemplateDoc}}[[Catego...&quot;</comment>
      <text xml:space="preserve">&lt;span style=&quot;border:1px solid #bbbbbb; padding: 1.5pt; min-width: 1em; background: #eeeeee; font-weight: bold; font-size: small;&quot;&gt;{{{1}}}&lt;/span&gt;&lt;noinclude&gt;{{TemplateDoc}}[[Category:Templates]]&lt;/noinclude&gt;</text>
    </revision>
  </page>
  <page>
    <title>Template:Key/Doc</title>
    <id>88</id>
    <revision>
      <id>115</id>
      <timestamp>2013-06-05T19:39:27Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <comment>Created page with &quot;This template is for keyboard commands.  Example: &lt;nowiki&gt;{{Key|Ctrl+v}}&lt;/nowiki&gt;  Will produce: {{Key|Ctrl+v}}  &lt;noinclude&gt;[[Category:Template Documentation]]&lt;/noinclude&gt;&quot;</comment>
      <text xml:space="preserve">This template is for keyboard commands.

Example: &lt;nowiki&gt;{{Key|Ctrl+v}}&lt;/nowiki&gt;

Will produce: {{Key|Ctrl+v}}

&lt;noinclude&gt;[[Category:Template Documentation]]&lt;/noinclude&gt;</text>
    </revision>
  </page>
  <page>
    <title>Template:Keyword</title>
    <id>35</id>
    <revision>
      <id>56</id>
      <timestamp>2013-06-05T09:29:34Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <comment>Created page with &quot;&lt;strong style=&quot;color: magenta;&quot;&gt;{{{1}}}&lt;/strong&gt;&lt;noinclude&gt;{{TemplateDoc}}[[Category:Templates]]&lt;/noinclude&gt;&quot;</comment>
      <text xml:space="preserve">&lt;strong style=&quot;color: magenta;&quot;&gt;{{{1}}}&lt;/strong&gt;&lt;noinclude&gt;{{TemplateDoc}}[[Category:Templates]]&lt;/noinclude&gt;</text>
    </revision>
  </page>
  <page>
    <title>Template:Keyword/Doc</title>
    <id>36</id>
    <revision>
      <id>57</id>
      <timestamp>2013-06-05T09:29:55Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <comment>Created page with &quot;This template is for (architecture) keywords.  Example: &lt;nowiki&gt;{{Keyword|x86}}&lt;/nowiki&gt;  Will produce: {{Keyword|x86}}  &lt;noinclude&gt;[[Category:Template Documentation]]&lt;/noinclude&gt;&quot;</comment>
      <text xml:space="preserve">This template is for (architecture) keywords.

Example: &lt;nowiki&gt;{{Keyword|x86}}&lt;/nowiki&gt;

Will produce: {{Keyword|x86}}

&lt;noinclude&gt;[[Category:Template Documentation]]&lt;/noinclude&gt;</text>
    </revision>
  </page>
  <page>
    <title>Template:Note</title>
    <id>27</id>
    <revision>
      <id>48</id>
      <timestamp>2013-06-05T09:23:33Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <comment>Created page with &quot;&lt;div style=&quot;padding: .2em .3em; margin: .2em .2em; background-color: #c1ffc1; border: solid 1px #00B000; font-size: 92%; width: 65%;&quot;&gt;'''Note:''' {{{1}}}&lt;/div&gt;&lt;noinclude&gt;{{Templa...&quot;</comment>
      <text xml:space="preserve">&lt;div style=&quot;padding: .2em .3em; margin: .2em .2em; background-color: #c1ffc1; border: solid 1px #00B000; font-size: 92%; width: 65%;&quot;&gt;'''Note:''' {{{1}}}&lt;/div&gt;&lt;noinclude&gt;{{TemplateDoc}}[[Category:Templates]]&lt;/noinclude&gt;</text>
    </revision>
  </page>
  <page>
    <title>Template:Note/Doc</title>
    <id>28</id>
    <revision>
      <id>49</id>
      <timestamp>2013-06-05T09:24:05Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <comment>Created page with &quot;This template is for items which should be noted by the user, but are not important enough to be a [[Template:Warning|Warning]].  Example: &lt;nowiki&gt;{{Note|If the system &lt;b&gt;reports...&quot;</comment>
      <text xml:space="preserve">This template is for items which should be noted by the user, but are not important enough to be a [[Template:Warning|Warning]].

Example: &lt;nowiki&gt;{{Note|If the system &lt;b&gt;reports &lt;i&gt;that&lt;/i&gt;&lt;/b&gt;&lt;i&gt; it is out&lt;/i&gt; of disk space, but still shows free space in the output of &quot;df&quot;, the problem could by that the filesystem has run out of free inodes. In this case you might consider increasing this number when creating the filesystem. For example: 
{{Root|mke2fs /dev/sdb2 -N 1000000 -m 0 -L eeepc_root}} }}&lt;/nowiki&gt;

Will produce:
{{Note|If the system &lt;b&gt;reports &lt;i&gt;that&lt;/i&gt;&lt;/b&gt;&lt;i&gt; it is out&lt;/i&gt; of disk space, but still shows free space in the output of &quot;df&quot;, the problem could by that the filesystem has run out of free inodes. In this case you might consider increasing this number when creating the filesystem. For example: 
{{Root|mke2fs /dev/sdb2 -N 1000000 -m 0 -L eeepc_root}} }}

&lt;noinclude&gt;[[Category:Template Documentation]]&lt;/noinclude&gt;</text>
    </revision>
  </page>
  <page>
    <title>Template:Package</title>
    <id>9</id>
    <revision>
      <id>42</id>
      <timestamp>2013-06-05T09:18:48Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve">[{{#ifeq: {{{direct}}}|yes|http://gentoo-portage.com/|http://gentoo-portage.com/Search?search=}}{{{1}}} {{{1}}}]&lt;noinclude&gt;{{TemplateDoc}}[[Category:Templates]]&lt;/noinclude&gt;</text>
    </revision>
  </page>
  <page>
    <title>Template:Package/Doc</title>
    <id>24</id>
    <revision>
      <id>43</id>
      <timestamp>2013-06-05T09:19:07Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <comment>Created page with &quot;This template is for packages. It creates a search link to [http://gentoo-portage.com Gentoo-Portage.com].  === Search === Example: &lt;nowiki&gt;{{Package|sys-apps/portage}}&lt;/nowiki&gt; ...&quot;</comment>
      <text xml:space="preserve">This template is for packages. It creates a search link to [http://gentoo-portage.com Gentoo-Portage.com].

=== Search ===
Example: &lt;nowiki&gt;{{Package|sys-apps/portage}}&lt;/nowiki&gt;

Will produce: {{Package|sys-apps/portage}}

=== Direct ===

Example: &lt;nowiki&gt;{{Package|sys-apps/portage|direct=yes}}&lt;/nowiki&gt;

Will produce: {{Package|sys-apps/portage|direct=yes}}

=== Empty ===

Example: &lt;nowiki&gt;{{Package}}&lt;/nowiki&gt;

Will produce: {{Package}}

&lt;noinclude&gt;[[Category:Template Documentation]]&lt;/noinclude&gt;</text>
    </revision>
  </page>
  <page>
    <title>Template:Path</title>
    <id>20</id>
    <revision>
      <id>34</id>
      <timestamp>2013-06-05T09:13:32Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <comment>Created page with &quot;&lt;span style=&quot;color:darkgreen; font-weight:bold; font-family: monospace&quot;&gt;{{{1}}}&lt;/span&gt;&lt;noinclude&gt;{{TemplateDoc}}[[Category:Templates]]&lt;/noinclude&gt;&quot;</comment>
      <text xml:space="preserve">&lt;span style=&quot;color:darkgreen; font-weight:bold; font-family: monospace&quot;&gt;{{{1}}}&lt;/span&gt;&lt;noinclude&gt;{{TemplateDoc}}[[Category:Templates]]&lt;/noinclude&gt;</text>
    </revision>
  </page>
  <page>
    <title>Template:Path/Doc</title>
    <id>21</id>
    <revision>
      <id>35</id>
      <timestamp>2013-06-05T09:13:52Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <comment>Created page with &quot;This template is for (inline) file paths.  Example: &lt;nowiki&gt;{{Path|/etc/X11/xorg.conf}}&lt;/nowiki&gt;  Will produce: {{Path|/etc/X11/xorg.conf}}  To display the name of a file along w...&quot;</comment>
      <text xml:space="preserve">This template is for (inline) file paths.

Example: &lt;nowiki&gt;{{Path|/etc/X11/xorg.conf}}&lt;/nowiki&gt;

Will produce: {{Path|/etc/X11/xorg.conf}}

To display the name of a file along with its contents, use [[Template:File]].

&lt;noinclude&gt;[[Category:Template Documentation]]&lt;/noinclude&gt;</text>
    </revision>
  </page>
  <page>
    <title>Template:Root</title>
    <id>7</id>
    <revision>
      <id>38</id>
      <timestamp>2013-06-05T09:15:32Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <comment>Undo revision 37 by [[Special:Contributions/Alonbl|Alonbl]] ([[User talk:Alonbl|talk]])</comment>
      <text xml:space="preserve">&lt;div style=&quot;background-color: #ffe0e0; color:#000000; padding:.05em .5em; margin:.5em; border:1px solid #cc6666; border-left:10px solid #cc6666; font-size: 92%; white-space:pre; font-family:monospace; width: 55%;&quot;&gt;{{{1}}}&lt;/div&gt;&lt;noinclude&gt;{{TemplateDoc}}[[Category:Templates]]&lt;/noinclude&gt;</text>
    </revision>
  </page>
  <page>
    <title>Template:Root/Doc</title>
    <id>22</id>
    <revision>
      <id>39</id>
      <timestamp>2013-06-05T09:15:40Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <comment>Created page with &quot;This template is for commands which must be run by the root user. For commands which can be entered by any user, use [[Template:Command]].  Command output should not be included ...&quot;</comment>
      <text xml:space="preserve">This template is for commands which must be run by the root user. For commands which can be entered by any user, use [[Template:Command]].

Command output should not be included within this template. Use either [[Template:Codeline]] (for in-line output usage) or &amp;lt;pre&gt; &amp;lt;/pre&gt; (for blocks of output).

Example:
&lt;nowiki&gt; {{Root|emerge --ask -uDNvt @world}} &lt;/nowiki&gt;

Will produce:
{{Root|emerge --ask -uDNvt @world}}


If your template comes out with &lt;nowiki&gt;{{{1}}}&lt;/nowiki&gt; instead of the parameter value, see [[Help:FAQ#Template_.28eg._Command_or_User.29_contents_come_out_as_.7B.7B.7B1.7D.7D.7D|the FAQs page]].

'''Note:''' This template is restricted in width to avoid issues with TOC templates.

&lt;noinclude&gt;[[Category:Template Documentation]]&lt;/noinclude&gt;</text>
    </revision>
  </page>
  <page>
    <title>Template:TemplateDoc</title>
    <id>15</id>
    <revision>
      <id>26</id>
      <timestamp>2013-06-05T09:06:14Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <comment>Created page with &quot;{|style=&quot;width:100%; padding:2px; margin:0; margin-bottom:10px; background-color:#E9EDF6; border:1px solid #aaa;&quot; | &lt;span class=&quot;editsection plainlinks&quot; id=&quot;doc_editlinks&quot;&gt;{{#ife...&quot;</comment>
      <text xml:space="preserve">{|style=&quot;width:100%; padding:2px; margin:0; margin-bottom:10px; background-color:#E9EDF6; border:1px solid #aaa;&quot;
|
&lt;span class=&quot;editsection plainlinks&quot; id=&quot;doc_editlinks&quot;&gt;{{#ifexist:{{#rel2abs:{{{List|./Doc}}}}}
    |&lt;!--**    /doc EXISTS**   --&gt;[[{{fullurl:{{#rel2abs:{{{List|./Doc}}}}}|action=edit}} edit]]
    |&lt;!--**/doc DOESN'T EXIST**--&gt;[[{{fullurl:{{#rel2abs:{{{List|./Doc}}}}}|action=edit}} create]]
   }}&lt;/span&gt;
&lt;div style=&quot;font-size: 1.5em; font-weight:bold;&quot;&gt; [[Image:Template-info.svg|50px]] Template Documentation &lt;/div&gt;
----
{{#ifexist: {{#rel2abs:{{{List|./Doc}}}}} | 
{{ {{#rel2abs:{{{List|./Doc}}}}} }} | 
To use this template insert &lt;nowiki&gt;{{&lt;/nowiki&gt;{{SUBJECTPAGENAME}}&lt;nowiki&gt;}}&lt;/nowiki&gt; into the page you wish to use it on and the page you wish.

''This template does not have documentation, please [[{{#rel2abs:{{{List|./Doc}}}}}|add it]]'' [[Category:Template No Doc]]
}}
|}&lt;noinclude&gt;[[Category:Templates]]&lt;/noinclude&gt;</text>
    </revision>
  </page>
  <page>
    <title>Template:USEFlag</title>
    <id>31</id>
    <revision>
      <id>52</id>
      <timestamp>2013-06-05T09:26:31Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <comment>Created page with &quot;{{#ifeq: {{{extended}}}|yes|&lt;span style=&quot;background-color:khaki;padding:4px;&quot;&gt;&lt;strong&gt;Use Flags:&lt;/strong&gt; {{{1}}} &lt;small&gt;([[USE Flags|?]])&lt;/small&gt;&lt;/span&gt;|&lt;span style=&quot;color: maro...&quot;</comment>
      <text xml:space="preserve">{{#ifeq: {{{extended}}}|yes|&lt;span style=&quot;background-color:khaki;padding:4px;&quot;&gt;&lt;strong&gt;Use Flags:&lt;/strong&gt; {{{1}}} &lt;small&gt;([[USE Flags|?]])&lt;/small&gt;&lt;/span&gt;|&lt;span style=&quot;color: maroon; font-weight: bold;&quot;&gt;{{{1}}}&lt;/span&gt; }}&lt;noinclude&gt;&lt;br/&gt;{{TemplateDoc}}[[Category:Templates]]&lt;/noinclude&gt;</text>
    </revision>
  </page>
  <page>
    <title>Template:USEFlag/Doc</title>
    <id>32</id>
    <revision>
      <id>53</id>
      <timestamp>2013-06-05T09:27:02Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <comment>Created page with &quot;=== Simple ===  &lt;pre&gt;&lt;nowiki&gt; {{USEFlag| {{EnableFlag|test}}  {{DisableFlag|blah}} }}&lt;/nowiki&gt;&lt;/pre&gt;  Will produce: {{USEFlag|{{EnableFlag|test}} {{DisableFlag|blah}}}}  ----  &lt;p...&quot;</comment>
      <text xml:space="preserve">=== Simple ===

&lt;pre&gt;&lt;nowiki&gt;
{{USEFlag|
{{EnableFlag|test}} 
{{DisableFlag|blah}}
}}&lt;/nowiki&gt;&lt;/pre&gt;

Will produce: {{USEFlag|{{EnableFlag|test}} {{DisableFlag|blah}}}}

----

&lt;pre&gt;&lt;nowiki&gt;{{USEFlag|X -kde}}&lt;/nowiki&gt;&lt;/pre&gt;

Will produce: {{USEFlag|X -kde}}

=== Extended ===

&lt;pre&gt;&lt;nowiki&gt;
{{USEFlag|extended=yes|
{{EnableFlag|test}} 
{{DisableFlag|blah}}
}}&lt;/nowiki&gt;&lt;/pre&gt;

Will produce:

{{USEFlag|extended=yes|{{EnableFlag|test}} {{DisableFlag|blah}}}}


{{Note|Flags should all be specified on a single line, as USEFlag preserves line-breaks.}}

&lt;noinclude&gt;[[Category:Template Documentation]]&lt;/noinclude&gt;</text>
    </revision>
  </page>
  <page>
    <title>Template:Warning</title>
    <id>29</id>
    <revision>
      <id>50</id>
      <timestamp>2013-06-05T09:24:46Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <comment>Created page with &quot;&lt;div style=&quot;padding: .2em .3em; margin: .2em .2em; background-color: #ffc1c1; border: solid 1px #ff7070; font-size: 92%;&quot;&gt;'''Warning:''' {{{1}}}&lt;/div&gt;&lt;noinclude&gt;{{TemplateDoc}}[[...&quot;</comment>
      <text xml:space="preserve">&lt;div style=&quot;padding: .2em .3em; margin: .2em .2em; background-color: #ffc1c1; border: solid 1px #ff7070; font-size: 92%;&quot;&gt;'''Warning:''' {{{1}}}&lt;/div&gt;&lt;noinclude&gt;{{TemplateDoc}}[[Category:Templates]]&lt;/noinclude&gt;</text>
    </revision>
  </page>
  <page>
    <title>Template:Warning/Doc</title>
    <id>30</id>
    <revision>
      <id>51</id>
      <timestamp>2013-06-05T09:25:25Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <comment>Created page with &quot;This template is for important warnings.  Example: &lt;nowiki&gt;{{Warning|The reactor may be destroyed if you disable the cooling system. As a result, a large area around the reactor ...&quot;</comment>
      <text xml:space="preserve">This template is for important warnings.

Example:
&lt;nowiki&gt;{{Warning|The reactor may be destroyed if you disable the cooling system. As a result, a large area around the reactor may become dangerously radioactive. If this happens, seek medical assistance immediately.}}&lt;/nowiki&gt;

Will produce:
{{Warning|The reactor may be destroyed if you disable the cooling system. As a result, a large area around the reactor may become dangerously radioactive. If this happens, seek medical assistance immediately.}}

&lt;noinclude&gt;[[Category:Template Documentation]]&lt;/noinclude&gt;</text>
    </revision>
  </page>
  <page>
    <title>Template:WikiBackup</title>
    <id>39</id>
    <revision>
      <id>60</id>
      <timestamp>2013-06-05T17:59:54Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <comment>Created page with &quot;[[{{{1}}}]] [{{fullurl:{{{1}}}|action=raw}} backup]&quot;</comment>
      <text xml:space="preserve">[[{{{1}}}]] [{{fullurl:{{{1}}}|action=raw}} backup]</text>
    </revision>
  </page>
  <page>
    <title>User:Alonbl</title>
    <id>143</id>
    <revision>
      <id>255</id>
      <timestamp>2013-06-05T21:13:16Z</timestamp>
      <contributor>
        <username>Alonbl</username>
        <id>1</id>
      </contributor>
      <text xml:space="preserve">= Alon Bar-Lev =

[[File:Alonbl.jpg|100px|left]]

[mailto:alon.barlev@gmail.com Alon Bar-Lev &lt;alon.barlev@gmail.com&gt;]

[http://alon.barlev.googlepages.com Site]

[http://www.ohloh.net/accounts/19668?ref=Detailed Ohloh][img]http://www.ohloh.net/accounts/19668/widgets/account_detailed.gif[/img]

{{Note|Feel free to contact me regarding any of the subjects of my articles!}}
{{Note|I will appreciate that before making none-trivial changes in my articles, discuss the change first}}</text>
    </revision>
  </page>
</mediawiki>
